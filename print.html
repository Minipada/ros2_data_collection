<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js navy">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Data Collection for ROS 2</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/lineicon.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="open-in.css">
        <link rel="stylesheet" href="./css/mdbook-admonish.css">
        <link rel="stylesheet" href="css/logo.css">
        <link rel="stylesheet" href="css/lineicon.css">
        <link rel="stylesheet" href="css/theme.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Hotjar -->
        <script>
            if (window.location.href.startsWith("https://minipada.github.io/ros2_data_collection")) {
            (function(h,o,t,j,a,r){
                h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
                h._hjSettings={hjid:3435761,hjsv:6};
                a=o.getElementsByTagName('head')[0];
                r=o.createElement('script');r.async=1;
                r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
                a.appendChild(r);
            })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
            }
        </script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "navy";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <a id="a-logo-dc" href="/"><img id="logo-dc"></a>
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="dc/introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item "><a href="dc/setup.html"><strong aria-hidden="true">2.</strong> Setup</a></li><li class="chapter-item "><a href="dc/demos.html"><strong aria-hidden="true">3.</strong> Demos</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="dc/demos/uptime_stdout.html"><strong aria-hidden="true">3.1.</strong> Uptime</a></li><li class="chapter-item "><a href="dc/demos/memory_uptime_stdout.html"><strong aria-hidden="true">3.2.</strong> Group memory and uptime</a></li><li class="chapter-item "><a href="dc/demos/tb3_stdout.html"><strong aria-hidden="true">3.3.</strong> Turtlebot3</a></li><li class="chapter-item "><a href="dc/demos/tb3_aws_minio_pgsql.html"><strong aria-hidden="true">3.4.</strong> Turtlebot3 AWS Warehouse MinIO PostgreSQL</a></li><li class="chapter-item "><a href="dc/demos/tb3_aws_influxdb.html"><strong aria-hidden="true">3.5.</strong> Turtlebot3 AWS Warehouse InfluxDB</a></li><li class="chapter-item "><a href="dc/demos/qrcodes_minio_pgsql.html"><strong aria-hidden="true">3.6.</strong> QRcodes to PostgreSQL/MinIO</a></li><li class="chapter-item "><a href="dc/demos/custom_stdout.html"><strong aria-hidden="true">3.7.</strong> Custom plugin</a></li></ol></li><li class="chapter-item "><a href="dc/concepts.html"><strong aria-hidden="true">4.</strong> Concepts</a></li><li class="chapter-item "><a href="dc/data_pipeline.html"><strong aria-hidden="true">5.</strong> Data Pipeline</a></li><li class="chapter-item "><a href="dc/measurements.html"><strong aria-hidden="true">6.</strong> Measurements</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="dc/measurements/camera.html"><strong aria-hidden="true">6.1.</strong> Camera</a></li><li class="chapter-item "><a href="dc/measurements/cmd_vel.html"><strong aria-hidden="true">6.2.</strong> Command velocity</a></li><li class="chapter-item "><a href="dc/measurements/cpu.html"><strong aria-hidden="true">6.3.</strong> CPU</a></li><li class="chapter-item "><a href="dc/measurements/dummy.html"><strong aria-hidden="true">6.4.</strong> Dummy</a></li><li class="chapter-item "><a href="dc/measurements/distance_traveled.html"><strong aria-hidden="true">6.5.</strong> Distance traveled</a></li><li class="chapter-item "><a href="dc/measurements/ip_camera.html"><strong aria-hidden="true">6.6.</strong> IP Camera</a></li><li class="chapter-item "><a href="dc/measurements/map.html"><strong aria-hidden="true">6.7.</strong> Map</a></li><li class="chapter-item "><a href="dc/measurements/memory.html"><strong aria-hidden="true">6.8.</strong> Memory</a></li><li class="chapter-item "><a href="dc/measurements/network.html"><strong aria-hidden="true">6.9.</strong> Network</a></li><li class="chapter-item "><a href="dc/measurements/os.html"><strong aria-hidden="true">6.10.</strong> OS</a></li><li class="chapter-item "><a href="dc/measurements/permissions.html"><strong aria-hidden="true">6.11.</strong> Permissions</a></li><li class="chapter-item "><a href="dc/measurements/position.html"><strong aria-hidden="true">6.12.</strong> Position</a></li><li class="chapter-item "><a href="dc/measurements/speed.html"><strong aria-hidden="true">6.13.</strong> Speed</a></li><li class="chapter-item "><a href="dc/measurements/storage.html"><strong aria-hidden="true">6.14.</strong> Storage</a></li><li class="chapter-item "><a href="dc/measurements/string_stamped.html"><strong aria-hidden="true">6.15.</strong> String stamped</a></li><li class="chapter-item "><a href="dc/measurements/tcp_health.html"><strong aria-hidden="true">6.16.</strong> TCP Health</a></li><li class="chapter-item "><a href="dc/measurements/uptime.html"><strong aria-hidden="true">6.17.</strong> Uptime</a></li></ol></li><li class="chapter-item "><a href="dc/conditions.html"><strong aria-hidden="true">7.</strong> Conditions</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="dc/conditions/bool_equal.html"><strong aria-hidden="true">7.1.</strong> Bool equal</a></li><li class="chapter-item "><a href="dc/conditions/double_equal.html"><strong aria-hidden="true">7.2.</strong> Double equal</a></li><li class="chapter-item "><a href="dc/conditions/double_inferior.html"><strong aria-hidden="true">7.3.</strong> Double inferior</a></li><li class="chapter-item "><a href="dc/conditions/double_superior.html"><strong aria-hidden="true">7.4.</strong> Double superior</a></li><li class="chapter-item "><a href="dc/conditions/exist.html"><strong aria-hidden="true">7.5.</strong> Exist</a></li><li class="chapter-item "><a href="dc/conditions/integer_equal.html"><strong aria-hidden="true">7.6.</strong> Integer equal</a></li><li class="chapter-item "><a href="dc/conditions/integer_inferior.html"><strong aria-hidden="true">7.7.</strong> Integer inferior</a></li><li class="chapter-item "><a href="dc/conditions/integer_superior.html"><strong aria-hidden="true">7.8.</strong> Integer superior</a></li><li class="chapter-item "><a href="dc/conditions/list_bool_equal.html"><strong aria-hidden="true">7.9.</strong> List bool equal</a></li><li class="chapter-item "><a href="dc/conditions/list_double_equal.html"><strong aria-hidden="true">7.10.</strong> List double equal</a></li><li class="chapter-item "><a href="dc/conditions/list_integer_equal.html"><strong aria-hidden="true">7.11.</strong> List integer equal</a></li><li class="chapter-item "><a href="dc/conditions/list_string_equal.html"><strong aria-hidden="true">7.12.</strong> List string equal</a></li><li class="chapter-item "><a href="dc/conditions/moving.html"><strong aria-hidden="true">7.13.</strong> Moving</a></li><li class="chapter-item "><a href="dc/conditions/same_as_previous.html"><strong aria-hidden="true">7.14.</strong> Same as previous</a></li><li class="chapter-item "><a href="dc/conditions/string_match.html"><strong aria-hidden="true">7.15.</strong> String match</a></li></ol></li><li class="chapter-item "><a href="dc/data_validation.html"><strong aria-hidden="true">8.</strong> Data validation</a></li><li class="chapter-item "><a href="dc/groups.html"><strong aria-hidden="true">9.</strong> Groups</a></li><li class="chapter-item "><a href="dc/destinations.html"><strong aria-hidden="true">10.</strong> Destinations</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="dc/destinations/flb_kinesis_data_streams.html"><strong aria-hidden="true">10.1.</strong> Fluent Bit AWS Kinesis Data Streams</a></li><li class="chapter-item "><a href="dc/destinations/flb_s3.html"><strong aria-hidden="true">10.2.</strong> Fluent Bit AWS S3</a></li><li class="chapter-item "><a href="dc/destinations/flb_file.html"><strong aria-hidden="true">10.3.</strong> Fluent Bit File</a></li><li class="chapter-item "><a href="dc/destinations/flb_files_metrics.html"><strong aria-hidden="true">10.4.</strong> Fluent Bit Files metrics</a></li><li class="chapter-item "><a href="dc/destinations/flb_http.html"><strong aria-hidden="true">10.5.</strong> Fluent Bit HTTP</a></li><li class="chapter-item "><a href="dc/destinations/flb_influxdb.html"><strong aria-hidden="true">10.6.</strong> Fluent Bit InfluxDB</a></li><li class="chapter-item "><a href="dc/destinations/flb_minio.html"><strong aria-hidden="true">10.7.</strong> Fluent Bit MinIO</a></li><li class="chapter-item "><a href="dc/destinations/flb_null.html"><strong aria-hidden="true">10.8.</strong> Fluent Bit NULL</a></li><li class="chapter-item "><a href="dc/destinations/flb_pgsql.html"><strong aria-hidden="true">10.9.</strong> Fluent Bit PostgreSQL</a></li><li class="chapter-item "><a href="dc/destinations/flb_slack.html"><strong aria-hidden="true">10.10.</strong> Fluent Bit Slack</a></li><li class="chapter-item "><a href="dc/destinations/flb_stdout.html"><strong aria-hidden="true">10.11.</strong> Fluent Bit Stdout</a></li><li class="chapter-item "><a href="dc/destinations/flb_tcp.html"><strong aria-hidden="true">10.12.</strong> Fluent Bit TCP</a></li><li class="chapter-item "><a href="dc/destinations/rcl.html"><strong aria-hidden="true">10.13.</strong> RCL</a></li></ol></li><li class="chapter-item "><a href="dc/configuration_examples.html"><strong aria-hidden="true">11.</strong> Configuration examples</a></li><li class="chapter-item "><a href="dc/infrastructure_setup.html"><strong aria-hidden="true">12.</strong> Infrastructure setup</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="dc/infrastructure_setup/influxdb.html"><strong aria-hidden="true">12.1.</strong> InfluxDB</a></li><li class="chapter-item "><a href="dc/infrastructure_setup/ip_camera.html"><strong aria-hidden="true">12.2.</strong> Ip camera</a></li><li class="chapter-item "><a href="dc/infrastructure_setup/minio.html"><strong aria-hidden="true">12.3.</strong> MinIO</a></li><li class="chapter-item "><a href="dc/infrastructure_setup/postgresql.html"><strong aria-hidden="true">12.4.</strong> PostgreSQL</a></li></ol></li><li class="chapter-item "><a href="dc/cli.html"><strong aria-hidden="true">13.</strong> CLI tools</a></li><li class="chapter-item "><a href="dc/requirements.html"><strong aria-hidden="true">14.</strong> Requirements</a></li><li class="chapter-item "><a href="dc/future_work.html"><strong aria-hidden="true">15.</strong> Future work and Roadmap</a></li><li class="chapter-item "><a href="dc/contributing.html"><strong aria-hidden="true">16.</strong> Contributing</a></li><li class="chapter-item "><a href="dc/faq.html"><strong aria-hidden="true">17.</strong> FAQ</a></li><li class="chapter-item "><a href="dc/about_contact.html"><strong aria-hidden="true">18.</strong> About and Contact</a></li></ol>
                <footer id="nav-separator"></footer>
                <a style="margin-right: 10px;" href="https://github.com/minipada/ros2_data_collection" target="_blank"><i  class="lni lni-github-original lni-32"></i></a>
                <a style="margin-right: 10px;" href="mailto:d.bensoussan@proton.me" target="_blank"><i  class="lni lni-envelope lni-32"></i></a>
                <div>Under <a target="_blank" style="color: var(--sidebar-active);"
                    href="https://tldrlegal.com/license/mozilla-public-license-2.0-(mpl-2)">MPL-2.0</a>
                license</a>
                </div>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Data Collection for ROS 2</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/minipada/ros2_data_collection" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="dc"><a class="header" href="#dc">DC</a></h1>
<p class="github-only" align="center">
  <img height="300" src="dc/./doc/src/images/dc.png" />
</p>
<p><strong>Documentation</strong>: <a href="https://minipada.github.io/ros2_data_collection">https://minipada.github.io/ros2_data_collection</a></p>
<p><strong>Source code</strong>: <a href="https://github.com/minipada/ros2_data_collection">https://github.com/minipada/ros2_data_collection</a></p>
<p><a href="https://docs.ros.org/en/humble/index.html"><img src="https://img.shields.io/badge/ROS%202-humble-informational?style=for-the-badge" alt="ROS 2" /></a> <img src="https://img.shields.io/badge/python-3.10.4-informational?style=for-the-badge" alt="python" /> <img src="https://img.shields.io/badge/C++-17-informational?style=for-the-badge" alt="C++" /></p>
<p><a href="https://codecov.io/gh/Minipada/ros2_data_collection"><img src="https://codecov.io/gh/Minipada/ros2_data_collection/branch/humble/graph/badge.svg?token=Y2UA5OE0KR" alt="codecov" /></a> <a href="https://minipada.testspace.com/spaces/219054?utm_campaign=badge&amp;utm_medium=referral&amp;utm_source=test"><img src="https://minipada.testspace.com/spaces/219054/badge?token=8214fc76eff8c09b47136742d644d2a1ac0e38e3" alt="tests" /></a></p>
<div class="table-wrapper"><table><thead><tr><th>Humble</th></tr></thead><tbody>
<tr><td><a href="https://github.com/minipada/ros2_data_collection/actions/workflows/docker.yaml"><img src="https://github.com/minipada/ros2_data_collection/actions/workflows/docker.yaml/badge.svg" alt="Docker" /></a></td></tr>
<tr><td><a href="https://github.com/minipada/ros2_data_collection/actions/workflows/format.yaml"><img src="https://github.com/minipada/ros2_data_collection/actions/workflows/format.yaml/badge.svg" alt="Format" /></a></td></tr>
<tr><td><a href="https://github.com/minipada/ros2_data_collection/actions/workflows/doc.yaml"><img src="https://github.com/minipada/ros2_data_collection/actions/workflows/doc.yaml/badge.svg" alt="Documentation" /></a></td></tr>
<tr><td><a href="https://github.com/Minipada/ros2_data_collection/actions/workflows/pages/pages-build-deployment"><img src="https://github.com/Minipada/ros2_data_collection/actions/workflows/pages/pages-build-deployment/badge.svg" alt="Github Pages" /></a></td></tr>
<tr><td><a href="https://github.com/Minipada/ros2_data_collection/actions/workflows/ci.yaml"><img src="https://github.com/Minipada/ros2_data_collection/actions/workflows/ci.yaml/badge.svg" alt="CI" /></a></td></tr>
</tbody></table>
</div>
<p>For detailed instructions:</p>
<ul>
<li><a href="https://minipada.github.io/ros2_data_collection/dc/setup.html">Setup</a></li>
<li><a href="https://minipada.github.io/ros2_data_collection/dc/demos.html">Demos</a></li>
<li><a href="https://minipada.github.io/ros2_data_collection/dc/concepts.html">Concepts</a></li>
<li><a href="https://minipada.github.io/ros2_data_collection/dc/data_pipeline.html">Data Pipeline</a></li>
<li><a href="https://minipada.github.io/ros2_data_collection/dc/measurements.html">Measurements</a></li>
<li><a href="https://minipada.github.io/ros2_data_collection/dc/conditions.html">Conditions</a></li>
<li><a href="https://minipada.github.io/ros2_data_collection/dc/data_validation.html">Data validation</a></li>
<li><a href="https://minipada.github.io/ros2_data_collection/dc/groups.html">Groups</a></li>
<li><a href="https://minipada.github.io/ros2_data_collection/dc/destinations.html">Destinations</a></li>
<li><a href="https://minipada.github.io/ros2_data_collection/dc/configuration_examples.html">Configuration examples</a></li>
<li><a href="https://minipada.github.io/ros2_data_collection/dc/infrastructure_setup.html">Infrastructure setup</a></li>
<li><a href="https://minipada.github.io/ros2_data_collection/dc/cli.html">CLI tools</a></li>
<li><a href="https://minipada.github.io/ros2_data_collection/dc/requirements.html">Requirements</a></li>
<li><a href="https://minipada.github.io/ros2_data_collection/dc/future_work.html">Future work and Roadmap</a></li>
<li><a href="https://minipada.github.io/ros2_data_collection/dc/contributing.html">Contributing</a></li>
<li><a href="https://minipada.github.io/ros2_data_collection/dc/faq.html">FAQ</a></li>
<li><a href="https://minipada.github.io/ros2_data_collection/dc/about_contact.html">About and contact</a></li>
</ul>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>The DC (Data Collection) project aims at integrating data collection pipelines into ROS 2. The goal is to integrate data collection pipelines with existing APIs to enable data analytics, rather than live monitoring, which already has excellent tools available. As companies increasingly turn to autonomous robots, the ability to understand and improve operations for any type of machine in any environment has become crucial. This involves mostly pick and drop and inspection operations. This framework aims at helping collecting, validating (through JSON schemas) and sending reliably the data to create such APIs and dashboards.</p>
<p>DC uses a modular approach, based on <a href="https://index.ros.org/p/pluginlib/">pluginlib</a> and greatly inspired by <a href="https://navigation.ros.org/">Nav2</a> for its architecture. Pluginlib is used to configure which measurements are collected and where the data goes. Measurements and destinations are pluginlib plugins. In addition to pluginlib, most plugins use <a href="https://fluentbit.io/">Fluent Bit</a> in the backend: <em>Fluent Bit is a super fast, lightweight, and highly scalable logging and metrics processor and forwarder. It is the preferred choice for cloud and containerized environments. Developed and interfaced in C, it has already many features we directly can use, especially: high performance, reliability and data integrity (backpressure handling and data buffering in memory and filesystem)</em>.</p>
<h2 id="why-collect-data-from-robots"><a class="header" href="#why-collect-data-from-robots">Why collect data from robots?</a></h2>
<ol>
<li><strong>Performance Monitoring</strong>: Collecting data from a robot allows you to monitor its performance and identify areas for improvement. For example, you can use data to analyze the robot's motion and identify areas where it may be experiencing issues or inefficiencies.</li>
<li><strong>Fault Diagnosis</strong>: Data collection can also be used to diagnose faults and troubleshoot issues with the robot. By collecting data on various aspects of the robot's behavior, you can identify patterns or anomalies that may indicate problems with the system.</li>
<li><strong>Machine Learning</strong>: Data collected from robots can be used to train machine learning models, which can be used to improve the robot's performance and behavior. For example, you can use data collected from sensors to train models for object detection or path planning.</li>
<li><strong>Research and Development</strong>: Data collection is important for research and development in robotics. By collecting data on the behavior of robots in different scenarios, researchers can gain insights into how robots can be designed and optimized for different applications.</li>
<li><strong>Inventory Management</strong>: Data collection can be used to monitor inventory levels and track the movement of goods within a warehouse. This can help managers identify which products are in high demand and optimize the placement of products to improve order fulfillment times.</li>
<li><strong>Resource Allocation</strong>: Data collection can also help managers allocate resources more efficiently. For example, by monitoring the movement of people and goods within a warehouse, managers can identify bottlenecks and areas of congestion and adjust staffing and equipment allocation to address these issues.</li>
<li><strong>Process Improvement</strong>: Data collection can be used to monitor and analyze the performance of various processes within a warehouse. By identifying areas of inefficiency or errors, managers can develop strategies for improving these processes and increasing productivity.</li>
<li><strong>Predictive Maintenance</strong>: Data collection can be used to monitor the performance of equipment and identify potential maintenance issues before they occur. This can help managers schedule maintenance more effectively and avoid costly downtime due to equipment failure.</li>
</ol>
<h2 id="main-features"><a class="header" href="#main-features">Main features</a></h2>
<ul>
<li><strong>Open source</strong>: Currently all tools on the market are not open source. This project is in <a href="https://www.mozilla.org/en-US/MPL/2.0/">MPL-2.0 license</a>, in summary you can use without asking permission and without paying</li>
<li><strong>Modular approach</strong>: based on pluginlib and greatly inspired by Nav2 for its architecture</li>
<li><strong>Reliable data collection</strong>: validate and send data to create APIs and dashboards</li>
<li><strong>Flexible data collection</strong>: set polling interval for each measurement or collect every measurement with StringStamped messages</li>
<li><strong>Customizable validation</strong>: validate data using existing or customized JSON schemas</li>
<li><strong>Easy to extend</strong>: add new measurements or destinations by simply adding a plugin</li>
<li><strong>Flexible data collection conditions</strong>: collect data based on conditions such as whether the robot is moving or if a field is equal to a value</li>
<li><strong>Trigger-based data collection</strong>: collect data when a defined set of combination of all, any, or no condition are met</li>
<li><strong>Customizable record collection</strong>: configure the number of records to collect at the start and when a condition is activated.</li>
<li><strong>Data inspection</strong>: inspect data from camera input including barcode and QR codes</li>
<li><strong>Fast and efficient</strong>: high performance, using Fluent Bit for backend processing, and designed to minimize code duplication and reduce human errors</li>
<li><strong>Grouped measurements</strong>: measurements can be grouped using the group node based on the ApproximateTimeSynchronizer</li>
<li><strong>File saving</strong>: files can be saved, including map_server maps, camera images, and any file produced by a measurement</li>
<li><strong>Easy to use</strong>: designed to be easy to learn and use</li>
<li><strong>No C++ 3rd party library required</strong>: all 3rd party libraries have a vendor package in the repository</li>
</ul>
<p>And inherited from Fluent Bit:</p>
<ul>
<li><a href="https://docs.fluentbit.io/manual/v/1.0/configuration/backpressure">Backpressure handling</a></li>
<li><a href="https://docs.fluentbit.io/manual/v/1.0/configuration/buffering">Data buffering in memory and filesystem</a></li>
</ul>
<p>Here is an example of a pipeline:</p>
<pre class="mermaid">flowchart LR
    pl_camera1[&quot;Camera bottom&quot;]
    pl_camera2[&quot;Camera middle&quot;]
    pl_camera3[&quot;Camera top&quot;]
    pl_condition_moving[&quot;Moving&quot;]
    pl_cpu[&quot;CPU&quot;]
    pl_cmd_vel[&quot;Command velocity&quot;]
    pl_memory[&quot;Memory&quot;]
    pl_position[&quot;Position&quot;]
    pl_speed[&quot;Speed&quot;]
    pl_storage[&quot;Storage&quot;]
    pl_uptime[&quot;Uptime&quot;]
    pl_network[&quot;Network&quot;]
    pl_network_boot[&quot;Network&quot;]
    pl_os_boot[&quot;OS&quot;]

    subgraph m_n[&quot;Measurement node&quot;]
        subgraph cond[&quot;Condition plugins&quot;]
            pl_condition_moving
        end
        subgraph measurements[&quot;Measurement plugins&quot;]
            pl_camera1
            pl_camera2
            pl_camera3
            pl_cpu
            pl_cmd_vel
            pl_memory
            pl_position
            pl_speed
            pl_storage
            pl_uptime
            pl_network
            pl_network_boot
            pl_os_boot
        end
    end

    subgraph g_n[&quot;Group node&quot;]
        gr_boot_system[&quot;System (boot)&quot;]
        gr_system[&quot;System&quot;]
        gr_robot[&quot;Robot&quot;]
        gr_inspection[&quot;Inspection&quot;]
    end

    subgraph d_n[&quot;Destination node&quot;]
        pl_pgsql[&quot;PostgreSQL&quot;]
        pl_minio[&quot;Minio&quot;]
        pl_s3[&quot;S3&quot;]
    end

    pl_camera1 -- if not --&gt; pl_condition_moving --&gt; gr_inspection
    pl_camera2 -- if not --&gt; pl_condition_moving --&gt; gr_inspection
    pl_camera3 -- if not --&gt; pl_condition_moving --&gt; gr_inspection
    pl_cpu --&gt; gr_system
    pl_memory --&gt; gr_system
    pl_uptime --&gt; gr_boot_system
    pl_network_boot --&gt; gr_boot_system
    pl_os_boot --&gt; gr_boot_system
    pl_storage --&gt; gr_system
    pl_cmd_vel --&gt; gr_robot
    pl_position --&gt; gr_robot
    pl_speed --&gt; gr_robot

    pl_network -- Network ping and online status --&gt; pl_pgsql
    gr_boot_system -- os, network interfaces\n, permissions and uptime --&gt; pl_pgsql
    gr_robot -- Robot cmd_vel, position. speed --&gt; pl_pgsql
    gr_system -- Available space,\n memory used and cpu usage --&gt; pl_pgsql
    gr_inspection -- Image paths on s3 and minio --&gt; pl_pgsql
    gr_inspection -- Raw, rotated and/or inspected images --&gt; pl_minio
    gr_inspection -- Raw, rotated and/or inspected images --&gt; pl_s3
</pre>
<h1 id="license"><a class="header" href="#license">License</a></h1>
<p>This program is under the terms of the <a href="https://www.mozilla.org/en-US/MPL/2.0/">Mozilla Public License Version 2.0</a>.</p>
<h1 id="about-and-contact"><a class="header" href="#about-and-contact">About and Contact</a></h1>
<p>For any inquiry, please contact David (<a href="mailto:d.bensoussan@proton.me">d.bensoussan@proton.me</a>). If your inquiry relates to bugs or open-source feature requests, consider posting a ticket on our GitHub project. If your inquiry relates to configuration support or private feature development, reach out and we will be able to support you in your projects.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/introduction.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="setup"><a class="header" href="#setup">Setup</a></h1>
<h2 id="use-docker"><a class="header" href="#use-docker">Use docker</a></h2>
<h3 id="available-images"><a class="header" href="#available-images">Available images</a></h3>
<p>Docker images with latest code are available on the <a href="https://hub.docker.com/repository/docker/minipada/ros2_data_collection">Docker public registry</a>:</p>
<div class="table-wrapper"><table><thead><tr><th>Image</th><th>Description</th></tr></thead><tbody>
<tr><td>minipada/ros2_data_collection:humble-ci</td><td>ROS base image augmented with all DC dependencies to use for CI</td></tr>
<tr><td>minipada/ros2_data_collection:humble-ci-testing</td><td>CI image using the ROS testing repository</td></tr>
<tr><td>minipada/ros2_data_collection:humble-source</td><td>DC source compiled</td></tr>
<tr><td>minipada/ros2_data_collection:humble-source-sim</td><td>DC source compiled with all simulation packages</td></tr>
<tr><td>minipada/ros2_data_collection:humble-doc</td><td>Documentation</td></tr>
</tbody></table>
</div>
<p>Get any by running:</p>
<pre><code class="language-bash">$ docker pull minipada/ros2_data_collection:&lt;TAG&gt;
</code></pre>
<h3 id="docker-workflow"><a class="header" href="#docker-workflow">Docker workflow</a></h3>
<p>When developing, use the <em>source-sim</em> image with a docker compose file. The latest one is available on the repository:</p>
<pre><code class="language-yaml">version: &quot;3.9&quot;

services:
  ros2-data-collection:
    image: minipada/ros2_data_collection:humble-source-sim
    privileged: true
    container_name: ros2-data-collection
    environment:
      - QT_X11_NO_MITSHM=1
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=compute,utility,display
      - DISPLAY=unix$DISPLAY
      - XAUTHORITY=$XAUTHORITY
    volumes:
      - ${HOME}/.Xauthority:/root/.Xauthority
      - /tmp/.X11-unix:/tmp/.X11-unix
      - /var/run/docker.sock:/var/run/docker.sock
      - ${PWD}:/root/ws/src/ros2_data_collection
    network_mode: &quot;host&quot;
    restart: &quot;unless-stopped&quot;
    stop_grace_period: &quot;3s&quot;
    runtime: nvidia
    command: tail -F anything
    working_dir: /root/ws
</code></pre>
<p>Then, to allow GUI (RViz, Gazebo) to work in the container, execute:</p>
<pre><code class="language-bash">$ xhost +
</code></pre>
<p>Then start the container:</p>
<pre><code class="language-bash">$ docker compose up -d
</code></pre>
<p>And get in the container with:</p>
<pre><code class="language-bash">$ docker exec -it ros2-data-collection /ros_entrypoint.sh bash
</code></pre>
<h2 id="build-from-source"><a class="header" href="#build-from-source">Build from source</a></h2>
<h3 id="download-the-repository"><a class="header" href="#download-the-repository">Download the repository</a></h3>
<p>Given that there is no apt packages available, you will need to build from source.</p>
<p>Download the repository in your workspace</p>
<pre><code class="language-bash">$ git clone github.com/minipada/ros2_data_collection.git
</code></pre>
<h3 id="install-dependencies"><a class="header" href="#install-dependencies">Install dependencies</a></h3>
<h4 id="install-system-and-cc-dependencies"><a class="header" href="#install-system-and-cc-dependencies">Install system and C/C++ dependencies</a></h4>
<pre><code>$ rosdep install --from-paths src --ignore-src -r -y
</code></pre>
<p>Some packages are external C++ packages but a vendor package has been included in the repository so colcon will handle it.
In addition, since this set of packages has no python external dependencies, you won't need anything else.</p>
<h4 id="install-python-dependencies"><a class="header" href="#install-python-dependencies">Install python dependencies</a></h4>
<p>This project uses <a href="https://python-poetry.org/">poetry</a> to manage python dependencies. It is easy to use and it is possible to set each package version like in a requirements.txt and manage multiple python environments.
If you have poetry on your machine, you can execute:</p>
<p><code>$ poetry install</code></p>
<p>If not, you can install python dependencies from the provided requirements.txt:</p>
<p><code>$ pip3 install -r requirements.txt</code></p>
<h3 id="build"><a class="header" href="#build">Build</a></h3>
<pre><code class="language-bash">$ colcon build
</code></pre>
<h3 id="run"><a class="header" href="#run">Run</a></h3>
<pre><code class="language-bash">source install/setup.bash
ros2 launch dc_bringup bringup.launch.py
</code></pre>
<h2 id="issues"><a class="header" href="#issues">Issues</a></h2>
<p>If you run into any issues when building ROS 2 Data Collection, you can use the search tool in the issues tab on <a href="https://github.com/minipada/ros2_data_collection">GitHub</a> and always feel free to <a href="https://github.com/minipada/ros2_data_collection">open a ticket</a>.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/setup.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="demos"><a class="header" href="#demos">Demos</a></h1>
<p>We will go together through some demos to get started with DC. You shall find them in the <em><a href="https://github.com/minipada/ros2_data_collection/tree/humble/dc_demos">dc_demos</a></em> package</p>
<div id="admonition-warning" class="admonition warning">
<div class="admonition-title">
<p>Warning</p>
<p><a class="admonition-anchor-link" href="dc/demos.html#admonition-warning"></a></p>
</div>
<div>
<p>Make sure you <a href="dc/./build.html">built and sourced</a> the workspace.</p>
</div>
</div>
<div id="admonition-info" class="admonition info">
<div class="admonition-title">
<p>Info</p>
<p><a class="admonition-anchor-link" href="dc/demos.html#admonition-info"></a></p>
</div>
<div>
<p>Have you checked the <a href="dc/./configuration_examples.html">configuration examples</a> before running the demos? They will help understand how the demo configuration work.</p>
</div>
</div>
<div class="table-wrapper"><table><thead><tr><th>Title</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="dc/./demos/uptime_stdout.html">Uptime</a></td><td>Collect how long the system has been running and print it on Stdout. Minimal example</td></tr>
<tr><td><a href="dc/./demos/memory_uptime_stdout.html">Group memory and uptime</a></td><td>Collect both memory and uptime and group them in a dictionary</td></tr>
<tr><td><a href="dc/./demos/tb3_stdout.html">Turtlebot3 Stdout</a></td><td>Collect command velocity, map, position and speed and print it in stdout</td></tr>
<tr><td><a href="dc/./demos/tb3_aws_minio_pgsql.html">Turtlebot3 AWS Warehouse MinIO PostgreSQL</a></td><td>Collect system, robot, environment and infrastructure data and send it to MinIO and PostgreSQL</td></tr>
<tr><td><a href="dc/./demos/tb3_aws_influxdb.html">Turtlebot3 AWS Warehouse InfluxDB</a></td><td>Collect system, robot, environment and infrastructure data and send it to InfluxDB</td></tr>
<tr><td><a href="dc/./demos/qrcodes_minio_pgsql.html">Turtlebot3 QR codes</a></td><td>Collect QR codes and images</td></tr>
<tr><td><a href="dc/./demos/custom_stdout.html">Custom plugin</a></td><td>Create an external plugin</td></tr>
</tbody></table>
</div>
<p>Note that each demo assumes concepts explained in previous demos will be acknowledged.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/demos.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="uptime-to-stdout"><a class="header" href="#uptime-to-stdout">Uptime to stdout</a></h1>
<p>This is the most minimal example to run DC, it collects the system uptime every 5 seconds and sends it to Stdout.</p>
<p>Let's run it:</p>
<pre><code class="language-bash">$ ros2 launch dc_demos uptime_stdout.launch.py
</code></pre>
<p>At the end, the data is displayed:</p>
<pre><code>[component_container_isolated-1] [{&quot;date&quot;:1677668906.745817,&quot;time&quot;:92395,&quot;id&quot;:&quot;be781e5ffb1e7ee4f817fe7b63e92c32&quot;,&quot;robot_name&quot;:&quot;C3PO&quot;,&quot;run_id&quot;:&quot;218&quot;}]
[component_container_isolated-1] [{&quot;date&quot;:1677668911.700309,&quot;time&quot;:92400,&quot;id&quot;:&quot;be781e5ffb1e7ee4f817fe7b63e92c32&quot;,&quot;robot_name&quot;:&quot;C3PO&quot;,&quot;run_id&quot;:&quot;218&quot;}]
[component_container_isolated-1] [{&quot;date&quot;:1677668916.70031,&quot;time&quot;:92405,&quot;id&quot;:&quot;be781e5ffb1e7ee4f817fe7b63e92c32&quot;,&quot;robot_name&quot;:&quot;C3PO&quot;,&quot;run_id&quot;:&quot;218&quot;}]
[component_container_isolated-1] [{&quot;date&quot;:1677668921.700388,&quot;time&quot;:92410,&quot;id&quot;:&quot;be781e5ffb1e7ee4f817fe7b63e92c32&quot;,&quot;robot_name&quot;:&quot;C3PO&quot;,&quot;run_id&quot;:&quot;218&quot;}]
[component_container_isolated-1] [{&quot;date&quot;:1677668926.700422,&quot;time&quot;:92415,&quot;id&quot;:&quot;be781e5ffb1e7ee4f817fe7b63e92c32&quot;,&quot;robot_name&quot;:&quot;C3PO&quot;,&quot;run_id&quot;:&quot;218&quot;}]
</code></pre>
<p>This launchfile is a wrapper of <a href="https://github.com/Minipada/ros2_data_collection/blob/humble/dc_bringup/launch/dc_bringup.launch.py">dc_bringup/launch/bringup.launch.py</a> which loads a <a href="https://github.com/Minipada/ros2_data_collection/blob/humble/dc_demos/params/uptime_stdout.yaml">custom yaml configuration</a></p>
<h2 id="configuration"><a class="header" href="#configuration">Configuration</a></h2>
<h3 id="measurement"><a class="header" href="#measurement">Measurement</a></h3>
<pre><code class="language-yaml">measurement_server:
  ros__parameters:
    measurement_plugins: [&quot;uptime&quot;]
    uptime:
      plugin: &quot;dc_measurements/Uptime&quot;
      topic_output: &quot;/dc/measurement/uptime&quot;
      polling_interval: 5000
      enable_validator: true
      debug: true
      tags: [&quot;flb_stdout&quot;]
      init_collect: true
    custom_str_params_list: [&quot;robot_name&quot;, &quot;id&quot;]
    custom_str_params:
      robot_name:
        name: robot_name
        value: C3PO
      id:
        name: id
        value_from_file: /etc/machine-id
    run_id:
      enabled: true
      counter: true
      counter_path: &quot;$HOME/run_id&quot;
      uuid: false
</code></pre>
<p><strong>measurement_plugins (Mandatory)</strong>: List all the plugins to enable. This is a custom string that is equal to the measurement plugin dictionary present in the same level. If not listed, will not be loaded.</p>
<p><strong>uptime.plugin (Mandatory)</strong>: Name of the plugin, if you are not sure which plugin is available, <a href="dc/demos/../cli.html">use the CLI tool</a> to list them</p>
<p><strong>uptime.tags (Mandatory)</strong>: This is used by Fluent Bit, to match inputs and outputs. More <a href="dc/demos/../concepts.html#tags">here</a></p>
<p><strong>uptime.polling_interval (Optional)</strong>: Interval to which data is collected in milliseconds</p>
<p><strong>uptime.enable_validator (Optional)</strong>: Will validate the data against a JSON schema. This file is located in the <a href="https://github.com/Minipada/ros2_data_collection/tree/humble/dc_measurements/plugins/measurements/json">dc_measurements package</a>. You can provide your own using the <code>json_schema_path</code> parameter, which we will explore later on</p>
<p><strong>uptime.debug (Optional)</strong>: More verbose output</p>
<p><strong>uptime.init_collect (Optional)</strong>: Collect when the node starts instead of waiting for the polling_interval time to pass</p>
<p><strong>run_id.enabled (Optional)</strong>: Identify which run the robot is. A new one is generated at every start of the node. Uses either a counter that increment at each restart of the node or UUID</p>
<p><strong>run_id.counter (Optional)</strong>: Enable counter for the run_id</p>
<p><strong>run_id.counter_path (Optional)</strong>: Path to store the last run. It is expanded with environment variables id</p>
<p><strong>run_id.uuid (Optional)</strong>: Generate a new run ID by using a random UUID</p>
<p>This will collect the uptime every 5 seconds (including when the node starts), will forward it to the <em>flb_stdout</em> destination.</p>
<h4 id="inject-custom-data-for-each-record"><a class="header" href="#inject-custom-data-for-each-record">Inject custom data for each record</a></h4>
<p>Here, we want to append some content in every record: the robot name and its ID. While the robot name comes from a fixed variable in the parameter file, the id comes from the machine-id file.</p>
<p><strong>custom_str_params_list (Optional)</strong>: Look for those keys in this configuration to add them as keys and values in each record.</p>
<p><strong>custom_str_params.robot_name (Optional)</strong>: This parameter is loaded since it is mentioned in custom_str_params_list</p>
<p><strong>custom_str_params.robot_name.name (Optional)</strong>: Key in the dictionary to add</p>
<p><strong>custom_str_params.robot_name.value (Optional)</strong>: Value associated to the key in the dictionary to add</p>
<p><strong>custom_str_params.id.name (Optional)</strong>: Key in the dictionary to add</p>
<p><strong>custom_str_params.id.value_from_file (Optional)</strong>: Value associated to the key in the dictionary to add taken from the content of a file</p>
<div id="admonition-info" class="admonition info">
<div class="admonition-title">
<p>Info</p>
<p><a class="admonition-anchor-link" href="dc/demos/uptime_stdout.html#admonition-info"></a></p>
</div>
<div>
<p>Note that this configuration alone, sent to Fluent Bit will not display the JSON on stdout since it requires the destination_server configuration</p>
</div>
</div>
<p>Find the complete measurements documentation <a href="dc/demos/../measurements.html">here</a></p>
<h3 id="destination"><a class="header" href="#destination">Destination</a></h3>
<pre><code class="language-yaml">destination_server:
  ros__parameters:
    flb:
      flush: 1
      flb_grace: 1
      log_level: &quot;info&quot;
      storage_path: &quot;/var/log/flb-storage/&quot;
      storage_sync: &quot;full&quot;
      storage_checksum: &quot;off&quot;
      storage_backlog_mem_limit: &quot;1M&quot;
      scheduler_cap: 200
      scheduler_base: 5
      http_server: true
      http_listen: &quot;0.0.0.0&quot;
      http_port: 2020
      in_storage_type: &quot;filesystem&quot;
      in_storage_pause_on_chunks_overlimit: &quot;off&quot;
    destination_plugins: [&quot;flb_stdout&quot;]
    flb_stdout:
      plugin: &quot;dc_destinations/FlbStdout&quot;
      inputs: [&quot;/dc/measurement/uptime&quot;]
      time_format: &quot;double&quot;
      time_key: &quot;date&quot;
      debug: false
</code></pre>
<h4 id="destinations"><a class="header" href="#destinations">Destinations</a></h4>
<p>Let's analyze piece by piece. First, we select the plugin to enable, create its section containing the plugin name and the topic to subscribe to. We need the topic list because in the background, the ROS 2 Fluent Bit plugin subscribes to each topic.</p>
<p><strong>destination_plugins (Mandatory)</strong>: List all the plugins to enable. This is a custom string that is equal to the destination plugin dictionary present in the same level. If not listed, will not be loaded.</p>
<p><strong>flb_stdout.plugin (Mandatory)</strong>: Plugin to load</p>
<p><strong>flb_stdout.inputs (Mandatory)</strong>: Topics to which to listen to get the data</p>
<p><strong>flb_stdout.time_format (Optional)</strong>: Format the data will be printed</p>
<p><strong>flb_stdout.time_key (Optional)</strong>: Dictionary key from which date will be taken from</p>
<p><strong>flb_stdout.debug (Optional)</strong>: Verbose output</p>
<h4 id="fluent-bit"><a class="header" href="#fluent-bit">Fluent Bit</a></h4>
<p>Then, we configure Fluent Bit. This is not necessary but it is easy to do by using the ros parameters provided by the node.</p>
<p><strong>flb.flush (Optional)</strong>: Interval to flush output (seconds)</p>
<p><strong>flb.flb_grace (Optional)</strong>: Wait time (seconds) on exit</p>
<p><strong>flb.log_level (Optional)</strong>: Diagnostic level (error/warning/info/debug/trace)</p>
<p><strong>flb.storage_path (Optional)</strong>: Set an optional location in the file system to store streams and chunks of data. If this parameter is not set, Input plugins can only use in-memory buffering.</p>
<p><strong>flb.storage_sync (Optional)</strong>: Configure the synchronization mode used to store the data into the file system. It can take the values normal or full.</p>
<p><strong>flb.storage_checksum (Optional)</strong>: Enable the data integrity check when writing and reading data from the filesystem. The storage layer uses the CRC32 algorithm.</p>
<p><strong>flb.storage_backlog_mem_limit (Optional)</strong>: If storage.path is set, Fluent Bit will look for data chunks that were not delivered and are still in the storage layer, these are called backlog data. This option configure a hint of maximum value of memory to use when processing these records.</p>
<p><strong>flb.scheduler_cap (Optional)</strong>: Set a maximum retry time in seconds. The property is supported from v1.8.7.</p>
<p><strong>flb.scheduler_base (Optional)</strong>: Set a base of exponential backoff. The property is supported from v1.8.7.</p>
<p><strong>flb.http_server (Optional)</strong>: If true enable statistics HTTP server</p>
<p><strong>flb.http_listen (Optional)</strong>: Address to listen (e.g. 0.0.0.0)</p>
<p><strong>flb.http_port (Optional)</strong>: Port to listen (e.g. 8888)</p>
<p><strong>flb.in_storage_type (Optional)</strong>: Specifies the buffering mechanism to use. It can be memory or filesystem.</p>
<p><strong>flb.in_storage_pause_on_chunks_overlimit (Optional)</strong>: Specifies if file storage is to be paused when reaching the chunk limit.</p>
<h4 id="inject-run-id-at-each-record"><a class="header" href="#inject-run-id-at-each-record">Inject run id at each record</a></h4>
<p>Finally, we set the run id. This is used later on when fetching data for a run. It can come from a counter which is incremented at each start of the node or from a random UUID generated. The counter mechanism writes and read on a file on the system (take care of not deleting it), you can set its path as a parameter.</p>
<p>Find the complete destinations documentation <a href="dc/demos/../destinations.html">here</a></p>
<h2 id="console-output"><a class="header" href="#console-output">Console output</a></h2>
<p>Now that the node started, let us see what's displayed in the console</p>
<pre><code>[component_container_isolated-1] [INFO] [1677668906.621492168] [dc_container]: Load Library: /root/ws/install/dc_measurements/lib/libmeasurement_server_core.so
[component_container_isolated-1] [INFO] [1677668906.634130562] [dc_container]: Found class: rclcpp_components::NodeFactoryTemplate&lt;measurement_server::MeasurementServer&gt;
[component_container_isolated-1] [INFO] [1677668906.634246977] [dc_container]: Instantiate class: rclcpp_components::NodeFactoryTemplate&lt;measurement_server::MeasurementServer&gt;
[component_container_isolated-1] [INFO] [1677668906.655803692] [measurement_server]:
	measurement_server lifecycle node launched.
	Waiting on external lifecycle transitions to activate
	See https://design.ros2.org/articles/node_lifecycle.html for more information.
[component_container_isolated-1] [INFO] [1677668906.670233932] [dc_container]: Load Library: /root/ws/install/dc_destinations/lib/libdestination_server_core.so
[component_container_isolated-1] [INFO] [1677668906.675826543] [dc_container]: Found class: rclcpp_components::NodeFactoryTemplate&lt;destination_server::DestinationServer&gt;
[component_container_isolated-1] [INFO] [1677668906.675864319] [dc_container]: Instantiate class: rclcpp_components::NodeFactoryTemplate&lt;destination_server::DestinationServer&gt;
[component_container_isolated-1] [INFO] [1677668906.680499515] [destination_server]:
[component_container_isolated-1] 	destination_server lifecycle node launched.
[component_container_isolated-1] 	Waiting on external lifecycle transitions to activate
[component_container_isolated-1] 	See https://design.ros2.org/articles/node_lifecycle.html for more information.
[INFO] [launch_ros.actions.load_composable_nodes]: Loaded node '/destination_server' in container 'dc_container'
[component_container_isolated-1] [INFO] [1677668906.684802172] [dc_container]: Load Library: /opt/ros/humble/lib/libnav2_lifecycle_manager_core.so
[component_container_isolated-1] [INFO] [1677668906.685487672] [dc_container]: Found class: rclcpp_components::NodeFactoryTemplate&lt;nav2_lifecycle_manager::LifecycleManager&gt;
[component_container_isolated-1] [INFO] [1677668906.685510016] [dc_container]: Instantiate class: rclcpp_components::NodeFactoryTemplate&lt;nav2_lifecycle_manager::LifecycleManager&gt;
[component_container_isolated-1] [INFO] [1677668906.691075881] [lifecycle_manager_navigation]: Creating
[INFO] [launch_ros.actions.load_composable_nodes]: Loaded node '/lifecycle_manager_navigation' in container 'dc_container'
[component_container_isolated-1] [INFO] [1677668906.692954854] [lifecycle_manager_navigation]: Creating and initializing lifecycle service clients
[component_container_isolated-1] [INFO] [1677668906.695025050] [lifecycle_manager_navigation]: Starting managed nodes bringup...
</code></pre>
<p>Measurement server and destination server are starting in the Lifecycle, you can read more about it <a href="dc/demos/../concepts.html#lifecycle-nodes-and-bond">here</a></p>
<p>Afterward, the measurement_server starts:</p>
<pre><code>[component_container_isolated-1] [INFO] [1677668906.695056624] [lifecycle_manager_navigation]: Configuring measurement_server
[component_container_isolated-1] [INFO] [1677668906.695181755] [measurement_server]: Configuring
[component_container_isolated-1] [INFO] [1677668906.698019687] [measurement_server]: Creating measurement plugin uptime: Type dc_measurements/Uptime, Group key: uptime, Polling interval: 5000, Debug: 1, Validator enabled: 1, Schema path: , Tags: [flb_stdout], Init collect: 1, Init Max measurement: 0, Include measurement name: 0, Include measurement plugin name: 0, Remote keys: , Remote prefixes: , Include measurement plugin name: 0, Max measurement on condition: 0, If all condition: , If any condition: , If none condition:
[component_container_isolated-1] [INFO] [1677668906.698932685] [measurement_server]: Configuring uptime
[component_container_isolated-1] [INFO] [1677668906.699937310] [measurement_server]: Done configuring uptime
[component_container_isolated-1] [INFO] [1677668906.700162355] [measurement_server]: Looking for schema at /root/ws/install/dc_measurements/share/dc_measurements/plugins/measurements/json/uptime.json
[component_container_isolated-1] [INFO] [1677668906.700192161] [measurement_server]: schema: {&quot;$schema&quot;:&quot;http://json-schema.org/draft-07/schema#&quot;,&quot;description&quot;:&quot;Time the system has been up&quot;,&quot;properties&quot;:{&quot;time&quot;:{&quot;description&quot;:&quot;Time the system has been up&quot;,&quot;minimum&quot;:0,&quot;type&quot;:&quot;integer&quot;}},&quot;title&quot;:&quot;Uptime&quot;,&quot;type&quot;:&quot;object&quot;}
</code></pre>
<p>Plugins are loaded one by one (here only one is, the uptime one) and configured. The configuration for each is displayed and the validation schema is also loaded and its path printed.</p>
<p>Then, the destination_server starts:</p>
<pre><code>[component_container_isolated-1] [INFO] [1677668906.700528260] [lifecycle_manager_navigation]: Configuring destination_server
[component_container_isolated-1] [INFO] [1677668906.700620104] [destination_server]: Configuring
[component_container_isolated-1] [INFO] [1677668906.701246047] [destination_server]: Fluent Bit service initialized
[component_container_isolated-1] [INFO] [1677668906.701470896] [destination_server]: Creating destination plugin flb_stdout: Type dc_destinations/FlbStdout, Debug: 0, Time format: double. Time key: date
[component_container_isolated-1] [INFO] [1677668906.702670279] [destination_server]: Configuring Flb plugin flb_stdout
[component_container_isolated-1] [INFO] [1677668906.702871127] [destination_server]: Loaded lua filter. Match=ros2, code=function concatenate(tag, timestamp, record) if (type(record[&quot;tags&quot;]) == &quot;table&quot;) then record[&quot;tags&quot;] = table.concat(record[&quot;tags&quot;], &quot;,&quot;) end  return 2, timestamp, record end
[component_container_isolated-1] [INFO] [1677668906.702912686] [destination_server]: Loaded rewrite_tag filter. Match=ros2, Rule=$tags .*(flb_stdout).* flb_stdout true
[component_container_isolated-1] [INFO] [1677668906.703021628] [destination_server]: Done configuring Flb plugin flb_stdout
[component_container_isolated-1] [INFO] [1677668906.703049312] [destination_server]: Loading input ros2 shared library /root/ws/install/fluent_bit_plugins/lib/flb-in_ros2.so...
[component_container_isolated-1] [INFO] [1677668906.703818806] [destination_server]: Loaded input ros2 shared library /root/ws/install/fluent_bit_plugins/lib/flb-in_ros2.so
[component_container_isolated-1] [INFO] [1677668906.703899346] [destination_server]: Flb ros2 plugin initialized. ret=0
[component_container_isolated-1] [INFO] [1677668906.703908977] [destination_server]: Starting Flb engine...
[component_container_isolated-1] [2023/03/01 11:08:26] [ info] [fluent bit] version=2.0.7, commit=1ab360f79c, pid=31126
[component_container_isolated-1] [2023/03/01 11:08:26] [ info] [storage] ver=1.3.0, type=memory+filesystem, sync=full, checksum=off, max_chunks_up=128
[component_container_isolated-1] [2023/03/01 11:08:26] [ info] [storage] backlog input plugin: storage_backlog.1
[component_container_isolated-1] [2023/03/01 11:08:26] [ info] [cmetrics] version=0.5.7
[component_container_isolated-1] [2023/03/01 11:08:26] [ info] [ctraces ] version=0.2.5
[component_container_isolated-1] [2023/03/01 11:08:26] [ info] [input:ros2:ros2.0] initializing
[component_container_isolated-1] [2023/03/01 11:08:26] [ info] [input:ros2:ros2.0] storage_strategy='filesystem' (memory + filesystem)
[component_container_isolated-1] [2023/03/01 11:08:26] [ info] Started node fluentbit_rclc
[component_container_isolated-1] [2023/03/01 11:08:26] [ info] Created subscriber /dc/measurement/uptime
[component_container_isolated-1] [2023/03/01 11:08:26] [ info] [input:storage_backlog:storage_backlog.1] initializing
[component_container_isolated-1] [2023/03/01 11:08:26] [ info] [input:storage_backlog:storage_backlog.1] storage_strategy='memory' (memory only)
[component_container_isolated-1] [2023/03/01 11:08:26] [ info] [input:storage_backlog:storage_backlog.1] queue memory limit: 976.6K
[component_container_isolated-1] [2023/03/01 11:08:26] [ info] [input:emitter:emitter_for_rewrite_tag.2] initializing
[component_container_isolated-1] [2023/03/01 11:08:26] [ info] [input:emitter:emitter_for_rewrite_tag.2] storage_strategy='filesystem' (memory + filesystem)
[component_container_isolated-1] [2023/03/01 11:08:26] [ info] [output:stdout:stdout.0] worker #0 started
[component_container_isolated-1] [2023/03/01 11:08:26] [ info] [http_server] listen iface=0.0.0.0 tcp_port=2020
[component_container_isolated-1] [2023/03/01 11:08:26] [ info] [sp] stream processor started
[component_container_isolated-1] [INFO] [1677668906.744577163] [destination_server]: Started Flb engine
</code></pre>
<p>It starts the <a href="dc/demos/../destinations/flb_stdout.html">FlbStdout destination plugin</a>, filters used internally by Fluent to edit Timestamps and tags. It then loads the ROS 2 Fluent Bit shared library and initialize it with the topics we provided as parameter.</p>
<p>Afterward, Fluent Bit starts, it prints its version, storage strategy and buffer configuration and lists which plugins are loaded.</p>
<p>Then, the measurement and destination server nodes are activated:</p>
<pre><code>[component_container_isolated-1] [INFO] [1677668906.745180268] [lifecycle_manager_navigation]: Activating measurement_server
[component_container_isolated-1] [INFO] [1677668906.745462265] [measurement_server]: Activating
[component_container_isolated-1] [INFO] [1677668906.745558665] [measurement_server]: Activating uptime
[component_container_isolated-1] [INFO] [1677668906.746014639] [measurement_server]: Creating bond (measurement_server) to lifecycle manager.
[component_container_isolated-1] [INFO] [1677668906.853199899] [lifecycle_manager_navigation]: Server measurement_server connected with bond.
[component_container_isolated-1] [INFO] [1677668906.853316226] [lifecycle_manager_navigation]: Activating destination_server
[component_container_isolated-1] [INFO] [1677668906.853620571] [destination_server]: Activating
[component_container_isolated-1] [INFO] [1677668906.853722659] [destination_server]: Activating flb_stdout
[component_container_isolated-1] [INFO] [1677668906.853796078] [destination_server]: Creating bond (destination_server) to lifecycle manager.
[component_container_isolated-1] [INFO] [1677668906.961666207] [lifecycle_manager_navigation]: Server destination_server connected with bond.
[component_container_isolated-1] [INFO] [1677668906.961777773] [lifecycle_manager_navigation]: Managed nodes are active
[component_container_isolated-1] [INFO] [1677668906.961820078] [lifecycle_manager_navigation]: Creating bond timer...
</code></pre>
<p>Finally, we see the data:</p>
<pre><code>[component_container_isolated-1] [{&quot;date&quot;:1677668906.745817,&quot;time&quot;:92395,&quot;id&quot;:&quot;be781e5ffb1e7ee4f817fe7b63e92c32&quot;,&quot;robot_name&quot;:&quot;C3PO&quot;,&quot;run_id&quot;:&quot;218&quot;}]
[component_container_isolated-1] [{&quot;date&quot;:1677668911.700309,&quot;time&quot;:92400,&quot;id&quot;:&quot;be781e5ffb1e7ee4f817fe7b63e92c32&quot;,&quot;robot_name&quot;:&quot;C3PO&quot;,&quot;run_id&quot;:&quot;218&quot;}]
[component_container_isolated-1] [{&quot;date&quot;:1677668916.70031,&quot;time&quot;:92405,&quot;id&quot;:&quot;be781e5ffb1e7ee4f817fe7b63e92c32&quot;,&quot;robot_name&quot;:&quot;C3PO&quot;,&quot;run_id&quot;:&quot;218&quot;}]
[component_container_isolated-1] [{&quot;date&quot;:1677668921.700388,&quot;time&quot;:92410,&quot;id&quot;:&quot;be781e5ffb1e7ee4f817fe7b63e92c32&quot;,&quot;robot_name&quot;:&quot;C3PO&quot;,&quot;run_id&quot;:&quot;218&quot;}]
[component_container_isolated-1] [{&quot;date&quot;:1677668926.700422,&quot;time&quot;:92415,&quot;id&quot;:&quot;be781e5ffb1e7ee4f817fe7b63e92c32&quot;,&quot;robot_name&quot;:&quot;C3PO&quot;,&quot;run_id&quot;:&quot;218&quot;}]
</code></pre>
<p>So...what happened?</p>
<ol>
<li>The measurement plugin starts publishing data to /dc/measurement/uptime, which contains the JSON, tags and timestamp of the message</li>
<li>Run ID and robot_name is appended in the JSON</li>
<li>The ROS 2 Fluent Bit plugin, which subscribes to this topic, receive the data and pass it on to Fluent Bit</li>
<li>Fluent Bit receives it, applies the timestamp filter (which modifies the timestamp to the desired format)</li>
<li>Fluent Bit applies changes the tag with another filter. This tag is used to match to the destination afterward.</li>
<li>Data is flushed</li>
<li>The Fluent Bit stdout output plugin receives the data because tags match (the flb_stdout tag is used) and forwards it to Stdout</li>
</ol>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/demos/uptime_stdout.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="group-memory-and-uptime"><a class="header" href="#group-memory-and-uptime">Group memory and uptime</a></h1>
<p>This demo will introduce the group node. It subscribes to multiple nodes and group for each its data and republishes on a new topic.</p>
<p>Let's run it:</p>
<pre><code class="language-bash">$ ros2 launch dc_demos group_memory_uptime_stdout.launch.py
</code></pre>
<pre><code>[component_container_isolated-1] [{&quot;memory&quot;:{&quot;used&quot;:71.67569732666016},&quot;date&quot;:1677673405.921659,&quot;uptime&quot;:{&quot;time&quot;:96894},&quot;run_id&quot;:&quot;221&quot;}]
[component_container_isolated-1] [{&quot;memory&quot;:{&quot;used&quot;:71.70790100097656},&quot;date&quot;:1677673408.868847,&quot;uptime&quot;:{&quot;time&quot;:96897},&quot;run_id&quot;:&quot;221&quot;}]
[component_container_isolated-1] [{&quot;memory&quot;:{&quot;used&quot;:71.72582244873047},&quot;date&quot;:1677673411.869299,&quot;uptime&quot;:{&quot;time&quot;:96900},&quot;run_id&quot;:&quot;221&quot;}]
[component_container_isolated-1] [{&quot;memory&quot;:{&quot;used&quot;:71.86643218994141},&quot;date&quot;:1677673414.869292,&quot;uptime&quot;:{&quot;time&quot;:96903},&quot;run_id&quot;:&quot;221&quot;}]
[component_container_isolated-1] [{&quot;memory&quot;:{&quot;used&quot;:71.82553863525391},&quot;date&quot;:1677673417.869207,&quot;uptime&quot;:{&quot;time&quot;:96906},&quot;run_id&quot;:&quot;221&quot;}]
</code></pre>
<p>This launchfile is a wrapper of <a href="https://github.com/Minipada/ros2_data_collection/blob/humble/dc_bringup/launch/dc_bringup.launch.py">dc_bringup/launch/bringup.launch.py</a> which loads a <a href="https://github.com/Minipada/ros2_data_collection/blob/humble/dc_demos/params/group_memory_uptime_stdout.yaml">custom yaml configuration</a></p>
<div id="admonition-info" class="admonition info">
<div class="admonition-title">
<p>Info</p>
<p><a class="admonition-anchor-link" href="dc/demos/memory_uptime_stdout.html#admonition-info"></a></p>
</div>
<div>
<p>Note that here the group node is started. It is one parameter in the launchfile to enable it. In the <a href="dc/demos/./uptime_stdout.html">uptime demo</a>, it is disabled by default because it is not used.</p>
</div>
</div>
<h2 id="configuration-1"><a class="header" href="#configuration-1">Configuration</a></h2>
<h3 id="measurement-1"><a class="header" href="#measurement-1">Measurement</a></h3>
<p>We collect data from 2 plugins: memory and uptime. The first every second and the latter every 3.</p>
<pre><code class="language-yaml">measurement_server:
  ros__parameters:
    measurement_plugins: [&quot;memory&quot;, &quot;uptime&quot;]
    memory:
      plugin: &quot;dc_measurements/Memory&quot;
      group_key: &quot;memory&quot;
      topic_output: &quot;/dc/measurement/memory&quot;
      polling_interval: 1000
    uptime:
      plugin: &quot;dc_measurements/Uptime&quot;
      group_key: &quot;uptime&quot;
      topic_output: &quot;/dc/measurement/uptime&quot;
      polling_interval: 3000
</code></pre>
<p>Data is now published on 2 ROS topics: /dc/measurement/uptime and /dc/measurement/memory.</p>
<p>The <code>group_key</code> mentioned will be used by the group node to assign a key in the new dictionary</p>
<h3 id="group"><a class="header" href="#group">Group</a></h3>
<p>This create a memory_uptime group, subscribes to <code>/dc/measurement/memory</code> and <code>/dc/measurement/uptime</code> topics and republish the result on <code>/dc/group/memory_uptime</code>. The sync_delay allows to wait in a 5 seconds window timeframe the data from each topic before throwing away the data if one topic does not publish it</p>
<pre><code class="language-yaml">group_server:
  ros__parameters:
    groups: [&quot;memory_uptime&quot;]
    memory_uptime:
      inputs: [&quot;/dc/measurement/memory&quot;, &quot;/dc/measurement/uptime&quot;]
      output: &quot;/dc/group/memory_uptime&quot;
      sync_delay: 5.0
      group_key: &quot;memory_uptime&quot;
      tags: [&quot;flb_stdout&quot;]
      include_group_name: false
</code></pre>
<p><strong>include_group_name (Optional)</strong>: Will include the name of the group in the JSON, it makes it easier later on to fetch the data from your API. In this case, we can skip it since we only have one group to show.</p>
<p>You can also notice that the group also has a &quot;group_key&quot;. It means a group can be part of another.</p>
<h3 id="destination-1"><a class="header" href="#destination-1">Destination</a></h3>
<p>Here, we only subscribe to the <code>/dc/group/memory_uptime</code> topic</p>
<pre><code class="language-yaml">    flb_stdout:
      plugin: &quot;dc_destinations/FlbStdout&quot;
      inputs: [&quot;/dc/group/memory_uptime&quot;]
</code></pre>
<h2 id="console-output-1"><a class="header" href="#console-output-1">Console output</a></h2>
<p>In the terminal, you can see the result, published every 3 seconds (see the date field), which the is timeframe defined by sync_delay and the maximum polling_interval of the measurements.</p>
<p>Finally, note the new dictionary uses the key defined in the <code>group_key</code> measurement_server plugin configuration. They are transferred through the ROS message.</p>
<pre><code>[component_container_isolated-1] [{&quot;memory&quot;:{&quot;used&quot;:71.67569732666016},&quot;date&quot;:1677673405.921659,&quot;uptime&quot;:{&quot;time&quot;:96894},&quot;run_id&quot;:&quot;221&quot;}]
[component_container_isolated-1] [{&quot;memory&quot;:{&quot;used&quot;:71.70790100097656},&quot;date&quot;:1677673408.868847,&quot;uptime&quot;:{&quot;time&quot;:96897},&quot;run_id&quot;:&quot;221&quot;}]
[component_container_isolated-1] [{&quot;memory&quot;:{&quot;used&quot;:71.72582244873047},&quot;date&quot;:1677673411.869299,&quot;uptime&quot;:{&quot;time&quot;:96900},&quot;run_id&quot;:&quot;221&quot;}]
[component_container_isolated-1] [{&quot;memory&quot;:{&quot;used&quot;:71.86643218994141},&quot;date&quot;:1677673414.869292,&quot;uptime&quot;:{&quot;time&quot;:96903},&quot;run_id&quot;:&quot;221&quot;}]
[component_container_isolated-1] [{&quot;memory&quot;:{&quot;used&quot;:71.82553863525391},&quot;date&quot;:1677673417.869207,&quot;uptime&quot;:{&quot;time&quot;:96906},&quot;run_id&quot;:&quot;221&quot;}]
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/demos/memory_uptime_stdout.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="turtlebot3"><a class="header" href="#turtlebot3">Turtlebot3</a></h1>
<p>In this example, we add a robot and start collecting robot data to Stdout.</p>
<p>You will also need 2 terminal windows, to:</p>
<ol>
<li>Run the Nav2 turtlebot3 launchfile: it starts localization, navigation and RViz</li>
<li>Run DC</li>
</ol>
<p>Since RViz is pretty verbose, using 2 terminal windows will help reading the JSON printed on the terminal window.</p>
<h2 id="setup-the-environment"><a class="header" href="#setup-the-environment">Setup the environment</a></h2>
<p>In each, terminal, source your environment and setup turtlebot configuration:</p>
<pre><code class="language-bash">$ source /opt/ros/humble/setup.bash
$ source install/setup.bash
$ export GAZEBO_MODEL_PATH=$GAZEBO_MODEL_PATH:/opt/ros/humble/share/turtlebot3_gazebo/models
$ export TURTLEBOT3_MODEL=waffle
</code></pre>
<h2 id="start-navigation"><a class="header" href="#start-navigation">Start Navigation</a></h2>
<p>Then, start the Turtlebot launchfile:</p>
<pre><code class="language-bash">$ ros2 launch nav2_bringup tb3_simulation_launch.py headless:=False
</code></pre>
<p>RViz and Gazebo will start: you should now see the robot in Gazebo, and the map on RViz.</p>
<p>Set the robot position using the &quot;2D Pose Estimate&quot; button.</p>
<div id="admonition-info" class="admonition info">
<div class="admonition-title">
<p>Info</p>
<p><a class="admonition-anchor-link" href="dc/demos/tb3_stdout.html#admonition-info"></a></p>
</div>
<div>
<p>If any problem occur, please take a look at the <a href="https://navigation.ros.org/getting_started/index.html#running-the-example">nav2 official documentation</a> which covers the case.</p>
</div>
</div>
<h2 id="start-dc"><a class="header" href="#start-dc">Start DC</a></h2>
<p>Execute</p>
<pre><code class="language-bash">$ ros2 launch dc_demos tb3_simulation_stdout.launch.py
</code></pre>
<p>At the end, the data is displayed:</p>
<pre><code>[component_container_isolated-1] [{&quot;date&quot;:1677690777.96911,&quot;width&quot;:384,&quot;height&quot;:384,&quot;remote_paths&quot;:{&quot;minio&quot;:{&quot;pgm&quot;:&quot;C3PO/2023/03/01/17/map/2023-03-01T17:12:57.pgm&quot;,&quot;yaml&quot;:&quot;C3PO/2023/03/01/17/map/2023-03-01T17:12:57.yaml&quot;}},&quot;resolution&quot;:0.05000000074505806,&quot;origin&quot;:{&quot;x&quot;:-10,&quot;y&quot;:-10},&quot;local_paths&quot;:{&quot;pgm&quot;:&quot;/root/dc_data/C3PO/2023/03/01/17/map/2023-03-01T17:12:57.pgm&quot;,&quot;yaml&quot;:&quot;/root/dc_data/C3PO/2023/03/01/17/map/2023-03-01T17:12:57.yaml&quot;},&quot;id&quot;:&quot;be781e5ffb1e7ee4f817fe7b63e92c32&quot;,&quot;robot_name&quot;:&quot;C3PO&quot;,&quot;run_id&quot;:&quot;234&quot;}]
[component_container_isolated-1] [{&quot;date&quot;:1677690782.883036,&quot;width&quot;:384,&quot;height&quot;:384,&quot;remote_paths&quot;:{&quot;minio&quot;:{&quot;pgm&quot;:&quot;C3PO/2023/03/01/17/map/2023-03-01T17:13:02.pgm&quot;,&quot;yaml&quot;:&quot;C3PO/2023/03/01/17/map/2023-03-01T17:13:02.yaml&quot;}},&quot;resolution&quot;:0.05000000074505806,&quot;origin&quot;:{&quot;x&quot;:-10,&quot;y&quot;:-10},&quot;local_paths&quot;:{&quot;pgm&quot;:&quot;/root/dc_data/C3PO/2023/03/01/17/map/2023-03-01T17:13:02.pgm&quot;,&quot;yaml&quot;:&quot;/root/dc_data/C3PO/2023/03/01/17/map/2023-03-01T17:13:02.yaml&quot;},&quot;id&quot;:&quot;be781e5ffb1e7ee4f817fe7b63e92c32&quot;,&quot;robot_name&quot;:&quot;C3PO&quot;,&quot;run_id&quot;:&quot;234&quot;}]
[component_container_isolated-1] [{&quot;position&quot;:{&quot;x&quot;:-0.7254206029057992,&quot;yaw&quot;:0.134098723062189,&quot;tags&quot;:[&quot;flb_stdout&quot;],&quot;y&quot;:-0.5116378019627142},&quot;cmd_vel&quot;:{&quot;tags&quot;:[&quot;flb_stdout&quot;],&quot;linear&quot;:{&quot;x&quot;:0.26,&quot;z&quot;:0,&quot;y&quot;:0},&quot;angular&quot;:{&quot;x&quot;:0,&quot;z&quot;:-0.157895,&quot;y&quot;:0}},&quot;speed&quot;:{&quot;tags&quot;:[&quot;flb_stdout&quot;],&quot;linear&quot;:{&quot;x&quot;:8.720555295508514e-05,&quot;z&quot;:0,&quot;y&quot;:4.219923511090644e-06},&quot;computed&quot;:8.730759543499989e-05,&quot;angular&quot;:{&quot;x&quot;:-0.0002958005596118955}},&quot;date&quot;:1677690787.878526,&quot;id&quot;:&quot;be781e5ffb1e7ee4f817fe7b63e92c32&quot;,&quot;robot_name&quot;:&quot;C3PO&quot;,&quot;run_id&quot;:&quot;234&quot;}]
[component_container_isolated-1] [{&quot;date&quot;:1677690787.883072,&quot;width&quot;:384,&quot;height&quot;:384,&quot;remote_paths&quot;:{&quot;minio&quot;:{&quot;pgm&quot;:&quot;C3PO/2023/03/01/17/map/2023-03-01T17:13:07.pgm&quot;,&quot;yaml&quot;:&quot;C3PO/2023/03/01/17/map/2023-03-01T17:13:07.yaml&quot;}},&quot;resolution&quot;:0.05000000074505806,&quot;origin&quot;:{&quot;x&quot;:-10,&quot;y&quot;:-10},&quot;local_paths&quot;:{&quot;pgm&quot;:&quot;/root/dc_data/C3PO/2023/03/01/17/map/2023-03-01T17:13:07.pgm&quot;,&quot;yaml&quot;:&quot;/root/dc_data/C3PO/2023/03/01/17/map/2023-03-01T17:13:07.yaml&quot;},&quot;id&quot;:&quot;be781e5ffb1e7ee4f817fe7b63e92c32&quot;,&quot;robot_name&quot;:&quot;C3PO&quot;,&quot;run_id&quot;:&quot;234&quot;}]
[component_container_isolated-1] [{&quot;position&quot;:{&quot;x&quot;:-0.1931822640325796,&quot;yaw&quot;:-0.08553498481283986,&quot;tags&quot;:[&quot;flb_stdout&quot;],&quot;y&quot;:-0.5267276846092974},&quot;cmd_vel&quot;:{&quot;tags&quot;:[&quot;flb_stdout&quot;],&quot;linear&quot;:{&quot;x&quot;:0.232632,&quot;z&quot;:0,&quot;y&quot;:0},&quot;angular&quot;:{&quot;x&quot;:0,&quot;z&quot;:-0.0526316,&quot;y&quot;:0}},&quot;speed&quot;:{&quot;tags&quot;:[&quot;flb_stdout&quot;],&quot;linear&quot;:{&quot;x&quot;:0.2466804589428482,&quot;z&quot;:0,&quot;y&quot;:4.147463233418404e-05},&quot;computed&quot;:0.2466804624294339,&quot;angular&quot;:{&quot;x&quot;:-0.1575310923819759}},&quot;date&quot;:1677690789.878385,&quot;id&quot;:&quot;be781e5ffb1e7ee4f817fe7b63e92c32&quot;,&quot;robot_name&quot;:&quot;C3PO&quot;,&quot;run_id&quot;:&quot;234&quot;}]
[component_container_isolated-1] [{&quot;position&quot;:{&quot;x&quot;:-0.06732902212346159,&quot;yaw&quot;:-0.06199357549188581,&quot;tags&quot;:[&quot;flb_stdout&quot;],&quot;y&quot;:-0.5350783704643411},&quot;cmd_vel&quot;:{&quot;tags&quot;:[&quot;flb_stdout&quot;],&quot;linear&quot;:{&quot;x&quot;:0.191579,&quot;z&quot;:0,&quot;y&quot;:0},&quot;angular&quot;:{&quot;x&quot;:0,&quot;z&quot;:-0.0526316,&quot;y&quot;:0}},&quot;speed&quot;:{&quot;tags&quot;:[&quot;flb_stdout&quot;],&quot;linear&quot;:{&quot;x&quot;:0.2464715530337069,&quot;z&quot;:0,&quot;y&quot;:1.735682541426087e-05},&quot;computed&quot;:0.2464715536448513,&quot;angular&quot;:{&quot;x&quot;:-0.05272644093984532}},&quot;date&quot;:1677690790.878357,&quot;id&quot;:&quot;be781e5ffb1e7ee4f817fe7b63e92c32&quot;,&quot;robot_name&quot;:&quot;C3PO&quot;,&quot;run_id&quot;:&quot;234&quot;}]
[component_container_isolated-1] [{&quot;position&quot;:{&quot;x&quot;:0.1426837169393564,&quot;yaw&quot;:-0.1292500346335131,&quot;tags&quot;:[&quot;flb_stdout&quot;],&quot;y&quot;:-0.5883037844577782},&quot;cmd_vel&quot;:{&quot;tags&quot;:[&quot;flb_stdout&quot;],&quot;linear&quot;:{&quot;x&quot;:0,&quot;z&quot;:0,&quot;y&quot;:0},&quot;angular&quot;:{&quot;x&quot;:0,&quot;z&quot;:0,&quot;y&quot;:0}},&quot;speed&quot;:{&quot;tags&quot;:[&quot;flb_stdout&quot;],&quot;linear&quot;:{&quot;x&quot;:0.1917414358977791,&quot;z&quot;:0,&quot;y&quot;:1.44170547699829e-05},&quot;computed&quot;:0.1917414364397889,&quot;angular&quot;:{&quot;x&quot;:-0.05280628215810287}},&quot;date&quot;:1677690791.878987,&quot;id&quot;:&quot;be781e5ffb1e7ee4f817fe7b63e92c32&quot;,&quot;robot_name&quot;:&quot;C3PO&quot;,&quot;run_id&quot;:&quot;234&quot;}]
[component_container_isolated-1] [{&quot;position&quot;:{&quot;x&quot;:0.2658444927274801,&quot;yaw&quot;:-0.1669572018597313,&quot;tags&quot;:[&quot;flb_stdout&quot;],&quot;y&quot;:-0.6121168728850158},&quot;cmd_vel&quot;:{&quot;tags&quot;:[&quot;flb_stdout&quot;],&quot;linear&quot;:{&quot;x&quot;:0,&quot;z&quot;:0,&quot;y&quot;:0},&quot;angular&quot;:{&quot;x&quot;:0,&quot;z&quot;:0,&quot;y&quot;:0}},&quot;speed&quot;:{&quot;tags&quot;:[&quot;flb_stdout&quot;],&quot;linear&quot;:{&quot;x&quot;:3.645119603853573e-05,&quot;z&quot;:0,&quot;y&quot;:3.14134397110158e-06},&quot;computed&quot;:3.658630528742332e-05,&quot;angular&quot;:{&quot;x&quot;:-0.0004012554003809027}},&quot;date&quot;:1677690792.879082,&quot;id&quot;:&quot;be781e5ffb1e7ee4f817fe7b63e92c32&quot;,&quot;robot_name&quot;:&quot;C3PO&quot;,&quot;run_id&quot;:&quot;234&quot;}]
[component_container_isolated-1] [{&quot;date&quot;:1677690792.883126,&quot;width&quot;:384,&quot;height&quot;:384,&quot;remote_paths&quot;:{&quot;minio&quot;:{&quot;pgm&quot;:&quot;C3PO/2023/03/01/17/map/2023-03-01T17:13:12.pgm&quot;,&quot;yaml&quot;:&quot;C3PO/2023/03/01/17/map/2023-03-01T17:13:12.yaml&quot;}},&quot;resolution&quot;:0.05000000074505806,&quot;origin&quot;:{&quot;x&quot;:-10,&quot;y&quot;:-10},&quot;local_paths&quot;:{&quot;pgm&quot;:&quot;/root/dc_data/C3PO/2023/03/01/17/map/2023-03-01T17:13:12.pgm&quot;,&quot;yaml&quot;:&quot;/root/dc_data/C3PO/2023/03/01/17/map/2023-03-01T17:13:12.yaml&quot;},&quot;id&quot;:&quot;be781e5ffb1e7ee4f817fe7b63e92c32&quot;,&quot;robot_name&quot;:&quot;C3PO&quot;,&quot;run_id&quot;:&quot;234&quot;}
</code></pre>
<p>Given the JSON is quite large, let's analyze 2 different records:</p>
<p>The first one being the data published on the robot group:</p>
<pre><code class="language-json">[
  {
    &quot;cmd_vel&quot;: {
      &quot;linear&quot;: {
        &quot;x&quot;: 0.246316,
        &quot;y&quot;: 0,
        &quot;z&quot;: 0
      },
      &quot;angular&quot;: {
        &quot;x&quot;: 0,
        &quot;y&quot;: 0,
        &quot;z&quot;: 0.263158
      }
    },
    &quot;date&quot;: 1677694799.685468,
    &quot;position&quot;: {
      &quot;x&quot;: -0.6033772358727438,
      &quot;yaw&quot;: -0.7146495585355921,
      &quot;y&quot;: -1.633862970534114
    },
    &quot;speed&quot;: {
      &quot;angular&quot;: {
        &quot;x&quot;: -0.0002542699063698451
      },
      &quot;computed&quot;: 3.279051750818494e-05,
      &quot;linear&quot;: {
        &quot;x&quot;: 3.244397182637543e-05,
        &quot;y&quot;: 4.754653571390878e-06,
        &quot;z&quot;: 0
      }
    },
    &quot;name&quot;: &quot;robot&quot;,
    &quot;id&quot;: &quot;be781e5ffb1e7ee4f817fe7b63e92c32&quot;,
    &quot;robot_name&quot;: &quot;C3PO&quot;,
    &quot;run_id&quot;: &quot;240&quot;
  }
]
</code></pre>
<p>This record contains the speed, cmd_vel and position from the group &quot;robot&quot;. Not that the tags for each measurement have been dropped. This is because they won't be used in this particular group (they can be used as a single measurement)</p>
<pre><code class="language-json">[
  {
    &quot;width&quot;: 384,
    &quot;remote_paths&quot;: {
      &quot;minio&quot;: {
        &quot;yaml&quot;: &quot;C3PO/2023/03/01/18/map/2023-03-01T18:20:16.yaml&quot;,
        &quot;pgm&quot;: &quot;C3PO/2023/03/01/18/map/2023-03-01T18:20:16.pgm&quot;
      }
    },
    &quot;name&quot;: &quot;map&quot;,
    &quot;resolution&quot;: 0.05000000074505806,
    &quot;origin&quot;: {
      &quot;x&quot;: -10,
      &quot;y&quot;: -10
    },
    &quot;local_paths&quot;: {
      &quot;yaml&quot;: &quot;/root/dc_data/C3PO/2023/03/01/18/map/2023-03-01T18:20:16.yaml&quot;,
      &quot;pgm&quot;: &quot;/root/dc_data/C3PO/2023/03/01/18/map/2023-03-01T18:20:16.pgm&quot;
    },
    &quot;date&quot;: 1677694816.690489,
    &quot;height&quot;: 384,
    &quot;id&quot;: &quot;be781e5ffb1e7ee4f817fe7b63e92c32&quot;,
    &quot;robot_name&quot;: &quot;C3PO&quot;,
    &quot;run_id&quot;: &quot;240&quot;
  }
]
</code></pre>
<p>This record contains the map data from the measurement.</p>
<h2 id="configuration-2"><a class="header" href="#configuration-2">Configuration</a></h2>
<h3 id="measurement-2"><a class="header" href="#measurement-2">Measurement</a></h3>
<pre><code class="language-yaml">measurement_server:
  ros__parameters:
    custom_str_params: [&quot;robot_name&quot;]
    robot_name: &quot;C3PO&quot;
    measurement_plugins: [&quot;cmd_vel&quot;, &quot;map&quot;, &quot;position&quot;, &quot;speed&quot;]
    run_id:
      enabled: true
      counter: true
      counter_path: &quot;$HOME/run_id&quot;
      uuid: false
    save_local_base_path: &quot;$HOME/dc_data/&quot;
    all_base_path: &quot;=robot_name/%Y/%m/%d/%H&quot;
    cmd_vel:
      plugin: &quot;dc_measurements/CmdVel&quot;
      tags: [&quot;flb_stdout&quot;]
      group_key: &quot;cmd_vel&quot;
      enable_validator: true
      topic_output: &quot;/dc/measurement/cmd_vel&quot;
    position:
      plugin: &quot;dc_measurements/Position&quot;
      tags: [&quot;flb_stdout&quot;]
      group_key: &quot;position&quot;
      topic_output: &quot;/dc/measurement/position&quot;
      polling_interval: 1000
      enable_validator: true
      init_collect: true
      global_frame: &quot;map&quot;
      robot_base_frame: &quot;base_link&quot;
      transform_timeout: 0.1
    speed:
      plugin: &quot;dc_measurements/Speed&quot;
      tags: [&quot;flb_stdout&quot;]
      group_key: &quot;speed&quot;
      odom_topic: &quot;/odom&quot;
      topic_output: &quot;/dc/measurement/speed&quot;
    map:
      plugin: &quot;dc_measurements/Map&quot;
      tags: [&quot;flb_stdout&quot;]
      group_key: &quot;map&quot;
      polling_interval: 5000
      save_path: &quot;map/%Y-%m-%dT%H:%M:%S&quot;
      topic_output: &quot;/dc/measurement/map&quot;
      save_map_timeout: 4.0
      remote_prefixes: [&quot;&quot;]
      remote_keys: [&quot;minio&quot;]
</code></pre>
<p><strong>save_local_base_path (Optional)</strong>: Used as a common base for all saved files from measurement plugins. <em>all_base_path</em> is concatenated to it afterwards for defining the path where files are saved.</p>
<p><strong>all_base_path (Optional)</strong>: Used as a common base for some measurements to save files. Is concatenated to <em>save_local_base_path</em>. Note the =robot_name, which is later replaced by C3PO (the variable defined in custom_str_params)</p>
<p><strong>map.remote_keys</strong>: creates a dictionary inside <strong>remote_paths</strong> which is named by the strings in this field, which contains fields used by your API to fetch the remote URLs of the files.</p>
<h3 id="group-1"><a class="header" href="#group-1">Group</a></h3>
<pre><code class="language-yaml">group_server:
  ros__parameters:
    groups: [&quot;robot&quot;]
    robot:
      inputs:
        [
          &quot;/dc/measurement/cmd_vel&quot;,
          &quot;/dc/measurement/position&quot;,
          &quot;/dc/measurement/speed&quot;,
        ]
      output: &quot;/dc/group/robot&quot;
      sync_delay: 5.0
      group_key: &quot;robot&quot;
      tags: [&quot;flb_stdout&quot;]
      include_group_name: true
</code></pre>
<p>Create a group with data from cmd_vel, position and speed. Even though it appears there is nothing new here, I shall like to precise something important. In the previous demo, we mentioned that if all messages are not received by the group, it will drop it. It matters in this case because cmd_vel is not published all the time in this example (not when it is not moving), this means the data will be collected <strong>only</strong> when the robot moves (when a controller sends a command).</p>
<p>If you wished to collect the position and the speed constantly, you could take cmd_vel out of this group and add it in the destination.</p>
<h4 id="destinations-1"><a class="header" href="#destinations-1">Destinations</a></h4>
<pre><code class="language-yaml">destination_server:
  ros__parameters:
    flb:
      flush: 1
      flb_grace: 1
      log_level: &quot;info&quot;
      storage_path: &quot;/var/log/flb-storage/&quot;
      storage_sync: &quot;full&quot;
      storage_checksum: &quot;off&quot;
      storage_backlog_mem_limit: &quot;1M&quot;
      scheduler_cap: 200
      scheduler_base: 5
      http_server: true
      http_listen: &quot;0.0.0.0&quot;
      http_port: 2020
      in_storage_type: &quot;filesystem&quot;
      in_storage_pause_on_chunks_overlimit: &quot;off&quot;
    destination_plugins: [&quot;flb_stdout&quot;]
    custom_str_params_list: [&quot;robot_name&quot;, &quot;id&quot;]
    custom_str_params:
      robot_name:
        name: robot_name
        value: &quot;C3PO&quot;
      # Requires systemd package
      id:
        name: id
        value_from_file: /etc/machine-id
    flb_stdout:
      plugin: &quot;dc_destinations/FlbStdout&quot;
      inputs: [&quot;/dc/group/robot&quot;, &quot;/dc/measurement/map&quot;]
      time_format: &quot;double&quot;
      time_key: &quot;date&quot;
      debug: false
</code></pre>
<p>Nothing new here, we simply edited the inputs in flb_stdout to <code>[&quot;/dc/group/robot&quot;, &quot;/dc/measurement/map&quot;]</code> to get the data from the robot group and the map.</p>
<h2 id="console-output-2"><a class="header" href="#console-output-2">Console output</a></h2>
<p>Now that the node started, let us see what's displayed in the console</p>
<pre><code class="language-bash">[component_container_isolated-1] [INFO] [1677696067.792012776] [dc_container]: Load Library: /root/ws/install/dc_measurements/lib/libmeasurement_server_core.so
[component_container_isolated-1] [INFO] [1677696067.795921257] [dc_container]: Found class: rclcpp_components::NodeFactoryTemplate&lt;measurement_server::MeasurementServer&gt;
[component_container_isolated-1] [INFO] [1677696067.795956318] [dc_container]: Instantiate class: rclcpp_components::NodeFactoryTemplate&lt;measurement_server::MeasurementServer&gt;
[component_container_isolated-1] [INFO] [1677696067.811804437] [measurement_server]:
[component_container_isolated-1] 	measurement_server lifecycle node launched.
[component_container_isolated-1] 	Waiting on external lifecycle transitions to activate
[component_container_isolated-1] 	See https://design.ros2.org/articles/node_lifecycle.html for more information.
[component_container_isolated-1] [INFO] [1677696067.818755098] [measurement_server]: Base save path expanded to /root/dc_data/
[component_container_isolated-1] [INFO] [1677696067.818799565] [measurement_server]: All Base path expanded to C3PO/%Y/%m/%d/%H
[INFO] [launch_ros.actions.load_composable_nodes]: Loaded node '/measurement_server' in container 'dc_container'
[component_container_isolated-1] [INFO] [1677696067.821344112] [dc_container]: Load Library: /root/ws/install/dc_destinations/lib/libdestination_server_core.so
[component_container_isolated-1] [INFO] [1677696067.826089144] [dc_container]: Found class: rclcpp_components::NodeFactoryTemplate&lt;destination_server::DestinationServer&gt;
[component_container_isolated-1] [INFO] [1677696067.826138848] [dc_container]: Instantiate class: rclcpp_components::NodeFactoryTemplate&lt;destination_server::DestinationServer&gt;
[component_container_isolated-1] [INFO] [1677696067.845160790] [destination_server]:
[component_container_isolated-1] 	destination_server lifecycle node launched.
[component_container_isolated-1] 	Waiting on external lifecycle transitions to activate
[component_container_isolated-1] 	See https://design.ros2.org/articles/node_lifecycle.html for more information.
[INFO] [launch_ros.actions.load_composable_nodes]: Loaded node '/destination_server' in container 'dc_container'
[component_container_isolated-1] [INFO] [1677696067.856784495] [dc_container]: Load Library: /opt/ros/humble/lib/libnav2_lifecycle_manager_core.so
[component_container_isolated-1] [INFO] [1677696067.857836219] [dc_container]: Found class: rclcpp_components::NodeFactoryTemplate&lt;nav2_lifecycle_manager::LifecycleManager&gt;
[component_container_isolated-1] [INFO] [1677696067.857877118] [dc_container]: Instantiate class: rclcpp_components::NodeFactoryTemplate&lt;nav2_lifecycle_manager::LifecycleManager&gt;
[component_container_isolated-1] [INFO] [1677696067.875491851] [lifecycle_manager_navigation]: Creating
[INFO] [launch_ros.actions.load_composable_nodes]: Loaded node '/lifecycle_manager_navigation' in container 'dc_container'
[component_container_isolated-1] [INFO] [1677696067.881290824] [lifecycle_manager_navigation]: Creating and initializing lifecycle service clients
[component_container_isolated-1] [INFO] [1677696067.889491127] [lifecycle_manager_navigation]: Starting managed nodes bringup...
</code></pre>
<p>Measurement server and destination server are starting in the Lifecycle, you can read more about it <a href="dc/demos/../concepts.html#lifecycle-nodes-and-bond">here</a></p>
<p>&quot;Base save path&quot; and &quot;All Base path&quot; are also saved and expanded. Note &quot;=robot_name&quot; has been replaced by C3PO:</p>
<pre><code class="language-bash">[component_container_isolated-1] [INFO] [1677696067.818755098] [measurement_server]: Base save path expanded to /root/dc_data/
[component_container_isolated-1] [INFO] [1677696067.818799565] [measurement_server]: All Base path expanded to C3PO/%Y/%m/%d/%H
</code></pre>
<p>Afterward, the measurement_server starts:</p>
<pre><code>[component_container_isolated-1] [INFO] [1677694796.667666978] [lifecycle_manager_navigation]: Configuring measurement_server
[component_container_isolated-1] [INFO] [1677694796.667887325] [measurement_server]: Configuring
[component_container_isolated-1] [INFO] [1677694796.680348817] [measurement_server]: Creating measurement plugin cmd_vel: Type dc_measurements/CmdVel, Group key: cmd_vel, Polling interval: 1000, Debug: 0, Validator enabled: 1, Schema path: , Tags: [flb_stdout], Init collect: 1, Init Max measurement: 0, Include measurement name: 0, Include measurement plugin name: 0, Remote keys: , Remote prefixes: , Include measurement plugin name: 0, Max measurement on condition: 0, If all condition: , If any condition: , If none condition:
[component_container_isolated-1] [INFO] [1677694796.682517594] [measurement_server]: Configuring cmd_vel
[component_container_isolated-1] [INFO] [1677694796.684392643] [measurement_server]: Done configuring cmd_vel
[component_container_isolated-1] [INFO] [1677694796.684643767] [measurement_server]: Looking for schema at /root/ws/install/dc_measurements/share/dc_measurements/plugins/measurements/json/cmd_vel.json
[component_container_isolated-1] [INFO] [1677694796.684685350] [measurement_server]: schema: {&quot;$defs&quot;:{&quot;vector3&quot;:{&quot;properties&quot;:{&quot;x&quot;:{&quot;description&quot;:&quot;X speed&quot;,&quot;type&quot;:&quot;number&quot;},&quot;y&quot;:{&quot;description&quot;:&quot;Y speed&quot;,&quot;type&quot;:&quot;number&quot;},&quot;z&quot;:{&quot;description&quot;:&quot;Z speed&quot;,&quot;type&quot;:&quot;number&quot;}},&quot;type&quot;:&quot;object&quot;}},&quot;$schema&quot;:&quot;http://json-schema.org/draft-07/schema#&quot;,&quot;description&quot;:&quot;Command velocity sent to the robot&quot;,&quot;properties&quot;:{&quot;angular&quot;:{&quot;description&quot;:&quot;Angular velocity as a vector&quot;,&quot;items&quot;:{&quot;$ref&quot;:&quot;#/$defs/vector3&quot;},&quot;type&quot;:&quot;object&quot;},&quot;linear&quot;:{&quot;description&quot;:&quot;Linear velocity as a vector&quot;,&quot;items&quot;:{&quot;$ref&quot;:&quot;#/$defs/vector3&quot;},&quot;type&quot;:&quot;object&quot;}},&quot;title&quot;:&quot;Cmd_vel&quot;,&quot;type&quot;:&quot;object&quot;}
[component_container_isolated-1] [INFO] [1677694796.688143164] [measurement_server]: Creating measurement plugin map: Type dc_measurements/Map, Group key: map, Polling interval: 5000, Debug: 0, Validator enabled: 1, Schema path: , Tags: [flb_stdout], Init collect: 1, Init Max measurement: 0, Include measurement name: 1, Include measurement plugin name: 0, Remote keys: minio, Remote prefixes: , Include measurement plugin name: 0, Max measurement on condition: 0, If all condition: , If any condition: , If none condition:
[component_container_isolated-1] [INFO] [1677694796.689090088] [measurement_server]: Configuring map
[component_container_isolated-1] [INFO] [1677694796.690180661] [measurement_server]: Done configuring map
[component_container_isolated-1] [INFO] [1677694796.690522923] [measurement_server]: Looking for schema at /root/ws/install/dc_measurements/share/dc_measurements/plugins/measurements/json/map.json
[component_container_isolated-1] [INFO] [1677694796.690587274] [measurement_server]: schema: {&quot;$defs&quot;:{&quot;origin&quot;:{&quot;description&quot;:&quot;The 2-D pose of the lower-left pixel in the map, as (x, y, yaw), with yaw as counterclockwise rotation (yaw=0 means no rotation). Many parts of the system currently ignore yaw.&quot;,&quot;properties&quot;:{&quot;x&quot;:{&quot;description&quot;:&quot;X origin of the robot&quot;,&quot;type&quot;:&quot;number&quot;},&quot;y&quot;:{&quot;description&quot;:&quot;Y origin of the robot&quot;,&quot;type&quot;:&quot;number&quot;}},&quot;type&quot;:&quot;object&quot;},&quot;paths&quot;:{&quot;properties&quot;:{&quot;pgm&quot;:{&quot;description&quot;:&quot;Path to the map PGM file containing the gray-scale image&quot;,&quot;type&quot;:&quot;string&quot;},&quot;yaml&quot;:{&quot;description&quot;:&quot;Path to the map YAML file containing map metadata&quot;,&quot;type&quot;:&quot;string&quot;}},&quot;type&quot;:&quot;object&quot;}},&quot;$schema&quot;:&quot;http://json-schema.org/draft-07/schema#&quot;,&quot;description&quot;:&quot;Map saved metadata and paths&quot;,&quot;properties&quot;:{&quot;height&quot;:{&quot;description&quot;:&quot;Height of the PGM&quot;,&quot;minimum&quot;:0,&quot;type&quot;:&quot;integer&quot;},&quot;local_paths&quot;:{&quot;description&quot;:&quot;Paths where metadata and image are stored&quot;,&quot;items&quot;:{&quot;$ref&quot;:&quot;#/$defs/paths&quot;},&quot;type&quot;:&quot;object&quot;},&quot;origin&quot;:{&quot;description&quot;:&quot;Robot origin position in meters&quot;,&quot;items&quot;:{&quot;$ref&quot;:&quot;#/$defs/origin&quot;},&quot;type&quot;:&quot;object&quot;},&quot;remote_paths&quot;:{&quot;additionalProperties&quot;:{&quot;items&quot;:{&quot;$ref&quot;:&quot;#/$defs/paths&quot;},&quot;type&quot;:&quot;object&quot;},&quot;description&quot;:&quot;Dictionary of paths where metadata and image will be remotely stored&quot;,&quot;type&quot;:&quot;object&quot;},&quot;resolution&quot;:{&quot;description&quot;:&quot;Resolution of the map, meters/pixel&quot;,&quot;minimum&quot;:0,&quot;type&quot;:&quot;number&quot;},&quot;width&quot;:{&quot;description&quot;:&quot;Width of the PGM&quot;,&quot;minimum&quot;:0,&quot;type&quot;:&quot;integer&quot;}},&quot;title&quot;:&quot;Map&quot;,&quot;type&quot;:&quot;object&quot;}
[component_container_isolated-1] [INFO] [1677694796.693890952] [measurement_server]: Creating measurement plugin position: Type dc_measurements/Position, Group key: position, Polling interval: 1000, Debug: 0, Validator enabled: 1, Schema path: , Tags: [flb_stdout], Init collect: 1, Init Max measurement: 0, Include measurement name: 0, Include measurement plugin name: 0, Remote keys: , Remote prefixes: , Include measurement plugin name: 0, Max measurement on condition: 0, If all condition: , If any condition: , If none condition:
[component_container_isolated-1] [INFO] [1677694796.694797887] [measurement_server]: Configuring position
[component_container_isolated-1] [INFO] [1677694796.695799962] [measurement_server]: Done configuring position
[component_container_isolated-1] [INFO] [1677694796.696060904] [measurement_server]: Looking for schema at /root/ws/install/dc_measurements/share/dc_measurements/plugins/measurements/json/position.json
[component_container_isolated-1] [INFO] [1677694796.696114257] [measurement_server]: schema: {&quot;$schema&quot;:&quot;http://json-schema.org/draft-07/schema#&quot;,&quot;description&quot;:&quot;Position and orientation of the robot&quot;,&quot;properties&quot;:{&quot;x&quot;:{&quot;description&quot;:&quot;X position of the robot&quot;,&quot;type&quot;:&quot;number&quot;},&quot;y&quot;:{&quot;description&quot;:&quot;Y position of the robot&quot;,&quot;type&quot;:&quot;number&quot;},&quot;yaw&quot;:{&quot;description&quot;:&quot;Yaw angle of the robot&quot;,&quot;type&quot;:&quot;number&quot;}},&quot;title&quot;:&quot;Position&quot;,&quot;type&quot;:&quot;object&quot;}
[component_container_isolated-1] [INFO] [1677694796.699956883] [measurement_server]: Creating measurement plugin speed: Type dc_measurements/Speed, Group key: speed, Polling interval: 1000, Debug: 0, Validator enabled: 1, Schema path: , Tags: [flb_stdout], Init collect: 1, Init Max measurement: 0, Include measurement name: 0, Include measurement plugin name: 0, Remote keys: , Remote prefixes: , Include measurement plugin name: 0, Max measurement on condition: 0, If all condition: , If any condition: , If none condition:
[component_container_isolated-1] [INFO] [1677694796.701722429] [measurement_server]: Configuring speed
[component_container_isolated-1] [INFO] [1677694796.703057966] [measurement_server]: Done configuring speed
[component_container_isolated-1] [INFO] [1677694796.703357744] [measurement_server]: Looking for schema at /root/ws/install/dc_measurements/share/dc_measurements/plugins/measurements/json/speed.json
[component_container_isolated-1] [INFO] [1677694796.703413430] [measurement_server]: schema: {&quot;$defs&quot;:{&quot;vector3&quot;:{&quot;properties&quot;:{&quot;x&quot;:{&quot;description&quot;:&quot;X speed&quot;,&quot;type&quot;:&quot;number&quot;},&quot;y&quot;:{&quot;description&quot;:&quot;Y speed&quot;,&quot;type&quot;:&quot;number&quot;},&quot;z&quot;:{&quot;description&quot;:&quot;Z speed&quot;,&quot;type&quot;:&quot;number&quot;}},&quot;type&quot;:&quot;object&quot;}},&quot;$schema&quot;:&quot;http://json-schema.org/draft-07/schema#&quot;,&quot;description&quot;:&quot;Computed, linear and angular speed of the robot&quot;,&quot;properties&quot;:{&quot;angular&quot;:{&quot;description&quot;:&quot;Angular velocity as a vector&quot;,&quot;items&quot;:{&quot;$ref&quot;:&quot;#/$defs/vector3&quot;},&quot;type&quot;:&quot;object&quot;},&quot;computed&quot;:{&quot;description&quot;:&quot;Computed speed in meter/s&quot;,&quot;type&quot;:&quot;number&quot;},&quot;linear&quot;:{&quot;description&quot;:&quot;Linear velocity as a vector&quot;,&quot;items&quot;:{&quot;$ref&quot;:&quot;#/$defs/vector3&quot;},&quot;type&quot;:&quot;object&quot;}},&quot;title&quot;:&quot;Speed&quot;,&quot;type&quot;:&quot;object&quot;}
</code></pre>
<p>Plugins are loaded one by one (here only one is, the uptime one) and configured. The configuration for each is displayed and the validation schema is also loaded and its path printed.</p>
<p>Then, the destination_server starts:</p>
<pre><code>[component_container_isolated-1] [INFO] [1677694796.706019709] [lifecycle_manager_navigation]: Configuring destination_server
[component_container_isolated-1] [INFO] [1677694796.706162231] [destination_server]: Configuring
[component_container_isolated-1] [INFO] [1677694796.706907595] [destination_server]: Fluent Bit service initialized
[component_container_isolated-1] [INFO] [1677694796.707868171] [destination_server]: Creating destination plugin flb_stdout: Type dc_destinations/FlbStdout, Debug: 0, Time format: double. Time key: date
[component_container_isolated-1] [INFO] [1677694796.709554983] [destination_server]: Configuring Flb plugin flb_stdout
[component_container_isolated-1] [INFO] [1677694796.710263626] [destination_server]: Loaded lua filter. Match=ros2, code=function concatenate(tag, timestamp, record) if (type(record[&quot;tags&quot;]) == &quot;table&quot;) then record[&quot;tags&quot;] = table.concat(record[&quot;tags&quot;], &quot;,&quot;) end  return 2, timestamp, record end
[component_container_isolated-1] [INFO] [1677694796.710309154] [destination_server]: Loaded rewrite_tag filter. Match=ros2, Rule=$tags .*(flb_stdout).* flb_stdout true
[component_container_isolated-1] [INFO] [1677694796.710382723] [destination_server]: Done configuring Flb plugin flb_stdout
[component_container_isolated-1] [INFO] [1677694796.710401937] [destination_server]: Loading input ros2 shared library /root/ws/install/fluent_bit_plugins/lib/flb-in_ros2.so...
[component_container_isolated-1] [INFO] [1677694796.711494520] [destination_server]: Loaded input ros2 shared library /root/ws/install/fluent_bit_plugins/lib/flb-in_ros2.so
[component_container_isolated-1] [INFO] [1677694796.711617719] [destination_server]: Flb ros2 plugin initialized. ret=0
[component_container_isolated-1] [INFO] [1677694796.711638189] [destination_server]: Starting Flb engine...
[component_container_isolated-1] [2023/03/01 18:19:56] [ info] [fluent bit] version=2.0.7, commit=1ab360f79c, pid=79925
[component_container_isolated-1] [2023/03/01 18:19:56] [ info] [storage] ver=1.3.0, type=memory+filesystem, sync=full, checksum=off, max_chunks_up=128
[component_container_isolated-1] [2023/03/01 18:19:56] [ info] [storage] backlog input plugin: storage_backlog.1
[component_container_isolated-1] [2023/03/01 18:19:56] [ info] [cmetrics] version=0.5.7
[component_container_isolated-1] [2023/03/01 18:19:56] [ info] [ctraces ] version=0.2.5
[component_container_isolated-1] [2023/03/01 18:19:56] [ info] [input:ros2:ros2.0] initializing
[component_container_isolated-1] [2023/03/01 18:19:56] [ info] [input:ros2:ros2.0] storage_strategy='filesystem' (memory + filesystem)
[component_container_isolated-1] [2023/03/01 18:19:56] [ info] Started node fluentbit_rclc
[component_container_isolated-1] [2023/03/01 18:19:56] [ info] Created subscriber /dc/group/robot
[component_container_isolated-1] [2023/03/01 18:19:56] [ info] Created subscriber /dc/measurement/map
[component_container_isolated-1] [2023/03/01 18:19:56] [ info] [input:storage_backlog:storage_backlog.1] initializing
[component_container_isolated-1] [2023/03/01 18:19:56] [ info] [input:storage_backlog:storage_backlog.1] storage_strategy='memory' (memory only)
[component_container_isolated-1] [2023/03/01 18:19:56] [ info] [input:storage_backlog:storage_backlog.1] queue memory limit: 976.6K
[component_container_isolated-1] [2023/03/01 18:19:56] [ info] [input:emitter:emitter_for_rewrite_tag.2] initializing
[component_container_isolated-1] [2023/03/01 18:19:56] [ info] [input:emitter:emitter_for_rewrite_tag.2] storage_strategy='filesystem' (memory + filesystem)
[component_container_isolated-1] [2023/03/01 18:19:56] [ info] [output:stdout:stdout.0] worker #0 started
[component_container_isolated-1] [2023/03/01 18:19:56] [ info] [http_server] listen iface=0.0.0.0 tcp_port=2020
[component_container_isolated-1] [2023/03/01 18:19:56] [ info] [sp] stream processor started
[component_container_isolated-1] [INFO] [1677694796.763937083] [destination_server]: Started Flb engine
</code></pre>
<p>All the same as with previous demos:</p>
<p>It starts the <a href="dc/demos/../destinations/flb_stdout.html">FlbStdout destination plugin</a>, filters used internally by Fluent to edit Timestamps and tags. It then loads the ROS 2 Fluent Bit shared library and initialize it with the topics we provided as parameter.</p>
<p>Afterward, Fluent Bit starts, it prints its version, storage strategy and buffer configuration and lists which plugins are loaded.</p>
<p>Then, the measurement and destination server nodes are activated:</p>
<pre><code>[component_container_isolated-1] [INFO] [1677668906.745180268] [lifecycle_manager_navigation]: Activating measurement_server
[component_container_isolated-1] [INFO] [1677668906.745462265] [measurement_server]: Activating
[component_container_isolated-1] [INFO] [1677668906.745558665] [measurement_server]: Activating uptime
[component_container_isolated-1] [INFO] [1677668906.746014639] [measurement_server]: Creating bond (measurement_server) to lifecycle manager.
[component_container_isolated-1] [INFO] [1677668906.853199899] [lifecycle_manager_navigation]: Server measurement_server connected with bond.
[component_container_isolated-1] [INFO] [1677668906.853316226] [lifecycle_manager_navigation]: Activating destination_server
[component_container_isolated-1] [INFO] [1677668906.853620571] [destination_server]: Activating
[component_container_isolated-1] [INFO] [1677668906.853722659] [destination_server]: Activating flb_stdout
[component_container_isolated-1] [INFO] [1677668906.853796078] [destination_server]: Creating bond (destination_server) to lifecycle manager.
[component_container_isolated-1] [INFO] [1677668906.961666207] [lifecycle_manager_navigation]: Server destination_server connected with bond.
[component_container_isolated-1] [INFO] [1677668906.961777773] [lifecycle_manager_navigation]: Managed nodes are active
[component_container_isolated-1] [INFO] [1677668906.961820078] [lifecycle_manager_navigation]: Creating bond timer...
</code></pre>
<p>Finally, we see the data:</p>
<pre><code>[component_container_isolated-1] [{&quot;remote_paths&quot;:{&quot;minio&quot;:{&quot;pgm&quot;:&quot;C3PO/2023/03/01/18/map/2023-03-01T18:19:56.pgm&quot;,&quot;yaml&quot;:&quot;C3PO/2023/03/01/18/map/2023-03-01T18:19:56.yaml&quot;}},&quot;date&quot;:1677694796.765904,&quot;height&quot;:384,&quot;name&quot;:&quot;map&quot;,&quot;origin&quot;:{&quot;x&quot;:-10,&quot;y&quot;:-10},&quot;local_paths&quot;:{&quot;pgm&quot;:&quot;/root/dc_data/C3PO/2023/03/01/18/map/2023-03-01T18:19:56.pgm&quot;,&quot;yaml&quot;:&quot;/root/dc_data/C3PO/2023/03/01/18/map/2023-03-01T18:19:56.yaml&quot;},&quot;resolution&quot;:0.05000000074505806,&quot;width&quot;:384,&quot;id&quot;:&quot;be781e5ffb1e7ee4f817fe7b63e92c32&quot;,&quot;robot_name&quot;:&quot;C3PO&quot;,&quot;run_id&quot;:&quot;240&quot;}]
[component_container_isolated-1] [{&quot;cmd_vel&quot;:{&quot;linear&quot;:{&quot;x&quot;:0.246316,&quot;y&quot;:0,&quot;z&quot;:0},&quot;angular&quot;:{&quot;x&quot;:0,&quot;y&quot;:0,&quot;z&quot;:0.263158}},&quot;date&quot;:1677694799.685468,&quot;position&quot;:{&quot;x&quot;:-0.6033772358727438,&quot;yaw&quot;:-0.7146495585355921,&quot;y&quot;:-1.633862970534114},&quot;speed&quot;:{&quot;angular&quot;:{&quot;x&quot;:-0.0002542699063698451},&quot;computed&quot;:3.279051750818494e-05,&quot;linear&quot;:{&quot;x&quot;:3.244397182637543e-05,&quot;y&quot;:4.754653571390878e-06,&quot;z&quot;:0}},&quot;name&quot;:&quot;robot&quot;,&quot;id&quot;:&quot;be781e5ffb1e7ee4f817fe7b63e92c32&quot;,&quot;robot_name&quot;:&quot;C3PO&quot;,&quot;run_id&quot;:&quot;240&quot;}]
[component_container_isolated-1] [{&quot;cmd_vel&quot;:{&quot;linear&quot;:{&quot;x&quot;:0.246316,&quot;y&quot;:0,&quot;z&quot;:0},&quot;angular&quot;:{&quot;x&quot;:0,&quot;y&quot;:0,&quot;z&quot;:0.263158}},&quot;date&quot;:1677694800.685094,&quot;position&quot;:{&quot;x&quot;:-0.5307920077356227,&quot;yaw&quot;:-0.645872441707418,&quot;y&quot;:-1.693502983783379},&quot;speed&quot;:{&quot;angular&quot;:{&quot;x&quot;:0.2127361022319145},&quot;computed&quot;:0.2459393937023935,&quot;linear&quot;:{&quot;x&quot;:0.2459393844826374,&quot;y&quot;:-6.734242603700924e-05,&quot;z&quot;:0}},&quot;name&quot;:&quot;robot&quot;,&quot;id&quot;:&quot;be781e5ffb1e7ee4f817fe7b63e92c32&quot;,&quot;robot_name&quot;:&quot;C3PO&quot;,&quot;run_id&quot;:&quot;240&quot;}]
[component_container_isolated-1] [{&quot;cmd_vel&quot;:{&quot;linear&quot;:{&quot;x&quot;:0.26,&quot;y&quot;:0,&quot;z&quot;:0},&quot;angular&quot;:{&quot;x&quot;:0,&quot;y&quot;:0,&quot;z&quot;:0.368421}},&quot;date&quot;:1677694801.685017,&quot;position&quot;:{&quot;x&quot;:-0.3195900881047479,&quot;yaw&quot;:-0.3944485529461182,&quot;y&quot;:-1.813946939716471},&quot;speed&quot;:{&quot;angular&quot;:{&quot;x&quot;:0.2623361481938653},&quot;computed&quot;:0.24584231041888,&quot;linear&quot;:{&quot;x&quot;:0.2458423037516516,&quot;y&quot;:-5.725533732485466e-05,&quot;z&quot;:0}},&quot;name&quot;:&quot;robot&quot;,&quot;id&quot;:&quot;be781e5ffb1e7ee4f817fe7b63e92c32&quot;,&quot;robot_name&quot;:&quot;C3PO&quot;,&quot;run_id&quot;:&quot;240&quot;}]
</code></pre>
<p>So...what happened?</p>
<ol>
<li>The Nav2 turtlebot3 simulation starts, a robot is able to localize and move (once you use the 2-D pose estimate on RViz)</li>
<li>The measurement plugins start publishing data to /dc/measurement/map, /dc/measurement/cmd_vel, /dc/measurement/position and /dc/measurement/speed, which contain the JSONs, tags and timestamp of the message</li>
<li>In parallel, each time the map plugin sends a ROS message, it also saves the files on the filesystem. Open a file browser to the path you set in the configuration to a path mentioned in the map JSON</li>
<li>The &quot;robot&quot; group node subscribes to /dc/measurement/cmd_vel, /dc/measurement/position and /dc/measurement/speed and publish on /dc/group/robot when it collects data from all 3 topics</li>
<li>Run ID and robot_name is appended in the JSON of each</li>
<li>The ROS 2 Fluent Bit plugin, which subscribes to the topics, receive the data and pass it on to Fluent Bit</li>
<li>Fluent Bit receives it, applies the timestamp filter (which modifies the timestamp to the desired format)</li>
<li>Fluent Bit applies changes the tag with another filter. This tag is used to match to the destination afterward.</li>
<li>Data is flushed</li>
<li>The Fluent Bit stdout output plugin receives the data because tags match (the flb_stdout tag is used) and forwards it to Stdout</li>
</ol>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/demos/tb3_stdout.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="turtlebot3-1"><a class="header" href="#turtlebot3-1">Turtlebot3</a></h1>
<p>In this example, we add a robot and start collecting robot data to Stdout.</p>
<p>You will also need 3 terminal windows, to:</p>
<ol>
<li>Run the Nav2 turtlebot3 launchfile: it starts localization, navigation and RViz</li>
<li>Run navigation inspection demo</li>
<li>Run DC</li>
</ol>
<p>Using a different terminal window for DC helps reading its information.</p>
<h2 id="packages-in-the-workspace"><a class="header" href="#packages-in-the-workspace">Packages in the workspace</a></h2>
<p>In addition to the ros2_data_collection repo in your workspace, you will need to download the <a href="https://github.com/aws-robotics/aws-robomaker-small-warehouse-world/tree/ros2">aws warehouse package</a>:</p>
<pre><code class="language-bash">$ cd src
$ git clone https://github.com/aws-robotics/aws-robomaker-small-warehouse-world.git -b ros2
$ cd ..
$ colcon build
</code></pre>
<h2 id="setup-the-environment-1"><a class="header" href="#setup-the-environment-1">Setup the environment</a></h2>
<h3 id="python-dependencies"><a class="header" href="#python-dependencies">Python dependencies</a></h3>
<p>For this tutorial, we will need to install all dependencies:</p>
<pre><code class="language-bash">$ pip3 install -r requirements.txt -r requirements-dev.txt
</code></pre>
<h3 id="setup-infrastructure"><a class="header" href="#setup-infrastructure">Setup Infrastructure</a></h3>
<h4 id="minio"><a class="header" href="#minio">MinIO</a></h4>
<p>MinIO will be used as storage for images and other files. To start it, <a href="dc/demos/../infrastructure_setup/minio.html">follow the steps</a></p>
<p>Once you have your keys, edit the yaml configuration file at <a href="https://github.com/Minipada/ros2_data_collection/blob/humble/dc_demos/params/tb3_simulation_pgsql_minio.yaml">dc_demos/params/tb3_simulation_pgsql_minio.yaml</a> by editing all instances of:</p>
<ol>
<li>access_key_id</li>
<li>secret_access_key</li>
</ol>
<h4 id="postgresql"><a class="header" href="#postgresql">PostgreSQL</a></h4>
<p>PostgreSQL will be used as database storage for our JSON. Later on, backend engineers can make requests on those JSON based on measurement requested and time range. To start it, <a href="dc/demos/../infrastructure_setup/postgresql.html">follow the steps</a></p>
<p>The default yaml configuration file does not need change as it also uses default values.</p>
<h3 id="setup-simulation-environment"><a class="header" href="#setup-simulation-environment">Setup simulation environment</a></h3>
<p>In the terminal 1, source your environment, setup turtlebot configuration:</p>
<pre><code class="language-bash">$ source /opt/ros/humble/setup.bash
$ source install/setup.bash
$ export GAZEBO_MODEL_PATH=$GAZEBO_MODEL_PATH:/opt/ros/humble/share/turtlebot3_gazebo/models
$ export GAZEBO_RESOURCE_PATH=${PWD}/src/aws-robomaker-small-warehouse-world/
$ export TURTLEBOT3_MODEL=waffle
$ source /usr/share/gazebo/setup.bash
</code></pre>
<p>Verify the gazebo world can be loaded properly:</p>
<pre><code class="language-bash">$ gazebo /opt/ros/humble/share/aws_robomaker_small_warehouse_world/worlds/small_warehouse/small_warehouse.world
</code></pre>
<p>Gazebo will start with the warehouse environment. You can close it now.</p>
<div id="admonition-info" class="admonition info">
<div class="admonition-title">
<p>Info</p>
<p><a class="admonition-anchor-link" href="dc/demos/tb3_aws_minio_pgsql.html#admonition-info"></a></p>
</div>
<div>
<p>I believe requiring the source along with those export are needed because of <a href="https://github.com/aws-robotics/aws-robomaker-small-warehouse-world/issues/22">this issue</a></p>
</div>
</div>
<h2 id="terminal-1-start-navigation"><a class="header" href="#terminal-1-start-navigation">Terminal 1: Start Navigation</a></h2>
<p>Then, in the same terminal (1), start the Turtlebot launchfile:</p>
<pre><code class="language-bash">$ ros2 launch nav2_bringup tb3_simulation_launch.py \
    world:=/opt/ros/humble/share/aws_robomaker_small_warehouse_world/worlds/no_roof_small_warehouse/no_roof_small_warehouse.world \
    map:=/opt/ros/humble/share/aws_robomaker_small_warehouse_world/maps/005/map.yaml \
    headless:=False \
    x_pose:=3.45 \
    y_pose:=2.15 \
    yaw:=3.14
</code></pre>
<p>RViz and Gazebo will start: now you see the robot in Gazebo, and the map on RViz.</p>
<p><img src="dc/demos/../../images/demos-tb3_aws_minio_pgsql-rviz-1.png" alt="RViz" />
<img src="dc/demos/../../images/demos-tb3_aws_minio_pgsql-gz-1.png" alt="Gazebo" /></p>
<h2 id="terminal-2-start-dc"><a class="header" href="#terminal-2-start-dc">Terminal 2: Start DC</a></h2>
<p>Run colcon build to install the new configuration file:</p>
<pre><code class="language-bash">$ colcon build
</code></pre>
<p>Now, start the demo:</p>
<pre><code class="language-bash">$ ros2 launch dc_demos tb3_simulation_pgsql_minio.launch.py
</code></pre>
<p>The robot will start collecting data.</p>
<h2 id="terminal-3-start-autonomous-navigation"><a class="header" href="#terminal-3-start-autonomous-navigation">Terminal 3: Start autonomous navigation</a></h2>
<p>Execute</p>
<pre><code class="language-bash">$ ros2 run nav2_simple_commander demo_security
</code></pre>
<p>The robot will start moving and you will be able to see all visualizations activated in RViz:</p>
<p><img src="dc/demos/../../images/demos-tb3_aws_minio_pgsql-rviz-2.png" alt="RViz-moving" /></p>
<h2 id="visualize-the-data"><a class="header" href="#visualize-the-data">Visualize the data</a></h2>
<h3 id="in-the-database"><a class="header" href="#in-the-database">In the database</a></h3>
<p>Navigate to <a href="http://localhost:8080">localhost:8080</a></p>
<ol>
<li>Select <em>dc</em> database</li>
<li>Select <em>dc</em> table</li>
<li>Click on <em>Select data</em></li>
</ol>
<p>You will see rows filling the database. You can click on one to see its content:</p>
<p><img src="dc/demos/../../images/demos-tb3_aws_minio_pgsql-result-pgsql.gif" alt="Adminer-gif" /></p>
<h3 id="in-minio-file-storage"><a class="header" href="#in-minio-file-storage">In MinIO (file storage)</a></h3>
<p>Navigate to <a href="http://localhost:9001">localhost:9001</a></p>
<ol>
<li>Select <em>mybucket</em> bucket</li>
<li>Click until you reach camera or map</li>
<li>Continue until you reached a file, and click on preview (pgm can't be previewed)</li>
</ol>
<p>You will see rows filling the database. You can click on one to see its content:</p>
<p><img src="dc/demos/../../images/demos-tb3_aws_minio_pgsql-result-minio.gif" alt="Adminer-gif" /></p>
<h3 id="with-streamlit-dashboard"><a class="header" href="#with-streamlit-dashboard">With Streamlit dashboard</a></h3>
<p>A dashboard has been developed to help visualize the data collected.</p>
<div id="admonition-warning" class="admonition warning">
<div class="admonition-title">
<p>Warning</p>
<p><a class="admonition-anchor-link" href="dc/demos/tb3_aws_minio_pgsql.html#admonition-warning"></a></p>
</div>
<div>
<p>Make sure you have install python dependencies with pip!</p>
</div>
</div>
<p>Execute in a new terminal:</p>
<pre><code class="language-bash">$ cd src/ros2_data_collection/dc_demos/dc_demos/streamlit_dashboard/
# Replace by what was created at the start of this demo
$ export MINIO_ACCESS_KEY=&lt;YOUR_ACCESS_KEY&gt;
# Replace by what was created at the start of this demo
$ export MINIO_SECRET_KEY=&lt;YOUR_SECRET_KEY&gt;
$ streamlit run Streamlit_ROS_2.py

# This will be printed:

  You can now view your Streamlit app in your browser.

  Local URL: http://localhost:8502
  Network URL: http://192.168.2.105:8502
</code></pre>
<p>Reach the address on your browser: <a href="http://localhost:8502">localhost:8502</a>. Here is a video of it:</p>
<p><video src="../../images/demos-tb3_aws_minio_pgsql-streamlit.webm" controls="controls"></video></p>
<p>That's it! Now you can collect your data!</p>
<h2 id="understanding-the-configuration"><a class="header" href="#understanding-the-configuration">Understanding the configuration</a></h2>
<div id="admonition-info-1" class="admonition info">
<div class="admonition-title">
<p>Info</p>
<p><a class="admonition-anchor-link" href="dc/demos/tb3_aws_minio_pgsql.html#admonition-info-1"></a></p>
</div>
<div>
<p>The full configuration file can be found <a href="https://github.com/Minipada/ros2_data_collection/blob/humble/dc_demos/params/tb3_simulation_pgsql_minio.yaml">here</a>.</p>
</div>
</div>
<p>For this demo, we will reconstruct the yaml configuration element by element, given how large it is. Go through the explanation to understand how it works.</p>
<h3 id="measurement-server"><a class="header" href="#measurement-server">Measurement server</a></h3>
<h4 id="measurements"><a class="header" href="#measurements">Measurements</a></h4>
<p><code>measurement_plugins</code> sets which plugin to load. We collect</p>
<p>System measurements:</p>
<ol>
<li><a href="dc/demos/../measurements/cpu.html">CPU</a></li>
<li><a href="dc/demos/../measurements/os.html">OS</a></li>
<li><a href="dc/demos/../measurements/memory.html">Memory</a></li>
<li><a href="dc/demos/../measurements/uptime.html">Uptime</a></li>
</ol>
<p>Robot measurements:</p>
<ol>
<li><a href="dc/demos/../measurements/camera.html">Camera images</a></li>
<li><a href="dc/demos/../measurements/cmd_vel.html">Command velocities</a></li>
<li><a href="dc/demos/../measurements/distance_traveled.html">Distance traveled</a></li>
<li><a href="dc/demos/../measurements/position.html">Positions</a></li>
<li><a href="dc/demos/../measurements/speed.html">Speed</a></li>
</ol>
<p>Environment measurements:</p>
<ol>
<li><a href="dc/demos/../measurements/map.html">Map</a></li>
</ol>
<p>Infrastructure measurements:</p>
<ol>
<li><a href="dc/demos/../measurements/tcp_health.html">MinIO API health</a></li>
<li><a href="dc/demos/../measurements/tcp_health.html">MinIO Dashboard health</a></li>
<li><a href="dc/demos/../measurements/tcp_health.html">PostgreSQL health</a></li>
</ol>
<p>Each has their own configuration: polling interval, source topic, destination paths, topics used as input etc. Going through each of them would be too long here but you can check for each measurement its documentation and the general <a href="dc/demos/../measurements.html">documentation of measurements</a></p>
<h4 id="conditions"><a class="header" href="#conditions">Conditions</a></h4>
<p>We also initialize conditions:</p>
<ol>
<li>min_distance_traveled</li>
<li>max_distance_traveled</li>
</ol>
<p>They are used in the distance traveled measurement to only take values in a certain range.</p>
<h3 id="destination-server"><a class="header" href="#destination-server">Destination server</a></h3>
<p>Here we enable the PostgreSQL and MinIO plugins since it is where we send the data.</p>
<h4 id="postgresql-destination"><a class="header" href="#postgresql-destination">PostgreSQL destination</a></h4>
<p>We pass all topics generated by measurements. The node will subscribe to it and transfer the data to PostgreSQL. Note that not all data need to be sent to PostgreSQL, some could be sent elsewhere.</p>
<p>Along with the inputs, we pass the server configuration: username, password, database name etc.</p>
<h4 id="minio-destination"><a class="header" href="#minio-destination">MinIO destination</a></h4>
<p>We pass the topics we want to subscribe to. Here only map and camera since those are the ones generating files.</p>
<p>The <code>src_fields</code> and <code>upload_fields</code> are fields in the JSON sent by the measurement where local and remote paths are stored so the plugin knows where to put the files.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/demos/tb3_aws_minio_pgsql.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="turtlebot3-2"><a class="header" href="#turtlebot3-2">Turtlebot3</a></h1>
<p>In this example, we add a robot and start collecting robot data to Stdout.</p>
<p>You will also need 3 terminal windows, to:</p>
<ol>
<li>Run the Nav2 turtlebot3 launchfile: it starts localization, navigation and RViz</li>
<li>Run navigation inspection demo</li>
<li>Run DC</li>
</ol>
<p>Using a different terminal window for DC helps reading its information.</p>
<h2 id="packages-in-the-workspace-1"><a class="header" href="#packages-in-the-workspace-1">Packages in the workspace</a></h2>
<p>In addition to the ros2_data_collection repo in your workspace, you will need to download the <a href="https://github.com/aws-robotics/aws-robomaker-small-warehouse-world/tree/ros2">aws warehouse package</a>:</p>
<pre><code class="language-bash">$ cd src
$ git clone https://github.com/aws-robotics/aws-robomaker-small-warehouse-world.git -b ros2
$ cd ..
$ colcon build
</code></pre>
<h2 id="setup-the-environment-2"><a class="header" href="#setup-the-environment-2">Setup the environment</a></h2>
<h3 id="python-dependencies-1"><a class="header" href="#python-dependencies-1">Python dependencies</a></h3>
<p>For this tutorial, we will need to install all dependencies:</p>
<pre><code class="language-bash">$ pip3 install -r requirements.txt -r requirements-dev.txt
</code></pre>
<h3 id="setup-the-infrastructure"><a class="header" href="#setup-the-infrastructure">Setup the infrastructure</a></h3>
<h4 id="influxdb"><a class="header" href="#influxdb">InfluxDB</a></h4>
<p><a href="https://www.influxdata.com/">InfluxDB</a> will be used to store our data and timestamps. Later on, backend engineers can make requests on those JSON based on measurement requested and time range. To start it, <a href="dc/demos/../infrastructure_setup/influxdb.html">follow the steps</a></p>
<h4 id="grafana"><a class="header" href="#grafana">Grafana</a></h4>
<p><a href="https://grafana.com/">Grafana</a> will be used to display the data as timeseries or statistics.</p>
<h3 id="setup-simulation-environment-1"><a class="header" href="#setup-simulation-environment-1">Setup simulation environment</a></h3>
<p>In the terminal 1, source your environment, setup turtlebot configuration:</p>
<pre><code class="language-bash">$ source /opt/ros/humble/setup.bash
$ source install/setup.bash
$ export GAZEBO_MODEL_PATH=$GAZEBO_MODEL_PATH:/opt/ros/humble/share/turtlebot3_gazebo/models
$ export GAZEBO_RESOURCE_PATH=${PWD}/src/aws-robomaker-small-warehouse-world/
$ export TURTLEBOT3_MODEL=waffle
$ source /usr/share/gazebo/setup.bash
</code></pre>
<p>Verify the gazebo world can be loaded properly:</p>
<pre><code class="language-bash">$ gazebo /opt/ros/humble/share/aws_robomaker_small_warehouse_world/worlds/no_roof_small_warehouse/no_roof_small_warehouse.world
</code></pre>
<p>Gazebo will start with the warehouse environment. You can close it now.</p>
<div id="admonition-info" class="admonition info">
<div class="admonition-title">
<p>Info</p>
<p><a class="admonition-anchor-link" href="dc/demos/tb3_aws_influxdb.html#admonition-info"></a></p>
</div>
<div>
<p>I believe requiring the source along with those export are needed because of <a href="https://github.com/aws-robotics/aws-robomaker-small-warehouse-world/issues/22">this issue</a></p>
</div>
</div>
<h2 id="terminal-1-start-navigation-1"><a class="header" href="#terminal-1-start-navigation-1">Terminal 1: Start Navigation</a></h2>
<p>Then, in the same terminal (1), start the Turtlebot launchfile:</p>
<pre><code class="language-bash">$ ros2 launch nav2_bringup tb3_simulation_launch.py \
    world:=/opt/ros/humble/share/aws_robomaker_small_warehouse_world/worlds/no_roof_small_warehouse/no_roof_small_warehouse.world \
    map:=/opt/ros/humble/share/aws_robomaker_small_warehouse_world/maps/005/map.yaml \
    headless:=False \
    x_pose:=3.45 \
    y_pose:=2.15 \
    yaw:=3.14
</code></pre>
<p>RViz and Gazebo will start: now you see the robot in Gazebo, and the map on RViz.</p>
<p><img src="dc/demos/../../images/demos-tb3_aws_minio_pgsql-rviz-1.png" alt="RViz" />
<img src="dc/demos/../../images/demos-tb3_aws_minio_pgsql-gz-1.png" alt="Gazebo" /></p>
<h2 id="terminal-2-start-dc-1"><a class="header" href="#terminal-2-start-dc-1">Terminal 2: Start DC</a></h2>
<p>Run colcon build to compile the workspace:</p>
<pre><code class="language-bash">$ colcon build
</code></pre>
<p>Now, start the demo:</p>
<pre><code class="language-bash">$ ros2 launch dc_demos tb3_simulation_influxdb.launch.py
</code></pre>
<p>The robot will start collecting data.</p>
<h2 id="terminal-3-start-autonomous-navigation-1"><a class="header" href="#terminal-3-start-autonomous-navigation-1">Terminal 3: Start autonomous navigation</a></h2>
<p>Execute</p>
<pre><code class="language-bash">$ ros2 run nav2_simple_commander demo_security
</code></pre>
<p>The robot will start moving and you will be able to see all visualizations activated in RViz:</p>
<p><img src="dc/demos/../../images/demos-tb3_aws_minio_pgsql-rviz-2.png" alt="RViz-moving" /></p>
<h2 id="visualize-the-data-1"><a class="header" href="#visualize-the-data-1">Visualize the data</a></h2>
<h3 id="with-grafana-dashboard"><a class="header" href="#with-grafana-dashboard">With Grafana Dashboard</a></h3>
<p>Open your browser at <a href="http://localhost:3000">http://localhost:3000</a> and login with admin/admin</p>
<p><img src="dc/demos/../../images/grafana-1.png" alt="Grafana-1" /></p>
<h2 id="understanding-the-configuration-1"><a class="header" href="#understanding-the-configuration-1">Understanding the configuration</a></h2>
<div id="admonition-info-1" class="admonition info">
<div class="admonition-title">
<p>Info</p>
<p><a class="admonition-anchor-link" href="dc/demos/tb3_aws_influxdb.html#admonition-info-1"></a></p>
</div>
<div>
<p>The full configuration file can be found <a href="https://github.com/Minipada/ros2_data_collection/blob/humble/dc_demos/params/tb3_simulation_influxdb.yaml">here</a>.</p>
</div>
</div>
<h3 id="measurement-server-1"><a class="header" href="#measurement-server-1">Measurement server</a></h3>
<h4 id="measurements-1"><a class="header" href="#measurements-1">Measurements</a></h4>
<p><code>measurement_plugins</code> sets which plugin to load. We collect</p>
<p>System measurements:</p>
<ol>
<li><a href="dc/demos/../measurements/cpu.html">CPU</a></li>
<li><a href="dc/demos/../measurements/os.html">OS</a></li>
<li><a href="dc/demos/../measurements/memory.html">Memory</a></li>
<li><a href="dc/demos/../measurements/uptime.html">Uptime</a></li>
</ol>
<p>Robot measurements:</p>
<ol>
<li><a href="dc/demos/../measurements/camera.html">Camera images</a></li>
<li><a href="dc/demos/../measurements/cmd_vel.html">Command velocities</a></li>
<li><a href="dc/demos/../measurements/distance_traveled.html">Distance traveled</a></li>
<li><a href="dc/demos/../measurements/position.html">Positions</a></li>
<li><a href="dc/demos/../measurements/speed.html">Speed</a></li>
</ol>
<p>Environment measurements:</p>
<ol>
<li><a href="dc/demos/../measurements/map.html">Map</a></li>
</ol>
<p>Infrastructure measurements:</p>
<ol>
<li><a href="dc/demos/../measurements/tcp_health.html">InfluxDB health</a></li>
</ol>
<p>Each has their own configuration: polling interval, source topic, destination paths, topics used as input etc. Going through each of them would be too long here but you can check for each measurement its documentation and the general <a href="dc/demos/../measurements.html">documentation of measurements</a></p>
<p>Note that all measurements have the <code>nested</code> and <code>flattened</code> parameter set to True, this will transform each measurement to conform to how InfluxDB stores data. See nested and flattened in the measurements page.</p>
<p>Note also that all images (map and camera images) are stored as base64 strings because Grafana, the frontend at the end will only be able to access strings from the database.</p>
<h4 id="conditions-1"><a class="header" href="#conditions-1">Conditions</a></h4>
<p>We also initialize conditions:</p>
<ol>
<li>min_distance_traveled</li>
<li>max_distance_traveled</li>
</ol>
<p>They are used in the distance traveled measurement to only take values in a certain range.</p>
<h3 id="destination-server-1"><a class="header" href="#destination-server-1">Destination server</a></h3>
<p>Here we only enable the InfluxDB plugins since it is where we send the data.</p>
<p>At the end, we want to display the data on Grafana. Grafana can only display content stored on the connected database. This also includes images, which is why they are stored as base64 strings.</p>
<h4 id="influxdb-destination"><a class="header" href="#influxdb-destination">InfluxDB destination</a></h4>
<p>We pass all topics generated by measurements. The node will subscribe to it and transfer the data to InfluxDB.</p>
<p>Along with the inputs, we pass the server credentials.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/demos/tb3_aws_influxdb.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="qrcodes"><a class="header" href="#qrcodes">QRCodes</a></h1>
<p>In this example, we add a robot and start collecting robot data to PostgreSQL and maps and scanned QRcodes to MinIO as image files.</p>
<p>You will also need 2 terminal windows, to:</p>
<ol>
<li>Run the Nav2 turtlebot3 launchfile: it starts localization, navigation and RViz</li>
<li>Run DC</li>
</ol>
<p>Since RViz is pretty verbose, using 3 terminal windows will help reading the JSON printed on the terminal window.</p>
<div class="table-wrapper"><table><thead><tr><th>Terminal</th><th>Description</th></tr></thead><tbody>
<tr><td>RViz</td><td>Start it independently because of its verbosity</td></tr>
<tr><td>Nav2</td><td>Localization and navigation</td></tr>
<tr><td>DC</td><td>Data collection</td></tr>
</tbody></table>
</div>
<h2 id="setup-minio-and-postgresql"><a class="header" href="#setup-minio-and-postgresql">Setup MinIO and PostgreSQL</a></h2>
<h3 id="minio-1"><a class="header" href="#minio-1">MinIO</a></h3>
<p>MinIO will be used as storage for images and other files. To start it, <a href="dc/demos/../infrastructure_setup/minio.html">follow the steps</a></p>
<h3 id="postgresql-1"><a class="header" href="#postgresql-1">PostgreSQL</a></h3>
<p>PostgreSQL will be used as database storage for our JSON. Later on, backend engineers can make requests on those JSON based on measurement requested and time range. To start it, <a href="dc/demos/../infrastructure_setup/postgresql.html">follow the steps</a></p>
<h2 id="setup-the-ros-environment"><a class="header" href="#setup-the-ros-environment">Setup the ROS environment</a></h2>
<p>In each, terminal, source your environment and setup turtlebot configuration:</p>
<pre><code class="language-bash">$ source /opt/ros/humble/setup.bash
$ source install/setup.bash
$ export GAZEBO_MODEL_PATH=$GAZEBO_MODEL_PATH:/opt/ros/humble/share/turtlebot3_gazebo/models
$ export GAZEBO_MODEL_PATH=$GAZEBO_MODEL_PATH:/opt/ros/humble/share/aws_robomaker_small_warehouse_world/models/
$ export TURTLEBOT3_MODEL=waffle
</code></pre>
<h2 id="start-rviz"><a class="header" href="#start-rviz">Start RVIZ</a></h2>
<pre><code class="language-bash">$ ros2 run rviz2 rviz2 -d ${PWD}/install/dc_simulation/share/dc_simulation/rviz/qrcodes.rviz
</code></pre>
<h2 id="start-navigation-1"><a class="header" href="#start-navigation-1">Start Navigation</a></h2>
<p>Then, start the Turtlebot launchfile with custom parameters to start the QRcode world:</p>
<pre><code class="language-bash">$ ros2 launch nav2_bringup tb3_simulation_launch.py \
    headless:=False \
    x_pose:=&quot;-16.679400&quot; \
    y_pose:=&quot;-15.300200&quot; \
    z_pose:=&quot;0.01&quot; \
    roll:=&quot;0.00&quot; \
    pitch:=&quot;0.00&quot; \
    yaw:=&quot;1.570796&quot; \
    robot_sdf:=&quot;${PWD}/install/dc_simulation/share/dc_simulation/worlds/waffle.model&quot; \
    map:=&quot;${PWD}/install/dc_simulation/share/dc_simulation/maps/qrcodes.yaml&quot; \
    world:=&quot;${PWD}/install/dc_simulation/share/dc_simulation/worlds/qrcodes.world&quot; \
    nav2_params_file:=&quot;${PWD}/install/dc_simulation/share/dc_demos/params/qrcodes_nav.yaml&quot; \
    dc_params_file:=&quot;${PWD}/install/dc_simulation/share/dc_demos/params/qrcodes_minio_pgsql.yaml&quot; \
    rviz_config_file:=&quot;${PWD}/install/dc_simulation/share/dc_simulation/rviz/qrcodes.rviz&quot; \
    use_rviz:=False
</code></pre>
<p>RViz and Gazebo will start: you should now see the robot in Gazebo, and the map on RViz.</p>
<p>Set the robot position using the &quot;2D Pose Estimate&quot; button.</p>
<h2 id="start-dc-1"><a class="header" href="#start-dc-1">Start DC</a></h2>
<p>Execute</p>
<pre><code class="language-bash">$ ros2 launch dc_demos tb3_qrcodes_minio_pgsql.launch.py
</code></pre>
<p>With this, all data will be transmitted</p>
<h2 id="understanding-the-configuration-2"><a class="header" href="#understanding-the-configuration-2">Understanding the configuration</a></h2>
<div id="admonition-info" class="admonition info">
<div class="admonition-title">
<p>Info</p>
<p><a class="admonition-anchor-link" href="dc/demos/qrcodes_minio_pgsql.html#admonition-info"></a></p>
</div>
<div>
<p>The full configuration file can be found <a href="https://github.com/Minipada/ros2_data_collection/blob/humble/dc_demos/params/qrcodes_minio_pgsql.yaml">here</a>.</p>
</div>
</div>
<p>For this demo, we will reconstruct the yaml configuration element by element, given how large it is. Go through the explanation to understand how it works.</p>
<h3 id="collect-command-velocity-position-and-speed-to-postgresql-as-a-group"><a class="header" href="#collect-command-velocity-position-and-speed-to-postgresql-as-a-group">Collect command velocity, position and speed to PostgreSQL as a group</a></h3>
<p>Similarly to the previous tutorial:</p>
<pre><code class="language-yaml">destination_server:
  ros__parameters:
    flb:
      flush: 1
      flb_grace: 1
      log_level: &quot;info&quot;
      storage_path: &quot;/var/log/flb-storage/&quot;
      storage_sync: &quot;full&quot;
      storage_checksum: &quot;off&quot;
      storage_backlog_mem_limit: &quot;1M&quot;
      scheduler_cap: 200
      scheduler_base: 5
      http_server: true
      http_listen: &quot;0.0.0.0&quot;
      http_port: 2020
      in_storage_type: &quot;filesystem&quot;
      in_storage_pause_on_chunks_overlimit: &quot;off&quot;
    destination_plugins: [&quot;flb_pgsql&quot;]
    flb_pgsql:
      plugin: &quot;dc_destinations/FlbPgSQL&quot;
      inputs: [&quot;/dc/group/robot&quot;]
      host: &quot;127.0.0.1&quot;
      port: 5432
      user: fluentbit
      password: password
      database: &quot;fluentbit&quot;
      table: &quot;dc&quot;
      timestamp_key: &quot;date&quot;
      async: false
      time_format: &quot;double&quot;
      time_key: &quot;date&quot;

group_server:
  ros__parameters:
    groups: [&quot;robot&quot;]
    robot:
      inputs:
        [
          &quot;/dc/measurement/cmd_vel&quot;,
          &quot;/dc/measurement/position&quot;,
          &quot;/dc/measurement/speed&quot;,
        ]
      output: &quot;/dc/group/robot&quot;
      sync_delay: 5.0
      group_key: &quot;robot&quot;
      tags: [&quot;flb_pgsql&quot;]

measurement_server:
  ros__parameters:
    custom_str_params: [&quot;robot_name&quot;]
    robot_name: &quot;C3PO&quot;
    measurement_plugins: [&quot;cmd_vel&quot;, &quot;position&quot;, &quot;speed&quot;]
    custom_str_params_list: [&quot;robot_name&quot;, &quot;id&quot;]
    custom_str_params:
      robot_name:
        name: robot_name
        value: &quot;C3PO&quot;
      # Requires systemd package
      id:
        name: id
        value_from_file: /etc/machine-id
    run_id:
      enabled: true
      counter: true
      counter_path: &quot;$HOME/run_id&quot;
      uuid: false
    moving:
      plugin: &quot;dc_conditions/Moving&quot;
    cmd_vel:
      plugin: &quot;dc_measurements/CmdVel&quot;
      group_key: &quot;cmd_vel&quot;
      enable_validator: true
      topic_output: &quot;/dc/measurement/cmd_vel&quot;
      include_measurement_name: true
    position:
      plugin: &quot;dc_measurements/Position&quot;
      group_key: &quot;position&quot;
      topic_output: &quot;/dc/measurement/position&quot;
      enable_validator: true
      global_frame: &quot;map&quot;
      robot_base_frame: &quot;base_link&quot;
      transform_timeout: 0.1
      include_measurement_name: true
    speed:
      plugin: &quot;dc_measurements/Speed&quot;
      group_key: &quot;speed&quot;
      odom_topic: &quot;/odom&quot;
      topic_output: &quot;/dc/measurement/speed&quot;
      include_measurement_name: true
</code></pre>
<p>In the measurement server, we set 3 measurements: cmd_vel, position and speed being collected once per second, are validated with their respective JSON schemas and publish on their own topics.</p>
<p>Note the <code>include_measurement_name</code> which include measurement name in the JSON, which is used when grouping. The group collects the data from those 3 measurement and republishes it on the group topic <code>/dc/group/robot</code>.</p>
<p>In the destination server, we enable the PostgreSQL plugin and configure its credentials.</p>
<div id="admonition-warning" class="admonition warning">
<div class="admonition-title">
<p>Warning</p>
<p><a class="admonition-anchor-link" href="dc/demos/qrcodes_minio_pgsql.html#admonition-warning"></a></p>
</div>
<div>
<p>Be sure to change the login and password to your current infrastructure configuration. Do it in production setup!</p>
</div>
</div>
<p>You can find more about the PostgreSQL plugin <a href="dc/demos/../destinations/flb_files_metrics.html">here</a></p>
<p>To take a look at records, go to Adminer. It is by default started at <a href="http://localhost:8080">http://localhost:8080</a>, it is a database GUI.:</p>
<p><img src="dc/demos/../../images/qrcodes_pgsql_adminer.png" alt="Adminer" /></p>
<p>You can then click on a record, to take a look, edit or delete it:</p>
<p><img src="dc/demos/../../images/qrcodes_pgsql_adminer_record.png" alt="Adminer" /></p>
<h3 id="send-the-map-image-and-yaml-from-nav2_map_server-to-minio"><a class="header" href="#send-the-map-image-and-yaml-from-nav2_map_server-to-minio">Send the map image and YAML from nav2_map_server to MinIO</a></h3>
<p>First, we add the map measurement. We use 3 plugins here: flb_pgsql to send the data to PostgreSQL on the dc database, then flb_minio to send some files to MinIO and flb_files_metrics which will be used to autodelete the files once they reach their destination.</p>
<pre><code class="language-yaml">measurement_server:
  ros__parameters:
  ...
  measurement_plugins: [&quot;map&quot;]
  map:
    plugin: &quot;dc_measurements/Map&quot;
    group_key: &quot;map&quot;
    polling_interval: 5000
    save_path: &quot;map/%Y-%m-%dT%H:%M:%S&quot;
    topic_output: &quot;/dc/measurement/map&quot;
    save_map_timeout: 4.0
    remote_prefixes: [&quot;&quot;]
    remote_keys: [&quot;minio&quot;]
    enable_validator: true
    tags: [&quot;flb_pgsql&quot;, &quot;flb_minio&quot;, &quot;flb_files_metrics&quot;]
    include_measurement_name: true
  ...
</code></pre>
<p>Then we add the destinations:</p>
<pre><code class="language-yaml">destination_server:
  ros__parameters:
    ...
    destination_plugins: [&quot;flb_files_metrics&quot;, &quot;flb_pgsql&quot;, &quot;flb_minio&quot;]
    flb_files_metrics:
      plugin: &quot;dc_destinations/FlbFilesMetrics&quot;
      inputs: [&quot;/dc/measurement/map&quot;]
      file_storage: [&quot;minio&quot;]
      db_type: &quot;pgsql&quot;
      delete_when_sent: true
      minio:
        endpoint: 127.0.0.1:9000
        access_key_id: rQXPf1f730Yuu2yW # Change it
        secret_access_key: TYYkjN5L4gqDgCGLzQahHDcvqL4WNTcb # Change it
        use_ssl: false
        bucket: &quot;mybucket&quot;
        src_fields: [&quot;local_paths.pgm&quot;, &quot;local_paths.yaml&quot;]
        upload_fields: [&quot;remote_paths.minio.pgm&quot;, &quot;remote_paths.minio.yaml&quot;]
        input_names: [&quot;map&quot;, &quot;map&quot;]
      pgsql:
        host: &quot;127.0.0.1&quot;
        port: &quot;5432&quot;
        user: fluentbit # Change it
        password: password # Change it
        database: &quot;fluentbit&quot;
        table: &quot;files_metrics&quot;
        timestamp_key: &quot;date&quot;
        time_format: &quot;double&quot;
        time_key: &quot;date&quot;
        ssl: false
    flb_minio:
      verbose_plugin: false
      time_format: &quot;iso8601&quot;
      plugin: &quot;dc_destinations/FlbMinIO&quot;
      inputs: [&quot;/dc/measurement/map&quot;]
      endpoint: 127.0.0.1:9000
      access_key_id: rQXPf1f730Yuu2yW # Change it
      secret_access_key: TYYkjN5L4gqDgCGLzQahHDcvqL4WNTcb # Change it
      use_ssl: false
      create_bucket: true
      bucket: &quot;mybucket&quot; # Change it
      src_fields: [&quot;local_paths.pgm&quot;, &quot;local_paths.yaml&quot;]
      upload_fields: [&quot;remote_paths.minio.pgm&quot;, &quot;remote_paths.minio.yaml&quot;]
    flb_pgsql:
      plugin: &quot;dc_destinations/FlbPgSQL&quot;
      inputs: [&quot;/dc/group/map&quot;]
      host: &quot;127.0.0.1&quot;
      port: 5432
      user: fluentbit
      password: password
      database: &quot;fluentbit&quot;
      table: &quot;dc&quot;
      timestamp_key: &quot;date&quot;
      async: false
      time_format: &quot;double&quot;
      time_key: &quot;date&quot;
</code></pre>
<p>This will save the map pgm and yaml every 5 seconds to MinIO. Head to the MinIO GUI, which is by default located at <a href="http://localhost:9001">http://localhost:9001</a>. Default user/password are <strong>minioadmin</strong>/<strong>minioadmin</strong>.</p>
<p><img src="dc/demos/../../images/qrcodes_map_minio.png" alt="MapMinIO" /></p>
<p>It will also save the map metadata on PostgreSQL, which you can later use to know the map location on MinIO and its dimensions for example:</p>
<p><img src="dc/demos/../../images/qrcodes_map_pgsql.png" alt="MapPostgreSQL" /></p>
<p>We also transmit the metadata, to be fetched later on by the backend (map dimension and path). It is set in the flb_pgsql measurement plugin.</p>
<p>The flb_metrics plugin is also enabled. We use it to track if the file is on the filesystem and also delete it once it reaches its destination, here MinIO. This plugins deletes file when they are sent with the <code>delete_when_sent</code> parameter. More about the plugin <a href="dc/demos/../destinations/flb_files_metrics.html">here</a></p>
<p>Then, similarly, on Adminer, you can check the data is uploaded and deleted:</p>
<p><img src="dc/demos/../../images/qrcodes_pgsql_adminer_files_metrics.png" alt="MapAdminerFilesMetrics" /></p>
<h3 id="send-qr-code-images-to-minio"><a class="header" href="#send-qr-code-images-to-minio">Send QR code images to MinIO</a></h3>
<p>We want to collect pictures taken by the cameras</p>
<pre><code class="language-yaml">measurement_server:
  ros__parameters:
  ...
  measurement_plugins: [&quot;right_camera&quot;, &quot;left_camera&quot;]
  condition_plugins: [&quot;moving&quot;, &quot;inspected_exists&quot;]
  custom_str_params_list: [&quot;robot_name&quot;, &quot;id&quot;]
  custom_str_params:
    robot_name:
      name: robot_name
      value: &quot;C3PO&quot;
    # Requires systemd package
    id:
      name: id
      value_from_file: /etc/machine-id
  run_id:
    enabled: true
    counter: true
    counter_path: &quot;$HOME/run_id&quot;
    uuid: false
  destinations:
    minio:
      bucket: mybucket
  moving:
    plugin: &quot;dc_conditions/Moving&quot;
  inspected_exists:
    plugin: &quot;dc_conditions/Exist&quot;
    key: &quot;inspected&quot;
  right_camera:
    plugin: &quot;dc_measurements/Camera&quot;
    group_key: &quot;right_camera&quot;
    if_none_conditions: [&quot;moving&quot;]
    if_all_conditions: [&quot;inspected_exists&quot;]
    topic_output: &quot;/dc/measurement/right_camera&quot;
    init_collect: false
    init_max_measurements: -1
    condition_max_measurements: 1
    node_name: &quot;dc_measurement_camera&quot;
    cam_topic: &quot;/right_intel_realsense_r200_depth/image_raw&quot;
    cam_name: right_camera
    enable_validator: true
    draw_det_barcodes: true
    save_raw_img: false
    save_rotated_img: false
    save_detections_img: true
    save_inspected_path: &quot;right_camera/inspected/%Y-%m-%dT%H-%M-%S&quot;
    rotation_angle: 0
    detection_modules: [&quot;barcode&quot;]
    remote_prefixes: [&quot;&quot;]
    remote_keys: [&quot;minio&quot;]
    tags: [&quot;flb_pgsql&quot;, &quot;flb_minio&quot;, &quot;flb_files_metrics&quot;]
    include_measurement_name: true
  left_camera:
    plugin: &quot;dc_measurements/Camera&quot;
    group_key: &quot;left_camera&quot;
    if_none_conditions: [&quot;moving&quot;]
    if_all_conditions: [&quot;inspected_exists&quot;]
    topic_output: &quot;/dc/measurement/left_camera&quot;
    init_collect: true
    init_max_measurements: -1
    condition_max_measurements: 1
    node_name: &quot;dc_measurement_camera&quot;
    cam_topic: &quot;/left_intel_realsense_r200_depth/image_raw&quot;
    cam_name: left_camera
    enable_validator: true
    draw_det_barcodes: true
    save_raw_img: false
    save_rotated_img: false
    save_detections_img: true
    save_inspected_path: &quot;left_camera/inspected/%Y-%m-%dT%H-%M-%S&quot;
    rotation_angle: 0
    detection_modules: [&quot;barcode&quot;]
    remote_prefixes: [&quot;&quot;]
    remote_keys: [&quot;minio&quot;]
    tags: [&quot;flb_pgsql&quot;, &quot;flb_minio&quot;, &quot;flb_files_metrics&quot;]
    include_measurement_name: true
  ...
</code></pre>
<p>Taking a look at the cameras, we can understand that:</p>
<ol>
<li>Data is only collected when the robot is not moving: <code>if_none_conditions: [&quot;moving&quot;]</code></li>
<li>Data is only collected when there is inspected data, so only when a QR code is detected: <code>if_all_conditions: [&quot;inspected_exists&quot;]</code></li>
<li>Data is not collected constantly: <code>init_max_measurements: -1</code></li>
<li>Only one record is collected when conditions are triggered: <code>condition_max_measurements: 1</code></li>
<li>Only images with inspected data are collected:
<ol>
<li><code>save_raw_img: false</code></li>
<li><code>save_rotated_img: false</code></li>
<li><code>save_detections_img: true</code></li>
</ol>
</li>
<li>Barcodes are scanned in each image: <code>detection_modules: [&quot;barcode&quot;]</code></li>
</ol>
<p>For the files-metrics, it is very important to have <code>include_measurement_name</code> since it relies on it to know in which field needs the paths are.</p>
<p>Then we add the destination:</p>
<pre><code class="language-yaml">destination_server:
  ros__parameters:
  ...
    destination_plugins: [&quot;flb_minio&quot;, &quot;flb_pgsql&quot;, &quot;flb_files_metrics&quot;]
    flb_files_metrics:
      plugin: &quot;dc_destinations/FlbFilesMetrics&quot;
      inputs:
        [
          &quot;/dc/measurement/right_camera&quot;,
          &quot;/dc/measurement/left_camera&quot;,
        ]
      file_storage: [&quot;minio&quot;]
      db_type: &quot;pgsql&quot;
      delete_when_sent: true
      minio:
        endpoint: 127.0.0.1:9000
        access_key_id: rQXPf1f730Yuu2yW
        secret_access_key: TYYkjN5L4gqDgCGLzQahHDcvqL4WNTcb
        use_ssl: false
        bucket: &quot;mybucket&quot;
        src_fields:
          [
            &quot;local_paths.inspected&quot;,
            &quot;local_paths.inspected&quot;
          ]
        upload_fields:
          [
            &quot;remote_paths.minio.inspected&quot;,
            &quot;remote_paths.minio.inspected&quot;
          ]
      pgsql:
        host: &quot;127.0.0.1&quot;
        port: &quot;5432&quot;
        user: fluentbit
        password: password
        database: &quot;fluentbit&quot;
        table: &quot;files_metrics&quot;
        timestamp_key: &quot;date&quot;
        time_format: &quot;double&quot;
        time_key: &quot;date&quot;
        ssl: false
    flb_minio:
      verbose_plugin: false
      time_format: &quot;iso8601&quot;
      plugin: &quot;dc_destinations/FlbMinIO&quot;
      inputs: [&quot;/dc/measurement/right_camera&quot;, &quot;/dc/measurement/left_camera&quot;]
      endpoint: 127.0.0.1:9000
      access_key_id: rQXPf1f730Yuu2yW
      secret_access_key: TYYkjN5L4gqDgCGLzQahHDcvqL4WNTcb
      use_ssl: false
      bucket: &quot;mybucket&quot;
      src_fields:
        [
          &quot;local_paths.inspected&quot;,
          &quot;local_paths.inspected&quot;
        ]
      upload_fields:
        [
          &quot;remote_paths.minio.inspected&quot;,
          &quot;remote_paths.minio.inspected&quot;
        ]
    flb_pgsql:
      plugin: &quot;dc_destinations/FlbPgSQL&quot;
      inputs:
        [
          &quot;/dc/measurement/right_camera&quot;,
          &quot;/dc/measurement/left_camera&quot;,
        ]
      host: &quot;127.0.0.1&quot;
      port: 5432
      user: fluentbit
      password: password
      database: &quot;fluentbit&quot;
      table: &quot;dc&quot;
      timestamp_key: &quot;date&quot;
      async: false
      time_format: &quot;double&quot;
      time_key: &quot;date&quot;
</code></pre>
<p>Here, we collect images with the MinIO plugin, also send metadata to PostreSQL.</p>
<p>In addition, flb_files_metrics tracks when the files are sent to MinIO and deletes them when it is done. Note that multiple destinations can be configured for each field. Check the plugin documentation to see which remote destinations are supported.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/demos/qrcodes_minio_pgsql.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="custom-uptime-to-stdout"><a class="header" href="#custom-uptime-to-stdout">Custom uptime to Stdout</a></h1>
<p>In this demo, we will go through a new use case. You want to create your own measurement or use an existing measurement provided by <code>dc_measurements</code> but not exactly, you want to add a field and also modify the JSON schema. That is what we will do here: create a new plugin, inside dc_demos, another package, create a plugin and load it</p>
<p>We are going to take the uptime measurement, change it slightly and collect the data.</p>
<p>To test it, run:</p>
<pre><code class="language-bash">$ ros2 launch dc_demos uptime_custom_stdout.launch.py
</code></pre>
<h2 id="json-schema"><a class="header" href="#json-schema">JSON schema</a></h2>
<p>Located in <code>dc_demos/plugins/measurements/json/uptime_custom.json</code>:</p>
<pre><code class="language-json">{
  &quot;$schema&quot;: &quot;http://json-schema.org/draft-07/schema#&quot;,
  &quot;title&quot;: &quot;Uptime Custom&quot;,
  &quot;description&quot;: &quot;Time the system has been up. Intentionally failing to demonstrate customization and callback&quot;,
  &quot;properties&quot;: {
    &quot;time&quot;: {
      &quot;description&quot;: &quot;Time the system has been up&quot;,
      &quot;type&quot;: &quot;integer&quot;,
      &quot;maximum&quot;: 0
    }
  },
  &quot;type&quot;: &quot;object&quot;
}
</code></pre>
<p>It is almost the same as the standard uptime, but for the sake of the example, we will set the maximum value to 0, which will certainly make the validation fail!</p>
<h2 id="cpp-code"><a class="header" href="#cpp-code">CPP code</a></h2>
<p>First, we create a hpp file in <code>dc_demos/include/dc_demos/plugins/measurements</code>:</p>
<pre><code class="language-cpp">#ifndef DC_DEMOS__PLUGINS__MEASUREMENTS__UPTIME_CUSTOM_HPP_
#define DC_DEMOS__PLUGINS__MEASUREMENTS__UPTIME_CUSTOM_HPP_

#include &lt;nlohmann/json.hpp&gt;

#include &quot;dc_measurements/measurement.hpp&quot;
#include &quot;dc_measurements/plugins/measurements/uptime.hpp&quot;

namespace dc_demos
{
using json = nlohmann::json;

class UptimeCustom : public dc_measurements::Uptime
{
protected:
  void onFailedValidation(json data_json) override;
  void setValidationSchema() override;
};

}  // namespace dc_demos

#endif  // DC_DEMOS__PLUGINS__MEASUREMENTS__UPTIME_CUSTOM_HPP_
</code></pre>
<p>We create a new class <code>UptimeCustom</code>, which inherits from <code>dc_measurements::Uptime</code>.</p>
<div id="admonition-info" class="admonition info">
<div class="admonition-title">
<p>Info</p>
<p><a class="admonition-anchor-link" href="dc/demos/custom_stdout.html#admonition-info"></a></p>
</div>
<div>
<p>If we wanted to start a new measurement from scratch, it would inherit from <code>dc_core::Measurement</code>.</p>
</div>
</div>
<p>The method <code>onFailedValidation</code> is not mandatory but it is here to show it is possible to trigger a custom function when the validation fails.</p>
<p>Then the cpp code, currently located in <code>dc_demos/plugins/measurements/uptime_custom.cpp</code>:</p>
<pre><code class="language-cpp">#include &quot;dc_demos/plugins/measurements/uptime_custom.hpp&quot;

namespace dc_demos
{

void UptimeCustom::onFailedValidation(json data_json)
{
  (void)data_json;
  RCLCPP_INFO(logger_, &quot;Callback! Validation failed for uptime custom&quot;);
}

void UptimeCustom::setValidationSchema()
{
  if (enable_validator_)
  {
    validateSchema(&quot;dc_demos&quot;, &quot;uptime_custom.json&quot;);
  }
}

}  // namespace dc_demos

#include &quot;pluginlib/class_list_macros.hpp&quot;
PLUGINLIB_EXPORT_CLASS(dc_demos::UptimeCustom, dc_core::Measurement)
</code></pre>
<p>We include the uptime_custom file header. Then, define the onFailedValidation function (triggered when validation fails) and the setValidationSchema function which sets the json with the new json schema</p>
<div id="admonition-info-1" class="admonition info">
<div class="admonition-title">
<p>Info</p>
<p><a class="admonition-anchor-link" href="dc/demos/custom_stdout.html#admonition-info-1"></a></p>
</div>
<div>
<p>Do not forget to include the pluginlib statements at the end to export the plugin class.</p>
</div>
</div>
<h2 id="plugin-file"><a class="header" href="#plugin-file">Plugin file</a></h2>
<p>Create the xml file, here will be <code>measurement_plugin.xml</code> for us, at the source of the package. It defines the plugins of the package.</p>
<pre><code class="language-xml">&lt;class_libraries&gt;
    &lt;library path=&quot;dc_uptime_custom_measurement&quot;&gt;
        &lt;class name=&quot;dc_demos/UptimeCustom&quot; type=&quot;dc_demos::UptimeCustom&quot; base_class_type=&quot;dc_core::Measurement&quot;&gt;
            &lt;description&gt;
                dc_measurement_uptime_custom
            &lt;/description&gt;
        &lt;/class&gt;
    &lt;/library&gt;
&lt;/class_libraries&gt;
</code></pre>
<h2 id="cmakeliststxt"><a class="header" href="#cmakeliststxt">CMakeLists.txt</a></h2>
<p>Now that you have all files set up, you can add the build process to the CMakeLists.txt:</p>
<pre><code class="language-cmake"># Measurement plugins
add_library(dc_uptime_custom_measurement SHARED
  plugins/measurements/uptime_custom.cpp
)
list(APPEND dc_measurement_plugin_libs dc_uptime_custom_measurement)

foreach(measurement_plugin ${dc_measurement_plugin_libs})
  ament_target_dependencies(${measurement_plugin} ${dependencies})
  target_link_libraries(
    ${measurement_plugin}
  )
  target_compile_definitions(${measurement_plugin} PRIVATE BT_PLUGIN_EXPORT)
endforeach()

pluginlib_export_plugin_description_file(dc_core measurement_plugin.xml)

install(FILES measurement_plugin.xml
  DESTINATION share/${PROJECT_NAME}
)

install(DIRECTORY plugins/measurements/
  DESTINATION share/${PROJECT_NAME}/plugins/measurements/
)
</code></pre>
<p>It creates the library, installs and exports it.</p>
<h2 id="console-output-3"><a class="header" href="#console-output-3">Console output</a></h2>
<p>In the measurement server log, the plugin is detected properly</p>
<pre><code>[component_container_isolated-1] [INFO] [1677715629.547448938] [measurement_server]: Creating measurement plugin uptime_custom: Type dc_demos/UptimeCustom, Group key: uptime, Polling interval: 5000, Debug: 0, Validator enabled: 1, Schema path: , Tags: [flb_stdout], Init collect: 1, Init Max measurement: 0, Include measurement name: 0, Include measurement plugin name: 0, Remote keys: , Remote prefixes: , Include measurement plugin name: 0, Max measurement on condition: 0, If all condition: , If any condition: , If none condition:
...
[component_container_isolated-1] [INFO] [1677715629.550523128] [measurement_server]: schema: {&quot;$schema&quot;:&quot;http://json-schema.org/draft-07/schema#&quot;,&quot;description&quot;:&quot;Time the system has been up. Intentionally failing to demonstrate customization and callback&quot;,&quot;properties&quot;:{&quot;time&quot;:{&quot;description&quot;:&quot;Time the system has been up&quot;,&quot;maximum&quot;:0,&quot;type&quot;:&quot;integer&quot;}},&quot;title&quot;:&quot;Uptime Custom&quot;,&quot;type&quot;:&quot;object&quot;}
</code></pre>
<p>Then, it fails as expected:</p>
<pre><code>[component_container_isolated-1] [ERROR] [1677715634.550778659] [measurement_server]: Validation failed: At /time of 139123 - instance exceeds maximum of 0
[component_container_isolated-1] data={&quot;tags&quot;:[&quot;flb_stdout&quot;],&quot;time&quot;:139123}
[component_container_isolated-1] [INFO] [1677715634.550911115] [measurement_server]: Callback! Validation failed for uptime custom
[component_container_isolated-1] [ERROR] [1677715639.550754853] [measurement_server]: Validation failed: At /time of 139128 - instance exceeds maximum of 0
[component_container_isolated-1] data={&quot;tags&quot;:[&quot;flb_stdout&quot;],&quot;time&quot;:139128}
[component_container_isolated-1] [INFO] [1677715639.550867662] [measurement_server]: Callback! Validation failed for uptime custom
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/demos/custom_stdout.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="concepts"><a class="header" href="#concepts">Concepts</a></h1>
<p>There are a few key concepts that are really important to understand how DC operates.</p>
<h2 id="ros-2"><a class="header" href="#ros-2">ROS 2</a></h2>
<p>ROS 2 is the core middleware used for DC. If you are unfamilar with this, please visit <a href="https://docs.ros.org/en/rolling/">the ROS 2 documentation</a> before continuing.</p>
<h2 id="fluent-bit-1"><a class="header" href="#fluent-bit-1">Fluent Bit</a></h2>
<p>Fluent Bit is used in the backend for most plugins in DC. If you are unfamilar with this, please visit <a href="https://docs.fluentbit.io/manual/">the Fluent Bit documentation</a></p>
<p>The DC destination ROS node starts it using the fluent bit C api and thus DC directly gets all benefits from it.</p>
<p>Fluent Bit configuration has been wrapped in this node and all its configuration parameters can be passed from the YAML configuration file.</p>
<h2 id="lifecycle-nodes-and-bond"><a class="header" href="#lifecycle-nodes-and-bond">Lifecycle Nodes and Bond</a></h2>
<p><em>(Source: <a href="https://navigation.ros.org/concepts/index.html">Nav2 documentation</a>)</em></p>
<p>Lifecycle (or Managed, more correctly) nodes are unique to ROS 2. More information can be <a href="https://design.ros2.org/articles/node_lifecycle.html">found here</a>. They are nodes that contain state machine transitions for bringup and teardown of ROS 2 servers. This helps in deterministic behavior of ROS systems in startup and shutdown. It also helps users structure their programs in reasonable ways for commercial uses and debugging.</p>
<p>When a node is started, it is in the unconfigured state, only processing the node’s constructor which should not contain any ROS networking setup or parameter reading. By the launch system, or the supplied lifecycle manager, the nodes need to be transitioned to inactive by configuring. After, it is possible to activate the node by transitioning through the activating stage.</p>
<p>This state will allow the node to process information and be fully setup to run. The configuration stage, triggering the on_configure() method, will setup all parameters, ROS networking interfaces, and for safety systems, all dynamically allocated memory. The activation stage, triggering the on_activate() method, will active the ROS networking interfaces and set any states in the program to start processing information.</p>
<p>To shutdown, we transition into deactivating, cleaning up, shutting down and end in the finalized state. The networking interfaces are deactivated and stop processing, deallocate memory, exit cleanly, in those stages, respectively.</p>
<p>The lifecycle node framework is used extensively through out this project and all servers utilize it. It is best convention for all ROS systems to use lifecycle nodes if it is possible.</p>
<p>Within DC, we use a wrapper of LifecycleNodes, nav2_util LifecycleNode from Nav2. This wrapper wraps much of the complexities of LifecycleNodes for typical applications. It also includes a bond connection for the lifecycle manager to ensure that after a server transitions up, it also remains active. If a server crashes, it lets the lifecycle manager know and transition down the system to prevent a critical failure. See <a href="https://navigation.ros.org/migration/Eloquent.html#eloquent-migration">Eloquent to Foxy</a> for details.</p>
<h2 id="measurements-2"><a class="header" href="#measurements-2">Measurements</a></h2>
<p>Measurements are a single data unit presented in JSON format, that can contain different fields. For example, Memory measurement:</p>
<pre><code class="language-json">{
    &quot;date&quot;: &quot;2022-12-04T14:16:06.810999008&quot;,
    &quot;memory&quot;: {
        &quot;used&quot;: 76.007431
    },
}
</code></pre>
<p>Every incoming piece of data that belongs to a log or a metric that is retrieved by DC is considered an Event or Record.</p>
<p>Internally, when using Fluent Bit based plugins, it will contain 2 components: its timestamp and its message. For us, in DC, it will always be a JSON string sent in a ROS message of StringStamped type. This ROS message contains:</p>
<ol>
<li><strong>header</strong>: ROS timestamp as std_msgs/Header</li>
<li><strong>data</strong>: JSON message as string</li>
<li><strong>group_key</strong>: a string used as a key for the new message when grouping multiple messages together</li>
</ol>
<h2 id="tags"><a class="header" href="#tags">Tag(s)</a></h2>
<p>Every measurement requires to have at least a tag configured (via the <code>tags</code> parameter) so it is sent to its destination(s). This tag corresponds to the name of the plugin you defined in the same configuration. It is then used in a later stage by the Router to decide which Filter or Output phase it must go through.</p>
<p>Example:</p>
<pre><code class="language-yaml">destination_server:
  ros__parameters:
    destination_plugins: [&quot;flb_stdout&quot;]
    flb_stdout: # Custom name for the plugin
      plugin: &quot;dc_destinations/FlbStdout&quot;
      inputs: [&quot;/dc/measurement/string_stamped&quot;]
measurement_server:
  ros__parameters:
    measurement_plugins: [&quot;uptime&quot;]
    uptime:
      plugin: &quot;dc_measurements/Uptime&quot;
      topic_output: &quot;/dc/measurement/uptime&quot;
      tags: [&quot;flb_stdout&quot;] # Match the plugin set in the destination_server
</code></pre>
<p>To manage the tags in DC, we pass the tags as parameter to each measurement and automatically use 2 Fluent Bit filters to assign the ROS message to a certain Fluent Bit output:</p>
<ol>
<li>rewrite_tag filter: Modify the message tag to the destination(s) configured</li>
<li>lua filter: Take the flags received as a string containing a list and set the tags internally in Fluent Bit.</li>
</ol>
<p>You can find th code in flb_destination.hpp</p>
<h2 id="match"><a class="header" href="#match">Match</a></h2>
<p>Fluent Bit allows to deliver your collected and processed Events to one or multiple destinations, this is done through a routing phase. A Match represent a simple rule to select Events where its tags matches a defined rule.</p>
<h2 id="destinations-2"><a class="header" href="#destinations-2">Destinations</a></h2>
<p>A destination is where the data will be sent: AWS S3, stdout, AWS Kinesis. It has the possibility to use <a href="https://docs.fluentbit.io/manual/pipeline/outputs">outputs from fluentbit</a>.</p>
<h2 id="conditions-2"><a class="header" href="#conditions-2">Conditions</a></h2>
<p>A condition enables or disables one or multiple measurements to be published and thus collected. We could for example enable collecting camera images only when a robot is stopped.</p>
<p>Data collection for a measurement can be enabled if one of many conditions are activated, multiple conditions are activated or none.</p>
<h2 id="timestamp"><a class="header" href="#timestamp">Timestamp</a></h2>
<p>The Timestamp represents the time when an Event was created. All events are converting the ROS now time to timestamps (UTC)</p>
<h2 id="json-messages"><a class="header" href="#json-messages">JSON Messages</a></h2>
<p>In DC, all messages sent by measurements are a ROS message and the data string <strong>must</strong> be a JSON message.</p>
<pre><code class="language-bash">&quot;Robot_X:1.5, Robot_Y:1.8&quot; # Not valid data string
&quot;{'x': 1.5, 'y': 1.8}&quot;     # Valid data string
</code></pre>
<h2 id="json-validation"><a class="header" href="#json-validation">JSON validation</a></h2>
<p>Each record follows a JSON schema by default, it follows this specification document <a href="https://json-schema.org/draft/2020-12/json-schema-validation.html">JSON Schema Validation</a>.</p>
<p>Each measurement has its own JSON schema, which can be overwritten in a custom package or disabled.</p>
<h2 id="buffering-and-data-persistence"><a class="header" href="#buffering-and-data-persistence">Buffering and data persistence</a></h2>
<p>Fluent Bit has its own buffering management, explained in <a href="https://docs.fluentbit.io/manual/concepts/buffering">its documentation</a>. Data can be stored in Memory or/and filesystem.</p>
<p>By default, DC uses the memory buffering for a small amount of data (5M) and then uses filesystem buffering.</p>
<p>The configuration is printed when starting the destination server:</p>
<pre><code class="language-bash">[destination_server-2] [2023/02/24 10:36:15] [ info] [storage] ver=1.3.0, type=memory+filesystem, sync=full, checksum=off, max_chunks_up=128
[destination_server-2] [2023/02/24 10:36:15] [ info] [input:ros2:ros2.0] storage_strategy='filesystem' (memory + filesystem)
[destination_server-2] [2023/02/24 10:36:15] [ info] [input:storage_backlog:storage_backlog.1] queue memory limit: 976.6K
</code></pre>
<p>This buffering ensures data will persist across reboots</p>
<h2 id="scheduling-and-retries"><a class="header" href="#scheduling-and-retries">Scheduling and Retries</a></h2>
<p>DC inherits from Fluent Bit features of scheduling and retries. It can be configured in the destination node. More about it can be read on the <a href="https://docs.fluentbit.io/manual/administration/scheduling-and-retries">Fluent Bit documentation</a></p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/concepts.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="data-pipeline"><a class="header" href="#data-pipeline">Data Pipeline</a></h1>
<pre class="mermaid">flowchart LR
    dc_bringup_launch[&quot;DC Bringup Launch&quot;]
    yaml_param[&quot;YAML Parameter file&quot;]
    ros_middleware[&quot;ROS middleware&quot;]

    subgraph m_s[&quot;Measurement Server&quot;]
        direction LR
        meas_node[&quot;Measurement Node&quot;]
        measurement_plugins[&quot;Measurement plugins&quot;]
        meas_topics_out[&quot;ROS Topics&quot;]
    end

    subgraph d_s[&quot;Destination Server&quot;]
        direction LR
        dest_node[&quot;Destination Node&quot;]
        dest_plugins[&quot;Destination plugins&quot;]
    end

    subgraph g_s[&quot;Group Server&quot;]
        direction LR
        group_node[&quot;Group Node&quot;]
        group_grouped_data[&quot;Grouped data&quot;]
        group_topics_out[&quot;ROS Topics&quot;]
    end

    subgraph flb[&quot;Fluent Bit&quot;]
        direction LR
        flb_server[&quot;Fluent Bit Server&quot;]
        flb_mem_buff[&quot;Memory buffer&quot;]
        flb_storage_buff[&quot;Storage buffer&quot;]
        flb_record[&quot;Record&quot;]
        flb_ros2_plugin[&quot;ROS2 plugin&quot;]
        flb_output[&quot;Outputs&quot;]
    end

    dc_bringup_launch--2.starts--&gt;meas_node
    dc_bringup_launch--3.starts--&gt;dest_node
    dc_bringup_launch--4.starts--&gt;group_node
    dc_bringup_launch--1.loads--&gt;yaml_param

    meas_node--2.1.initializes--&gt;measurement_plugins
    measurement_plugins--&quot;2.2.publish to&quot;--&gt;meas_topics_out

    dest_node--3.1.starts--&gt;flb_server
    dest_node--3.2.initializes--&gt;dest_plugins
    dest_node--3.3.loads--&gt;flb_ros2_plugin

    flb_ros2_plugin--&quot;3.3.subscribes to&quot;--&gt;meas_topics_out
    flb_ros2_plugin--&quot;3.3.subscribes to&quot;--&gt;group_topics_out
    group_node--&quot;4.1.subscribes to&quot;--&gt;meas_topics_out
    group_node--4.2.generates--&gt;group_grouped_data
    group_grouped_data--&quot;4.3.publishes to&quot;--&gt;group_topics_out

    flb_ros2_plugin--3.4.generates--&gt;flb_record
    flb_record--&quot;3.5.stores in&quot;--&gt;flb_mem_buff
    flb_record--&quot;3.7.stores in&quot;--&gt;flb_storage_buff
    flb_mem_buff--3.6.flushes--&gt;flb_output
    flb_storage_buff--3.8.flushes--&gt;flb_output

    group_topics_out--&quot;4.4.sends to&quot;--&gt;ros_middleware
    meas_topics_out--&quot;2.3.sends to&quot;--&gt;ros_middleware
    ros_middleware--&quot;when data received, sends to&quot;--&gt;flb_ros2_plugin
</pre>
<p>The data flow precised in this flowchart summarizes how data moves:</p>
<ol>
<li>DC Bringup loads the yaml configuration file</li>
<li>DC Bringup starts the measurement node
<ol>
<li>Measurement plugins are loaded and data starts to be collected</li>
<li>Each plugin publishes what it collected on a ROS topic</li>
</ol>
</li>
<li>DC Bringup starts the destination node
<ol>
<li>Fluent Bit server is started: as soon as it receives records, it goes through filters and then is flushed to desired destinations</li>
<li>Destination plugins are loaded</li>
<li>ROS2 Fluent Bit plugin is loaded: it subscribes to measurement and group output topics</li>
<li>Fluent Bit filters are initialized: it edits data received, modify the tags to match the desired output(s) and edit the timestamp field if required</li>
</ol>
</li>
<li>DC Bringup starts the group node
<ol>
<li>Subscribes to measurement and group topics outputs</li>
<li>When all measurements of a group are received, it groups the JSONs into a new one</li>
<li>It publishes the grouped data on another topic</li>
</ol>
</li>
</ol>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/data_pipeline.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="measurements-3"><a class="header" href="#measurements-3">Measurements</a></h1>
<h2 id="description"><a class="header" href="#description">Description</a></h2>
<p>Measurements are a single data unit presented in JSON format, that can contain different fields. For example, Memory measurement:</p>
<pre><code class="language-json">{
    &quot;date&quot;: &quot;2022-12-04T14:16:06.810999008&quot;,
    &quot;memory&quot;: {
        &quot;used&quot;: 76.007431
    },
    &quot;id&quot;: &quot;3c70afdcb6f248f28f4c3980734064c5&quot;,
    &quot;robot_name&quot;: &quot;C3PO&quot;,
    &quot;run_id&quot;: 358
}
</code></pre>
<h2 id="node-parameters"><a class="header" href="#node-parameters">Node parameters</a></h2>
<p>The node starts the fluent bit engine and its ros2 plugin and enables data collection from ROS 2 topics. This plugin will subscribe to the configured ROS 2 topics and data will be collected by Fluent Bit to destinations enabled by the <a href="dc/./destinations.html">destination node</a>.
Each topic is configured in a measurement, which is loaded in this node with pluginlib.
In addition, conditions are pluginlibs plugin also loaded dynamically. They are optional plugins that allow to collect on some conditions, e.g robot is moving.</p>
<div class="table-wrapper"><table><thead><tr><th>Parameter name</th><th>Description</th><th>Type(s)</th><th>Default</th></tr></thead><tbody>
<tr><td>measurement_plugins</td><td>Name of the measurement plugins to load</td><td>list[str]</td><td>N/A (mandatory)</td></tr>
<tr><td>condition_plugins</td><td>Name of the condition plugins to load</td><td>list[str]</td><td>N/A (mandatory)</td></tr>
<tr><td>save_local_base_path</td><td>Path where files will be saved locally (e.g camera images). Expands $X to environment variables and =Y to custom string parameters</td><td>str</td><td>&quot;$HOME/ros2/data/%Y/%M/%D/%H&quot;</td></tr>
<tr><td>all_base_path</td><td>Path where files will be saved at their destination (S3, minio...). Expands $X to environment variables and =Y to custom string parameters</td><td>str</td><td>&quot;&quot;</td></tr>
<tr><td>custom_str_params_list</td><td>Custom strings to use in other parameters. They are also appended in the json sent to the destination</td><td>list[str]</td><td>N/A</td></tr>
<tr><td>custom_str_params.force_override</td><td>Override values if the keys are already present in the measurement. Applies to all and can be overridden by <code>custom_str_params.&lt;param_name&gt;.force_override</code></td><td>bool</td><td>false</td></tr>
<tr><td></td><td></td><td></td><td></td></tr>
<tr><td>custom_str_params.&lt;param_name&gt;.name</td><td>Key to add in the serialized data</td><td>str</td><td>N/A (optional)</td></tr>
<tr><td>custom_str_params.&lt;param_name&gt;.value</td><td>Value to set for the key as a fixed string</td><td>str</td><td>N/A (optional)</td></tr>
<tr><td>custom_str_params.&lt;param_name&gt;.value_from_file</td><td>Path to a file containing the value to set</td><td>str</td><td>N/A (optional)</td></tr>
<tr><td>custom_str_params.&lt;param_name&gt;.force_override</td><td>Override value if the key is already present in the measurement</td><td>bool</td><td>false</td></tr>
<tr><td>run_id.enabled</td><td>Identify which run the robot is. A new one is generated at every start of the node. Uses either a counter or UUID</td><td>str</td><td>true</td></tr>
<tr><td>run_id.counter</td><td>Enable counter for the run_id</td><td>str</td><td>true</td></tr>
<tr><td>run_id.counter_path</td><td>Path to store the last run. It is expanded with environment variables id</td><td>str</td><td>&quot;$HOME/run_id&quot;</td></tr>
<tr><td>run_id.uuid</td><td>Generate a new run ID by using a random UUID</td><td>str</td><td>false</td></tr>
</tbody></table>
</div>
<h2 id="plugin-parameters"><a class="header" href="#plugin-parameters">Plugin parameters</a></h2>
<p>Each measurement is collected through a node and has these configuration parameters:</p>
<div class="table-wrapper"><table><thead><tr><th>Parameter name</th><th>Description</th><th>Type(s)</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>plugin</strong></td><td>Name of the plugin to load</td><td>str</td><td>N/A (mandatory)</td></tr>
<tr><td><strong>topic_output</strong></td><td>Topic where result will be published</td><td>str</td><td>&quot;/dc/measurement/&lt;measurement_name&gt;&quot;</td></tr>
<tr><td><strong>group_key</strong></td><td>Value of the key used when grouped</td><td>str</td><td>N/A (mandatory)</td></tr>
<tr><td><strong>debug</strong></td><td>More verbose output</td><td>bool</td><td>false</td></tr>
<tr><td><strong>polling_interval</strong></td><td>Interval to which data is collected in milliseconds</td><td>int (&gt;=100)</td><td>1000</td></tr>
<tr><td><strong>init_collect</strong></td><td>Collect when the node starts instead of waiting the first tick</td><td>bool</td><td>true</td></tr>
<tr><td><strong>init_max_measurements</strong></td><td>Collect a maximum of n measurements when starting the node (-1 = never, 0 = infinite)</td><td>int</td><td>0</td></tr>
<tr><td><strong>condition_max_measurements</strong></td><td>Collect a maximum of n measurements when conditions are activated (-1 = never, 0 = infinite)</td><td>int</td><td>0</td></tr>
<tr><td><strong>enable_validator</strong></td><td>Will validate the data against a JSON schema</td><td>bool</td><td>true</td></tr>
<tr><td><strong>json_schema_path</strong></td><td>Path to the JSON schema, ignored if empty string</td><td>str</td><td>N/A (optional)</td></tr>
<tr><td><strong>tags</strong></td><td>Tags used by Fluent Bit to do the matching to destinations</td><td>list[str]</td><td>N/A (mandatory)</td></tr>
<tr><td><strong>remote_prefixes</strong></td><td>Prefixes to apply to the paths when sending files to a destination</td><td>str</td><td>N/A (optional)</td></tr>
<tr><td><strong>remote_keys</strong></td><td>Used by some plugins to generate remote paths</td><td>list[str]</td><td>N/A (optional)</td></tr>
<tr><td><strong>if_all_conditions</strong></td><td>Collect only if all conditions are activated</td><td>list[str]</td><td>N/A (optional)</td></tr>
<tr><td><strong>if_any_conditions</strong></td><td>Collect if any conditions is activated</td><td>list[str]</td><td>N/A (optional)</td></tr>
<tr><td><strong>if_none_conditions</strong></td><td>Collect only if all conditions are not activated</td><td>list[str]</td><td>N/A (optional)</td></tr>
<tr><td><strong>include_measurement_name</strong></td><td>Include measurement name in the JSON data</td><td>bool</td><td>false</td></tr>
<tr><td><strong>include_measurement_plugin</strong></td><td>Include measurement plugin name in the JSON data</td><td>bool</td><td>false</td></tr>
</tbody></table>
</div>
<h2 id="available-plugins"><a class="header" href="#available-plugins">Available plugins:</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="dc/./measurements/camera.html">Camera</a></td><td>Camera images, images can be rotated and inspected to detect content in images. They are saved as files</td></tr>
<tr><td><a href="dc/./measurements/cmd_vel.html">Command velocity</a></td><td>Command velocity: navigation commands</td></tr>
<tr><td><a href="dc/./measurements/cpu.html">CPU</a></td><td>CPU statistics</td></tr>
<tr><td><a href="dc/./measurements/distance_traveled.html">Distance traveled</a></td><td>Total distance traveled by the robot</td></tr>
<tr><td><a href="dc/./measurements/dummy.html">Dummy</a></td><td>Dummy event, for testing and debugging</td></tr>
<tr><td><a href="dc/./measurements/ip_camera.html">IP Camera</a></td><td>IP camera videos as files</td></tr>
<tr><td><a href="dc/./measurements/map.html">Map</a></td><td>ROS map files (yaml and pgm) and metadata used by the robot to localize and navigate</td></tr>
<tr><td><a href="dc/./measurements/memory.html">Memory</a></td><td>System memory usage</td></tr>
<tr><td><a href="dc/./measurements/network.html">Network</a></td><td>Network interfaces, availability</td></tr>
<tr><td><a href="dc/./measurements/os.html">OS</a></td><td>Operating System information</td></tr>
<tr><td><a href="dc/./measurements/permissions.html">Permissions</a></td><td>Permissions of a file or directory</td></tr>
<tr><td><a href="dc/./measurements/position.html">Position</a></td><td>Robot position</td></tr>
<tr><td><a href="dc/./measurements/speed.html">Speed</a></td><td>Robot speed</td></tr>
<tr><td><a href="dc/./measurements/storage.html">Storage</a></td><td>Available and used space in a directory</td></tr>
<tr><td><a href="dc/./measurements/string_stamped.html">String stamped</a></td><td>Republish a string stamped message, can be used for external data</td></tr>
<tr><td><a href="dc/./measurements/tcp_health.html">TCP Health</a></td><td>Health status of a TCP Server</td></tr>
<tr><td><a href="dc/./measurements/uptime.html">Uptime</a></td><td>How long the machine has been turned on</td></tr>
</tbody></table>
</div><footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/measurements.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="camera"><a class="header" href="#camera">Camera</a></h1>
<h2 id="description-1"><a class="header" href="#description-1">Description</a></h2>
<p>Save camera image files: raw, rotated and/or inspected. Images can be inspected using different services (e.g barcode detection)</p>
<h2 id="parameters"><a class="header" href="#parameters">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>cam_name</strong></td><td>Name to give to the camera</td><td>str</td><td>N/A (mandatory)</td></tr>
<tr><td><strong>cam_topic</strong></td><td>Topic from where camera data needs to be fetched</td><td>str</td><td>N/A (mandatory)</td></tr>
<tr><td><strong>detection_modules</strong></td><td>Detection modules to use</td><td>list[str](barcode)</td><td>N/A (optional)</td></tr>
<tr><td><strong>draw_det_barcodes</strong></td><td>Draw barcode detection on images</td><td>bool</td><td>true</td></tr>
<tr><td><strong>rotation_angle</strong></td><td>Rotate the image before inspecting it by this angle</td><td>int (90, 180, 270)</td><td>0</td></tr>
<tr><td><strong>save_detections_img</strong></td><td>Whether to save inspected image captured by the camera with detection shapes</td><td>bool</td><td>true</td></tr>
<tr><td><strong>save_inspected_base64</strong></td><td>Whether to save inspected image captured by the camera with detection shapes as base64 string</td><td>bool</td><td>false</td></tr>
<tr><td><strong>save_inspected_path</strong></td><td>Path to save the inspected camera image. Expands environment variables and datetime format are expanded</td><td>str</td><td>&quot;camera/inspected/%Y-%m-%dT%H:%M:%S&quot;</td></tr>
<tr><td><strong>save_raw_base64</strong></td><td>Whether to save raw image captured by the camera as base64 string</td><td>bool</td><td>false</td></tr>
<tr><td><strong>save_raw_img</strong></td><td>Whether to save raw image captured by the camera</td><td>bool</td><td>false</td></tr>
<tr><td><strong>save_raw_path</strong></td><td>Path to save the raw camera image. Expands environment variables and datetime</td><td>str</td><td>&quot;camera/raw/%Y-%m-%dT%H:%M:%S&quot;</td></tr>
<tr><td><strong>save_rotated_base64</strong></td><td>Whether to save rotated image captured by the camera as base64 string</td><td>bool</td><td>false</td></tr>
<tr><td><strong>save_rotated_img</strong></td><td>Whether to save rotated image captured by the camera</td><td>bool</td><td>false</td></tr>
<tr><td><strong>save_rotated_path</strong></td><td>Path to save the rotated camera image. Expands environment variables and datetime format are expanded</td><td>str</td><td>&quot;camera/rotated/%Y-%m-%dT%H:%M:%S&quot;</td></tr>
</tbody></table>
</div>
<h2 id="measurement-node-configuration"><a class="header" href="#measurement-node-configuration">Measurement node configuration</a></h2>
<p>The remote paths are also saved in the JSON under <em>&lt;measurement_name&gt;.<destination>_img_paths.(raw|rotated|inspected)</em>. If images want to be sent to Minio, add &quot;minio&quot; in <em>remote_keys</em>. This will add a remote path that can later be used in your API.</p>
<p>Note that this remote key is not included in the JSON schema, which only contains the local paths. If you want to enforce the schema with your custom remote key, you will need to write it and load it manually.</p>
<pre><code class="language-yaml">...
camera:
  plugin: &quot;dc_measurements/Camera&quot;
  group_key: &quot;camera_with_codes&quot;
  topic_output: &quot;/dc/measurement/camera_with_codes&quot;
  polling_interval: 10000
  init_collect: true
  node_name: &quot;dc_measurement_camera&quot;
  cam_topic: &quot;/camera_with_codes&quot;
  cam_name: my_camera_with_codes
  enable_validator: false
  draw_det_barcodes: true
  save_raw_img: true
  save_rotated_img: false
  save_detections_img: true
  save_raw_path: &quot;camera_with_codes/raw/%Y-%m-%dT%H-%M-%S&quot;
  save_rotated_path: &quot;camera_with_codes/rotated/%Y-%m-%dT%H-%M-%S&quot;
  save_inspected_path: &quot;camera_with_codes/inspected/%Y-%m-%dT%H-%M-%S&quot;
  rotation_angle: 0
  detection_modules: [&quot;barcode&quot;]
  remote_prefixes: [&quot;&quot;]
  remote_keys: [&quot;minio&quot;] # Will create paths for Minio, does not send the file
</code></pre>
<h3 id="destination-node-configuration"><a class="header" href="#destination-node-configuration">Destination node configuration</a></h3>
<p>Now that the path is set, it can be used to know where to send the image:</p>
<pre><code class="language-yaml">...
flb_minio:
  verbose_plugin: false
  time_format: &quot;iso8601&quot;
  plugin: &quot;dc_destinations/FlbMinIO&quot;
  inputs: [&quot;/dc/group/cameras&quot;]
  endpoint: 127.0.0.1:9000
  access_key_id: XEYqG4ZcPY5jiq5i
  secret_access_key: ji011KCtI82ZeQS6UwsQAg8x9VR4lSaQ
  use_ssl: false
  create_bucket: true
  bucket: &quot;mybucket&quot;
  src_fields:
    [
      &quot;camera.local_img_paths.raw&quot;,
      &quot;camera.local_img_paths.inspected&quot;
    ]
  upload_fields: # Remote paths created by the measurement node configuration
    [
      &quot;camera.minio_img_paths.raw&quot;,
      &quot;camera.minio_img_paths.inspected&quot;
    ]
...
</code></pre>
<h2 id="schema"><a class="header" href="#schema">Schema</a></h2>
<pre><code class="language-json">{
  &quot;$schema&quot;:&quot;http://json-schema.org/draft-07/schema#&quot;,
  &quot;title&quot;:&quot;Camera&quot;,
  &quot;description&quot;:&quot;Camera images with detected objects&quot;,
  &quot;properties&quot;:{
    &quot;camera_name&quot;: {
      &quot;description&quot;: &quot;Name of the camera&quot;,
      &quot;type&quot;: &quot;string&quot;
    },
    &quot;local_img_paths&quot;:{
      &quot;description&quot;:&quot;Paths of saved images&quot;,
      &quot;type&quot;:&quot;object&quot;,
      &quot;items&quot;:{
        &quot;$ref&quot;:&quot;#/$defs/local_img_paths&quot;
      }
    },
    &quot;inspected&quot;:{
      &quot;description&quot;:&quot;Inspected content of an image&quot;,
      &quot;type&quot;:&quot;object&quot;,
      &quot;items&quot;:{
        &quot;$ref&quot;:&quot;#/$defs/inspected&quot;
      }
    }
  },
  &quot;$defs&quot;:{
    &quot;local_img_paths&quot;:{
      &quot;type&quot;:&quot;object&quot;,
      &quot;properties&quot;:{
        &quot;raw&quot;:{
          &quot;description&quot;:&quot;Raw image&quot;,
          &quot;type&quot;:&quot;string&quot;
        },
        &quot;rotated&quot;:{
          &quot;description&quot;:&quot;Rotated image&quot;,
          &quot;type&quot;:&quot;string&quot;
        },
        &quot;inspected&quot;:{
          &quot;description&quot;:&quot;Inspected image&quot;,
          &quot;type&quot;:&quot;string&quot;
        }
      }
    },
    &quot;inspected&quot;:{
      &quot;type&quot;:&quot;object&quot;,
      &quot;properties&quot;:{
        &quot;barcode&quot;:{
          &quot;description&quot;:&quot;Barcode inspected data&quot;,
          &quot;type&quot;:&quot;array&quot;,
          &quot;items&quot;:{
            &quot;$ref&quot;:&quot;#/$defs/barcode&quot;
          }
        }
      }
    },
    &quot;barcode&quot;:{
      &quot;type&quot;:&quot;object&quot;,
      &quot;properties&quot;:{
        &quot;data&quot;:{
          &quot;description&quot;:&quot;Barcode data&quot;,
          &quot;type&quot;:&quot;array&quot;,
          &quot;items&quot;:{
            &quot;type&quot;:&quot;integer&quot;
          }
        },
        &quot;height&quot;:{
          &quot;description&quot;:&quot;Barcode height&quot;,
          &quot;type&quot;:&quot;integer&quot;
        },
        &quot;width&quot;:{
          &quot;description&quot;:&quot;Barcode width&quot;,
          &quot;type&quot;:&quot;integer&quot;
        },
        &quot;top&quot;:{
          &quot;description&quot;:&quot;Barcode top position&quot;,
          &quot;type&quot;:&quot;integer&quot;
        },
        &quot;left&quot;:{
          &quot;description&quot;:&quot;Barcode left position&quot;,
          &quot;type&quot;:&quot;integer&quot;
        },
        &quot;type&quot;:{
          &quot;description&quot;:&quot;Barcode type&quot;,
          &quot;type&quot;:&quot;string&quot;
        }
      }
    }
  },
  &quot;type&quot;:&quot;object&quot;
}
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/measurements/camera.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="cmd_vel"><a class="header" href="#cmd_vel">Cmd_vel</a></h1>
<h2 id="description-2"><a class="header" href="#description-2">Description</a></h2>
<p>Collect command velocity sent to the robot by subscribing to cmd_vel topic.</p>
<h2 id="parameters-1"><a class="header" href="#parameters-1">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>topic</strong></td><td>Topic to subscribe to to get the cmd_vel (geometry_msgs/Twist)</td><td>str</td><td>&quot;/cmd_vel&quot;</td></tr>
</tbody></table>
</div>
<h2 id="schema-1"><a class="header" href="#schema-1">Schema</a></h2>
<pre><code class="language-json">{
    &quot;$schema&quot;: &quot;http://json-schema.org/draft-07/schema#&quot;,
    &quot;title&quot;: &quot;Cmd_vel&quot;,
    &quot;description&quot;: &quot;Command velocity sent to the robot&quot;,
    &quot;properties&quot;: {
        &quot;computed&quot;: {
            &quot;description&quot;: &quot;Computed command velocity in meter/s&quot;,
            &quot;type&quot;: &quot;number&quot;
        },
        &quot;linear&quot;: {
            &quot;description&quot;: &quot;Linear velocity as a vector&quot;,
            &quot;type&quot;: &quot;object&quot;,
            &quot;items&quot;: {
                &quot;$ref&quot;: &quot;#/$defs/vector3&quot;
            }
        },
        &quot;angular&quot;: {
            &quot;description&quot;: &quot;Angular velocity as a vector&quot;,
            &quot;type&quot;: &quot;object&quot;,
            &quot;items&quot;: {
                &quot;$ref&quot;: &quot;#/$defs/vector3&quot;
            }
        }
    },
    &quot;$defs&quot;: {
        &quot;vector3&quot;: {
            &quot;type&quot;: &quot;object&quot;,
            &quot;properties&quot;: {
                &quot;x&quot;: {
                    &quot;description&quot;: &quot;X speed&quot;,
                    &quot;type&quot;: &quot;number&quot;
                },
                &quot;y&quot;: {
                    &quot;description&quot;: &quot;Y speed&quot;,
                    &quot;type&quot;: &quot;number&quot;
                },
                &quot;z&quot;: {
                    &quot;description&quot;: &quot;Z speed&quot;,
                    &quot;type&quot;: &quot;number&quot;
                }
            }
        }
    },
    &quot;type&quot;: &quot;object&quot;
}
</code></pre>
<h2 id="measurement-configuration"><a class="header" href="#measurement-configuration">Measurement configuration</a></h2>
<pre><code class="language-yaml">...
cmd_vel:
  plugin: &quot;dc_measurements/CmdVel&quot;
  group_key: &quot;cmd_vel&quot;
  topic_output: &quot;/dc/measurement/cmd_vel&quot;
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/measurements/cmd_vel.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="cpu"><a class="header" href="#cpu">CPU</a></h1>
<h2 id="description-3"><a class="header" href="#description-3">Description</a></h2>
<p>Collect cpu usage: average cpu, number of processes running and processes sorted by cpu usage.</p>
<h2 id="parameters-2"><a class="header" href="#parameters-2">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>cpu_min</strong></td><td>Filters out processes using less than this cpu usage. -1 to disable</td><td>float</td><td>5.0</td></tr>
<tr><td><strong>max_processes</strong></td><td>Max amount of processes to collect in the sorted field. -1 for all</td><td>int</td><td>5</td></tr>
</tbody></table>
</div>
<h2 id="schema-2"><a class="header" href="#schema-2">Schema</a></h2>
<pre><code class="language-json">{
    &quot;$schema&quot;: &quot;http://json-schema.org/draft-07/schema#&quot;,
    &quot;title&quot;: &quot;Cpu&quot;,
    &quot;description&quot;: &quot;CPU statistics&quot;,
    &quot;properties&quot;: {
        &quot;average&quot;: {
            &quot;description&quot;: &quot;Average CPU&quot;,
            &quot;type&quot;: &quot;number&quot;,
            &quot;minimum&quot;: 0
        },
        &quot;processes&quot;: {
            &quot;description&quot;: &quot;Number of processes running&quot;,
            &quot;type&quot;: &quot;integer&quot;,
            &quot;minimum&quot;: 0
        },
        &quot;sorted&quot;: {
            &quot;description&quot;: &quot;Processes sorted by CPU usage&quot;,
            &quot;type&quot;: &quot;array&quot;,
            &quot;items&quot;: {
                &quot;$ref&quot;: &quot;#/$defs/process&quot;
            }
        }
    },
    &quot;$defs&quot;: {
        &quot;process&quot;: {
            &quot;type&quot;: &quot;object&quot;,
            &quot;description&quot;: &quot;Process information&quot;,
            &quot;properties&quot;: {
                &quot;pid&quot;: {
                    &quot;description&quot;: &quot;Process ID of the process&quot;,
                    &quot;type&quot;: &quot;integer&quot;
                },
                &quot;user&quot;: {
                    &quot;description&quot;: &quot;User who started the process&quot;,
                    &quot;type&quot;: &quot;string&quot;
                },
                &quot;cmd&quot;: {
                    &quot;description&quot;: &quot;Command that launched the process&quot;,
                    &quot;type&quot;: &quot;string&quot;
                },
                &quot;cpu&quot;: {
                    &quot;description&quot;: &quot;Process' current utilization as a percentage of total CPU time&quot;,
                    &quot;type&quot;: &quot;number&quot;
                },
                &quot;ram&quot;: {
                    &quot;description&quot;: &quot;Memory in use by this process in kb&quot;,
                    &quot;type&quot;: &quot;integer&quot;
                },
                &quot;uptime&quot;: {
                    &quot;description&quot;: &quot;Age of the process in seconds&quot;,
                    &quot;type&quot;: &quot;integer&quot;
                }
            }
        }
    },
    &quot;type&quot;: &quot;object&quot;
}
</code></pre>
<h2 id="measurement-configuration-1"><a class="header" href="#measurement-configuration-1">Measurement configuration</a></h2>
<pre><code class="language-yaml">...
cpu:
  plugin: &quot;dc_measurements/Cpu&quot;
  topic_output: &quot;/dc/measurement/cpu&quot;
  tags: [&quot;flb_stdout&quot;]
  max_processes: 10
  cpu_min: 10.0
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/measurements/cpu.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="dummy"><a class="header" href="#dummy">Dummy</a></h1>
<h2 id="description-4"><a class="header" href="#description-4">Description</a></h2>
<p>The dummy measurement, generates dummy events. It is useful for testing, debugging, benchmarking and getting started with ROS 2 Data collection.</p>
<h2 id="parameters-3"><a class="header" href="#parameters-3">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>record</strong></td><td>Dummy JSON record.</td><td>str</td><td>&quot;{&quot;message&quot;:&quot;Hello from ROS 2 DC&quot;}&quot;</td></tr>
</tbody></table>
</div>
<h2 id="schema-3"><a class="header" href="#schema-3">Schema</a></h2>
<pre><code class="language-json">{
    &quot;$schema&quot;: &quot;http://json-schema.org/draft-07/schema#&quot;,
    &quot;title&quot;: &quot;Dummy&quot;,
    &quot;description&quot;: &quot;Dummy JSON&quot;,
    &quot;properties&quot;: {
        &quot;message&quot;: {
            &quot;description&quot;: &quot;Dummy message&quot;,
            &quot;type&quot;: &quot;string&quot;
        }
    },
    &quot;type&quot;: &quot;object&quot;
}
</code></pre>
<h2 id="measurement-configuration-2"><a class="header" href="#measurement-configuration-2">Measurement configuration</a></h2>
<pre><code class="language-yaml">...
dummy:
  plugin: &quot;dc_measurements/Dummy&quot;
  topic_output: &quot;/dc/measurement/dummy&quot;
  tags: [&quot;flb_stdout&quot;]
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/measurements/dummy.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="distance-traveled"><a class="header" href="#distance-traveled">Distance traveled</a></h1>
<h2 id="description-5"><a class="header" href="#description-5">Description</a></h2>
<p>Collect total distance traveled in the robot since it is powered.</p>
<h2 id="parameters-4"><a class="header" href="#parameters-4">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>global_frame</strong></td><td>Global frame</td><td>str</td><td>&quot;map&quot;</td></tr>
<tr><td><strong>robot_base_frame</strong></td><td>Robot base frame</td><td>str</td><td>&quot;base_link&quot;</td></tr>
<tr><td><strong>transform_timeout</strong></td><td>TF Timeout to use for transformation</td><td>float</td><td>0.1</td></tr>
</tbody></table>
</div>
<h2 id="schema-4"><a class="header" href="#schema-4">Schema</a></h2>
<pre><code class="language-json">{
    &quot;$schema&quot;: &quot;http://json-schema.org/draft-07/schema#&quot;,
    &quot;title&quot;: &quot;Distance traveled&quot;,
    &quot;description&quot;: &quot;Total distance traveled in meters by the robot&quot;,
    &quot;properties&quot;: {
        &quot;distance_traveled&quot;: {
            &quot;description&quot;: &quot;Total distance traveled in meters&quot;,
            &quot;type&quot;: &quot;number&quot;
        }
    },
    &quot;type&quot;: &quot;object&quot;
}
</code></pre>
<h2 id="measurement-configuration-3"><a class="header" href="#measurement-configuration-3">Measurement configuration</a></h2>
<pre><code class="language-yaml">...
distance_traveled:
  plugin: &quot;dc_measurements/DistanceTraveled&quot;
  topic_output: &quot;/dc/measurement/distance_traveled&quot;
  tags: [&quot;flb_stdout&quot;]
  global_frame: &quot;map&quot;
  robot_base_frame: &quot;base_link&quot;
  transform_timeout: 0.1
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/measurements/distance_traveled.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="ip-camera"><a class="header" href="#ip-camera">Ip Camera</a></h1>
<h2 id="description-6"><a class="header" href="#description-6">Description</a></h2>
<p>Records video in small segments (in case of a cut) and store it locally.
They are first stored in a temporary folder. Once the record (of e.g 10 seconds) is done, it is moved to another directory.</p>
<p>Compared to other plugins, the collect function only moves the files from the temporary location, it does not start the recording. It takes some time to establish connection, so we avoid doing this every time. Recording is started at initialization by an ffmpeg process and saved in <a href="https://www.wikiwand.com/en/HTTP_Live_Streaming">HLS format</a>.</p>
<h2 id="parameters-5"><a class="header" href="#parameters-5">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>input</strong></td><td>Input url</td><td>str</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>video</strong></td><td>Enable video recording</td><td>bool</td><td>true</td></tr>
<tr><td><strong>audio</strong></td><td>Enable audio recording</td><td>bool</td><td>false</td></tr>
<tr><td><strong>bitrate_video</strong></td><td>Video bitrate</td><td>str(<code>[0-9]+[kmKM]</code>)</td><td>&quot;2M&quot;</td></tr>
<tr><td><strong>bitrate_audio</strong></td><td>Audio bitrate</td><td>str(<code>[0-9]+[kmKM]</code>)</td><td>&quot;192k&quot;</td></tr>
<tr><td><strong>segment</strong></td><td>Records by small segment, managed by ffmpeg</td><td>bool</td><td>bool</td></tr>
<tr><td><strong>segment_time</strong></td><td>Duration of a segment</td><td>int (&gt;0)</td><td>10</td></tr>
<tr><td><strong>ffmpeg_log_level</strong></td><td>Ffmpeg log level</td><td>str (See <a href="https://ffmpeg.org/ffmpeg.html">doc</a>)</td><td>&quot;info&quot;</td></tr>
<tr><td><strong>ffmpeg_banner</strong></td><td>Show ffmpeg banner in console</td><td>bool</td><td>true</td></tr>
<tr><td><strong>save_path</strong></td><td>Path used to save files with ffmpeg, UTC date is used. There can't be &quot;:&quot; in this string, ffmpeg does not parse it</td><td>str</td><td>&quot;ffmpeg_%Y-%m-%dT%H:%M:%S&quot;</td></tr>
</tbody></table>
</div>
<h2 id="schema-5"><a class="header" href="#schema-5">Schema</a></h2>
<pre><code class="language-json">{
    &quot;$schema&quot;: &quot;http://json-schema.org/draft-07/schema#&quot;,
    &quot;title&quot;: &quot;Ip Camera&quot;,
    &quot;description&quot;: &quot;Local and remote path where the remote camera video is recorded&quot;,
    &quot;properties&quot;: {
        &quot;local_path&quot;: {
            &quot;description&quot;: &quot;Local video path&quot;,
            &quot;type&quot;: &quot;string&quot;
        },
        &quot;remote_path&quot;: {
            &quot;description&quot;: &quot;Remote video path&quot;,
            &quot;type&quot;: &quot;string&quot;
        }
    },
    &quot;type&quot;: &quot;object&quot;
}
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/measurements/ip_camera.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="map"><a class="header" href="#map">Map</a></h1>
<h2 id="description-7"><a class="header" href="#description-7">Description</a></h2>
<p>Save map using nav2_map_server and collect the map of the local map saved. The measurement also includes metadata: width, height and x and y origin.</p>
<h2 id="parameters-6"><a class="header" href="#parameters-6">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>quiet</strong></td><td>Disable stdout for nav2 map saver</td><td>bool</td><td>true</td></tr>
<tr><td><strong>save_path</strong></td><td>Path to save the map to. Environment variables and datetime format are expanded</td><td>str</td><td>&quot;map/%Y-%m-%dT%H:%M:%S&quot;</td></tr>
<tr><td><strong>save_map_timeout</strong></td><td>Time to wait to save the map</td><td>float</td><td>3.0</td></tr>
<tr><td><strong>topic</strong></td><td>Topic to subscribe to to get the map</td><td>str</td><td>&quot;/map&quot;</td></tr>
</tbody></table>
</div>
<h2 id="schema-6"><a class="header" href="#schema-6">Schema</a></h2>
<pre><code class="language-json">{
    &quot;$schema&quot;: &quot;http://json-schema.org/draft-07/schema#&quot;,
    &quot;title&quot;: &quot;Map&quot;,
    &quot;description&quot;: &quot;Map saved metadata and paths&quot;,
    &quot;properties&quot;: {
        &quot;resolution&quot;: {
            &quot;description&quot;: &quot;Resolution of the map, meters/pixel&quot;,
            &quot;type&quot;: &quot;number&quot;,
            &quot;minimum&quot;: 0
        },
        &quot;local_paths&quot;: {
            &quot;description&quot;: &quot;Paths where metadata and image are stored&quot;,
            &quot;type&quot;: &quot;object&quot;,
            &quot;items&quot;: {
                &quot;$ref&quot;: &quot;#/$defs/paths&quot;
            }
        },
        &quot;origin&quot;: {
            &quot;description&quot;: &quot;Robot origin position in meters&quot;,
            &quot;type&quot;: &quot;object&quot;,
            &quot;items&quot;: {
                &quot;$ref&quot;: &quot;#/$defs/origin&quot;
            }
        },
        &quot;width&quot;: {
            &quot;description&quot;: &quot;Width of the PGM&quot;,
            &quot;type&quot;: &quot;integer&quot;,
            &quot;minimum&quot;: 0
        },
        &quot;height&quot;: {
            &quot;description&quot;: &quot;Height of the PGM&quot;,
            &quot;type&quot;: &quot;integer&quot;,
            &quot;minimum&quot;: 0
        }
    },
    &quot;$defs&quot;: {
        &quot;origin&quot;: {
            &quot;type&quot;: &quot;object&quot;,
            &quot;description&quot;: &quot;The 2-D pose of the lower-left pixel in the map, as (x, y, yaw), with yaw as counterclockwise rotation (yaw=0 means no rotation). Many parts of the system currently ignore yaw.&quot;,
            &quot;properties&quot;: {
                &quot;x&quot;: {
                    &quot;description&quot;: &quot;X origin of the robot&quot;,
                    &quot;type&quot;: &quot;number&quot;
                },
                &quot;y&quot;: {
                    &quot;description&quot;: &quot;Y origin of the robot&quot;,
                    &quot;type&quot;: &quot;number&quot;
                }
            }
        },
        &quot;paths&quot;: {
            &quot;type&quot;: &quot;object&quot;,
            &quot;properties&quot;: {
                &quot;png&quot;: {
                    &quot;description&quot;: &quot;Path to the map PNG file containing the image&quot;,
                    &quot;type&quot;: &quot;string&quot;
                },
                &quot;yaml&quot;: {
                    &quot;description&quot;: &quot;Path to the map YAML file containing map metadata&quot;,
                    &quot;type&quot;: &quot;string&quot;
                },
                &quot;pgm&quot;: {
                    &quot;description&quot;: &quot;Path to the map PGM file containing the gray-scale image&quot;,
                    &quot;type&quot;: &quot;string&quot;
                }
            }
        }
    },
    &quot;type&quot;: &quot;object&quot;
}
</code></pre>
<h2 id="measurement-configuration-4"><a class="header" href="#measurement-configuration-4">Measurement configuration</a></h2>
<pre><code class="language-yaml">...
map:
  plugin: &quot;dc_measurements/Map&quot;
  topic_output: &quot;/dc/measurement/map&quot;
  tags: [&quot;flb_stdout&quot;]
  topic: &quot;/map&quot;
  save_map: &quot;map/%Y-%m-%dT%H:%M:%S&quot;
  save_map_timeout: 0.2
  quiet: true
  remote_keys: [&quot;s3&quot;]
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/measurements/map.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="memory"><a class="header" href="#memory">Memory</a></h1>
<h2 id="description-8"><a class="header" href="#description-8">Description</a></h2>
<p>Collect memory used in percentage.</p>
<h2 id="schema-7"><a class="header" href="#schema-7">Schema</a></h2>
<pre><code class="language-json">{
    &quot;$schema&quot;: &quot;http://json-schema.org/draft-07/schema#&quot;,
    &quot;title&quot;: &quot;Memory&quot;,
    &quot;description&quot;: &quot;Memory used&quot;,
    &quot;properties&quot;: {
        &quot;used&quot;: {
            &quot;description&quot;: &quot;Memory used in percent&quot;,
            &quot;type&quot;: &quot;number&quot;,
            &quot;minimum&quot;: 0
        }
    },
    &quot;type&quot;: &quot;object&quot;
}
</code></pre>
<h2 id="measurement-configuration-5"><a class="header" href="#measurement-configuration-5">Measurement configuration</a></h2>
<pre><code class="language-yaml">...
memory:
  plugin: &quot;dc_measurements/Memory&quot;
  topic_output: &quot;/dc/measurement/memory&quot;
  tags: [&quot;flb_stdout&quot;]
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/measurements/memory.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="network"><a class="header" href="#network">Network</a></h1>
<h2 id="description-9"><a class="header" href="#description-9">Description</a></h2>
<p>Collects ping value, whether or not the PC is online and interfaces available.</p>
<h2 id="parameters-7"><a class="header" href="#parameters-7">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>ping_address</strong></td><td>IP address to test the ping to</td><td>str</td><td>&quot;8.8.8.8&quot;</td></tr>
<tr><td><strong>ping_timeout</strong></td><td>Time in ms before ping times out. Offline if superior to it</td><td>int</td><td>5000</td></tr>
</tbody></table>
</div>
<h2 id="schema-8"><a class="header" href="#schema-8">Schema</a></h2>
<pre><code class="language-json">{
    &quot;$schema&quot;: &quot;http://json-schema.org/draft-07/schema#&quot;,
    &quot;title&quot;: &quot;Network&quot;,
    &quot;description&quot;: &quot;Network accessibility and information&quot;,
    &quot;properties&quot;: {
        &quot;ping&quot;: {
            &quot;description&quot;: &quot;Time to ping the host in ms&quot;,
            &quot;type&quot;: &quot;integer&quot;,
            &quot;minimum&quot;: -1
        },
        &quot;online&quot;: {
            &quot;description&quot;: &quot;If the pc is online&quot;,
            &quot;type&quot;: &quot;boolean&quot;
        },
        &quot;interfaces&quot;: {
            &quot;description&quot;: &quot;List of network interfaces&quot;,
            &quot;type&quot;: &quot;array&quot;,
            &quot;items&quot;: {
                &quot;type&quot;: &quot;string&quot;
            }
        }
    },
    &quot;type&quot;: &quot;object&quot;
}
</code></pre>
<h2 id="measurement-configuration-6"><a class="header" href="#measurement-configuration-6">Measurement configuration</a></h2>
<pre><code class="language-yaml">...
network:
  plugin: &quot;dc_measurements/Network&quot;
  topic_output: &quot;/dc/measurement/network&quot;
  tags: [&quot;flb_stdout&quot;]
  ping_address: 192.168.0.1
  ping_timeout: 500
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/measurements/network.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="os"><a class="header" href="#os">OS</a></h1>
<h2 id="description-10"><a class="header" href="#description-10">Description</a></h2>
<p>Collects the Operating System information: cpus, operating system name and kernel information</p>
<h2 id="schema-9"><a class="header" href="#schema-9">Schema</a></h2>
<pre><code class="language-json">{
  &quot;$schema&quot;: &quot;http://json-schema.org/draft-07/schema#&quot;,
  &quot;title&quot;: &quot;OS&quot;,
  &quot;description&quot;: &quot;OS, kernel and CPUs information&quot;,
  &quot;properties&quot;: {
    &quot;os&quot;: {
      &quot;description&quot;: &quot;Host distribution name&quot;,
      &quot;type&quot;: &quot;string&quot;
    },
    &quot;kernel&quot;: {
      &quot;description&quot;: &quot;Kernel version&quot;,
      &quot;type&quot;: &quot;string&quot;
    },
    &quot;cpu&quot;: {
      &quot;description&quot;: &quot;Number of CPUs&quot;,
      &quot;type&quot;: &quot;integer&quot;,
      &quot;minimum&quot;: 0
    },
    &quot;memory&quot;: {
      &quot;description&quot;: &quot;System memory&quot;,
      &quot;type&quot;: &quot;number&quot;,
      &quot;minimum&quot;: 0
    }
  },
  &quot;type&quot;: &quot;object&quot;
}
</code></pre>
<h2 id="measurement-configuration-7"><a class="header" href="#measurement-configuration-7">Measurement configuration</a></h2>
<pre><code class="language-yaml">...
os:
  plugin: &quot;dc_measurements/OS&quot;
  topic_output: &quot;/dc/measurement/os&quot;
  tags: [&quot;flb_stdout&quot;]
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/measurements/os.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="permissions"><a class="header" href="#permissions">Permissions</a></h1>
<h2 id="description-11"><a class="header" href="#description-11">Description</a></h2>
<p>Collect UID, GID, if a file or directory exists and its permissions (in rwx or integer format).</p>
<h2 id="parameters-8"><a class="header" href="#parameters-8">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>format</strong></td><td>Format to collect permissions in</td><td>str(rwx or int)</td><td>&quot;int&quot;</td></tr>
<tr><td><strong>path</strong></td><td>Path to the file or directory to collect data from, support environment variables</td><td>str</td><td>N/A (mandatory)</td></tr>
</tbody></table>
</div>
<h2 id="schemas"><a class="header" href="#schemas">Schemas</a></h2>
<pre><code class="language-json">{
    &quot;$schema&quot;: &quot;http://json-schema.org/draft-07/schema#&quot;,
    &quot;title&quot;: &quot;Permissions&quot;,
    &quot;description&quot;: &quot;Permissions of a file/directory&quot;,
    &quot;properties&quot;: {
        &quot;uid&quot;: {
            &quot;description&quot;: &quot;File/directory User IDentifier&quot;,
            &quot;type&quot;: &quot;integer&quot;
        },
        &quot;gid&quot;: {
            &quot;description&quot;: &quot;File/directory Group IDentifier&quot;,
            &quot;type&quot;: &quot;integer&quot;
        },
        &quot;exists&quot;: {
            &quot;description&quot;: &quot;File/directory exists&quot;,
            &quot;type&quot;: &quot;boolean&quot;
        },
        &quot;permissions&quot;: {
            &quot;description&quot;: &quot;Permissions as rwx or integer&quot;,
            &quot;type&quot;: &quot;string&quot;
        }
    },
    &quot;type&quot;: &quot;object&quot;
}
</code></pre>
<h2 id="measurement-configuration-8"><a class="header" href="#measurement-configuration-8">Measurement configuration</a></h2>
<pre><code class="language-yaml">...
permission_home_dc:
  plugin: &quot;dc_measurements/Permissions&quot;
  topic_output: &quot;/dc/measurement/permissions_home_dc&quot;
  tags: [&quot;flb_stdout&quot;]
  path: &quot;$HOME/dc&quot;
  format: &quot;rwx&quot;
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/measurements/permissions.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="position"><a class="header" href="#position">Position</a></h1>
<h2 id="description-12"><a class="header" href="#description-12">Description</a></h2>
<p>Collect x, y and yaw of the robot.</p>
<h2 id="parameters-9"><a class="header" href="#parameters-9">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>global_frame</strong></td><td>Global frame</td><td>str</td><td>&quot;map&quot;</td></tr>
<tr><td><strong>robot_base_frame</strong></td><td>Robot base frame</td><td>str</td><td>&quot;base_link&quot;</td></tr>
<tr><td><strong>transform_timeout</strong></td><td>TF Timeout to use for transformation</td><td>float</td><td>0.1</td></tr>
</tbody></table>
</div>
<h2 id="schema-10"><a class="header" href="#schema-10">Schema</a></h2>
<pre><code class="language-json">{
    &quot;$schema&quot;: &quot;http://json-schema.org/draft-07/schema#&quot;,
    &quot;title&quot;: &quot;Position&quot;,
    &quot;description&quot;: &quot;Position and orientation of the robot&quot;,
    &quot;properties&quot;: {
        &quot;x&quot;: {
            &quot;description&quot;: &quot;X position of the robot&quot;,
            &quot;type&quot;: &quot;number&quot;
        },
        &quot;y&quot;: {
            &quot;description&quot;: &quot;Y position of the robot&quot;,
            &quot;type&quot;: &quot;number&quot;
        },
        &quot;yaw&quot;: {
            &quot;description&quot;: &quot;Yaw angle of the robot&quot;,
            &quot;type&quot;: &quot;number&quot;
        }
    },
    &quot;type&quot;: &quot;object&quot;
}
</code></pre>
<h2 id="measurement-configuration-9"><a class="header" href="#measurement-configuration-9">Measurement configuration</a></h2>
<pre><code class="language-yaml">...
position:
  plugin: &quot;dc_measurements/Position&quot;
  topic_output: &quot;/dc/measurement/position&quot;
  tags: [&quot;flb_stdout&quot;]
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/measurements/position.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="speed"><a class="header" href="#speed">Speed</a></h1>
<h2 id="description-13"><a class="header" href="#description-13">Description</a></h2>
<p>Collect robot speed using the Odom topic.</p>
<h2 id="parameters-10"><a class="header" href="#parameters-10">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>odom_topic</strong></td><td>Topic to subscribe to to get the odometry (nav_msgs/Odometry)</td><td>str</td><td>&quot;/odom&quot;</td></tr>
</tbody></table>
</div>
<h2 id="schema-11"><a class="header" href="#schema-11">Schema</a></h2>
<pre><code class="language-json">{
    &quot;$schema&quot;: &quot;http://json-schema.org/draft-07/schema#&quot;,
    &quot;title&quot;: &quot;Speed&quot;,
    &quot;description&quot;: &quot;Computed, linear and angular speed of the robot&quot;,
    &quot;properties&quot;: {
        &quot;computed&quot;: {
            &quot;description&quot;: &quot;Computed speed in meter/s&quot;,
            &quot;type&quot;: &quot;number&quot;
        },
        &quot;linear&quot;: {
            &quot;description&quot;: &quot;Linear velocity as a vector&quot;,
            &quot;type&quot;: &quot;object&quot;,
            &quot;items&quot;: {
                &quot;$ref&quot;: &quot;#/$defs/vector3&quot;
            }
        },
        &quot;angular&quot;: {
            &quot;description&quot;: &quot;Angular velocity as a vector&quot;,
            &quot;type&quot;: &quot;object&quot;,
            &quot;items&quot;: {
                &quot;$ref&quot;: &quot;#/$defs/vector3&quot;
            }
        }
    },
    &quot;$defs&quot;: {
        &quot;vector3&quot;: {
            &quot;type&quot;: &quot;object&quot;,
            &quot;properties&quot;: {
                &quot;x&quot;: {
                    &quot;description&quot;: &quot;X speed&quot;,
                    &quot;type&quot;: &quot;number&quot;
                },
                &quot;y&quot;: {
                    &quot;description&quot;: &quot;Y speed&quot;,
                    &quot;type&quot;: &quot;number&quot;
                },
                &quot;z&quot;: {
                    &quot;description&quot;: &quot;Z speed&quot;,
                    &quot;type&quot;: &quot;number&quot;
                }
            }
        }
    },
    &quot;type&quot;: &quot;object&quot;
}
</code></pre>
<h2 id="measurement-configuration-10"><a class="header" href="#measurement-configuration-10">Measurement configuration</a></h2>
<pre><code class="language-yaml">...
speed:
  plugin: &quot;dc_measurements/Speed&quot;
  topic_output: &quot;/dc/measurement/speed&quot;
  tags: [&quot;flb_stdout&quot;]
  odom_topic: &quot;/odom&quot;
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/measurements/speed.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="storage"><a class="header" href="#storage">Storage</a></h1>
<h2 id="description-14"><a class="header" href="#description-14">Description</a></h2>
<p>Collect storage information on a directory.</p>
<h2 id="parameters-11"><a class="header" href="#parameters-11">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>path</strong></td><td>Absolute path to the directory to inspect, expect environment variables</td><td>str</td><td>N/A (Mandatory)</td></tr>
</tbody></table>
</div>
<h2 id="schema-12"><a class="header" href="#schema-12">Schema</a></h2>
<pre><code class="language-json">{
    &quot;$schema&quot;: &quot;http://json-schema.org/draft-07/schema#&quot;,
    &quot;title&quot;: &quot;Storage&quot;,
    &quot;description&quot;: &quot;Storage information of a directory&quot;,
    &quot;properties&quot;: {
        &quot;free_percent&quot;: {
            &quot;description&quot;: &quot;Free space on the filesystem, in percent&quot;,
            &quot;type&quot;: &quot;number&quot;,
            &quot;minimum&quot;: 0
        },
        &quot;free&quot;: {
            &quot;description&quot;: &quot;Free space on the filesystem, in bytes&quot;,
            &quot;type&quot;: &quot;integer&quot;,
            &quot;minimum&quot;: 0
        },
        &quot;capacity&quot;: {
            &quot;description&quot;: &quot;Total size of the filesystem, in bytes&quot;,
            &quot;type&quot;: &quot;integer&quot;,
            &quot;minimum&quot;: 0
        }
    },
    &quot;type&quot;: &quot;object&quot;
}
</code></pre>
<h2 id="measurement-configuration-11"><a class="header" href="#measurement-configuration-11">Measurement configuration</a></h2>
<pre><code class="language-yaml">...
storage_home:
  plugin: &quot;dc_measurements/Storage&quot;
  topic_output: &quot;/dc/measurement/storage_home&quot;
  tags: [&quot;flb_stdout&quot;]
  path: &quot;$HOME&quot;
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/measurements/storage.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="string-stamped"><a class="header" href="#string-stamped">String stamped</a></h1>
<h2 id="description-15"><a class="header" href="#description-15">Description</a></h2>
<p>Collect generic data from a topic publishing a StringStamped message and republish it. It allows to fetch data from rclc, rclpy and your custom ROS 2 nodes that don't have use a plugin.</p>
<h2 id="parameters-12"><a class="header" href="#parameters-12">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>timer_based</strong></td><td>If true, collect data at interval and if false collect every record and ignores polling_interval</td><td>bool</td><td>true</td></tr>
<tr><td><strong>topic</strong></td><td>Topic to get data from</td><td>str</td><td>N/A (mandatory)</td></tr>
</tbody></table>
</div>
<h2 id="schema-13"><a class="header" href="#schema-13">Schema</a></h2>
<p>Given that the data is customized here, there is no default schema.</p>
<h2 id="measurement-configuration-12"><a class="header" href="#measurement-configuration-12">Measurement configuration</a></h2>
<pre><code class="language-yaml">...
my_data:
  plugin: &quot;dc_measurements/StringStamped&quot;
  topic_output: &quot;/dc/measurement/my_data&quot;
  tags: [&quot;flb_stdout&quot;]
  topic: &quot;/hello-world&quot;
  timer_based: true
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/measurements/string_stamped.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="tcp-health"><a class="header" href="#tcp-health">TCP Health</a></h1>
<h2 id="description-16"><a class="header" href="#description-16">Description</a></h2>
<p>Collects status of a TCP server.</p>
<h2 id="parameters-13"><a class="header" href="#parameters-13">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>name</strong></td><td>Alias to give to the TCP Server</td><td>str</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>host</strong></td><td>Name of the target host or IP address to check</td><td>str</td><td>&quot;127.0.0.1&quot; (Optional)</td></tr>
<tr><td><strong>port</strong></td><td>TCP port where to perform the connection check.</td><td>int(&gt;0 &lt;65536)</td><td>80 (Optional)</td></tr>
</tbody></table>
</div>
<h2 id="schema-14"><a class="header" href="#schema-14">Schema</a></h2>
<pre><code class="language-json">{
    &quot;$schema&quot;: &quot;http://json-schema.org/draft-07/schema#&quot;,
    &quot;title&quot;: &quot;TCP Health&quot;,
    &quot;description&quot;: &quot;Status of a TCP server&quot;,
    &quot;properties&quot;: {
        &quot;host&quot;: {
            &quot;description&quot;: &quot;Server hostname&quot;,
            &quot;type&quot;: &quot;string&quot;
        },
        &quot;port&quot;: {
            &quot;description&quot;: &quot;Port number&quot;,
            &quot;type&quot;: &quot;integer&quot;,
            &quot;minimum&quot;: 1,
            &quot;maximum&quot;: 65536
        },
        &quot;server_name&quot;: {
            &quot;description&quot;: &quot;Time the system has been up&quot;,
            &quot;type&quot;: &quot;string&quot;
        }
    },
    &quot;type&quot;: &quot;object&quot;
}
</code></pre>
<h2 id="measurement-configuration-13"><a class="header" href="#measurement-configuration-13">Measurement configuration</a></h2>
<pre><code class="language-yaml">...
tcp_health:
  plugin: &quot;dc_measurements/TCPHealth&quot;
  topic_output: &quot;/dc/measurement/minio_health&quot;
  group_key: &quot;minio_health&quot;
  tags: [&quot;flb_stdout&quot;]
  host: &quot;127.0.0.1&quot;
  port: 9000
  name: &quot;minio_api&quot;
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/measurements/tcp_health.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="uptime"><a class="header" href="#uptime">Uptime</a></h1>
<h2 id="description-17"><a class="header" href="#description-17">Description</a></h2>
<p>Time since when the robot PC has been on.</p>
<h2 id="schema-15"><a class="header" href="#schema-15">Schema</a></h2>
<pre><code class="language-json">{
    &quot;$schema&quot;: &quot;http://json-schema.org/draft-07/schema#&quot;,
    &quot;title&quot;: &quot;Uptime&quot;,
    &quot;description&quot;: &quot;Time the system has been up&quot;,
    &quot;properties&quot;: {
        &quot;time&quot;: {
            &quot;description&quot;: &quot;Time the system has been up&quot;,
            &quot;type&quot;: &quot;integer&quot;,
            &quot;minimum&quot;: 0
        }
    },
    &quot;type&quot;: &quot;object&quot;
}
</code></pre>
<h2 id="measurement-configuration-14"><a class="header" href="#measurement-configuration-14">Measurement configuration</a></h2>
<pre><code class="language-yaml">...
uptime:
  plugin: &quot;dc_measurements/Uptime&quot;
  topic_output: &quot;/dc/measurement/uptime&quot;
  tags: [&quot;flb_stdout&quot;]
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/measurements/uptime.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="overview"><a class="header" href="#overview">Overview</a></h1>
<h2 id="description-18"><a class="header" href="#description-18">Description</a></h2>
<p>A condition enables or disables one or multiple measurements to be published and thus collected. We could for example enable collecting camera images only when a robot is stopped:</p>
<p>Each condition is enabled or disabled through a pluginlib plugin. It has these configuration parameters:</p>
<h2 id="available-plugins-1"><a class="header" href="#available-plugins-1">Available plugins:</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="dc/./conditions/moving.html">Robot moving</a></td><td>Robot is moving</td></tr>
<tr><td><a href="dc/./conditions/bool_equal.html">Bool equal</a></td><td>Value of a boolean key is equal to</td></tr>
<tr><td><a href="dc/./conditions/double_equal.html">Double equal</a></td><td>Value of a double key is equal to</td></tr>
<tr><td><a href="dc/./conditions/double_inferior.html">Double inferior</a></td><td>Value of a double key is inferior to</td></tr>
<tr><td><a href="dc/./conditions/double_superior.html">Double superior</a></td><td>Value of a double key is superior to</td></tr>
<tr><td><a href="dc/./conditions/exist.html">Exist</a></td><td>Key exists</td></tr>
<tr><td><a href="dc/./conditions/integer_equal.html">Integer equal</a></td><td>Value of an integer key is equal to</td></tr>
<tr><td><a href="dc/./conditions/integer_inferior.html">Integer inferior</a></td><td>Value of an integer key is inferior to</td></tr>
<tr><td><a href="dc/./conditions/integer_superior.html">Integer superior</a></td><td>Value of an integer key is superior to</td></tr>
<tr><td><a href="dc/./conditions/list_bool_equal.html">List bool equal</a></td><td>Value of a list of boolean key is equal to</td></tr>
<tr><td><a href="dc/./conditions/list_double_equal.html">List double equal</a></td><td>Value of a list of double key is equal to</td></tr>
<tr><td><a href="dc/./conditions/list_integer_equal.html">List integer equal</a></td><td>Value of a list of integer key is equal to</td></tr>
<tr><td><a href="dc/./conditions/list_string_equal.html">List string equal</a></td><td>Value of a list of string key is equal to</td></tr>
<tr><td><a href="dc/./conditions/same_as_previous.html">Same as previous</a></td><td>Value of the key is the same as the previous one</td></tr>
<tr><td><a href="dc/./conditions/string_match.html">String match</a></td><td>Value of a string key matches the regex of</td></tr>
</tbody></table>
</div><footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/conditions.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="bool-equal"><a class="header" href="#bool-equal">Bool equal</a></h1>
<h2 id="description-19"><a class="header" href="#description-19">Description</a></h2>
<p>Compare JSON key value to the value passed in parameter and returns true if equal.</p>
<h2 id="parameters-14"><a class="header" href="#parameters-14">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>key</strong></td><td>JSON key where value is located, separate nested dictionary with <strong>/</strong></td><td>str</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>value</strong></td><td>Value to which compare the JSON value</td><td>bool</td><td>N/A (Mandatory)</td></tr>
</tbody></table>
</div><footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/conditions/bool_equal.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="double-equal"><a class="header" href="#double-equal">Double equal</a></h1>
<h2 id="description-20"><a class="header" href="#description-20">Description</a></h2>
<p>Compare JSON key value to the value passed in parameter and returns true if equal.</p>
<h2 id="parameters-15"><a class="header" href="#parameters-15">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>key</strong></td><td>JSON key where value is located, separate nested dictionary with <strong>/</strong></td><td>str</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>value</strong></td><td>Value to which compare the JSON value</td><td>float</td><td>N/A (Mandatory)</td></tr>
</tbody></table>
</div><footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/conditions/double_equal.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="double-inferior"><a class="header" href="#double-inferior">Double inferior</a></h1>
<h2 id="description-21"><a class="header" href="#description-21">Description</a></h2>
<p>Compare JSON key value to the value passed in parameter and returns true if inferior.</p>
<h2 id="parameters-16"><a class="header" href="#parameters-16">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>key</strong></td><td>JSON key where value is located, separate nested dictionary with <strong>/</strong></td><td>str</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>value</strong></td><td>Value to which compare the JSON value</td><td>float</td><td>N/A (Mandatory)</td></tr>
</tbody></table>
</div><footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/conditions/double_inferior.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="double-superior"><a class="header" href="#double-superior">Double superior</a></h1>
<h2 id="description-22"><a class="header" href="#description-22">Description</a></h2>
<p>Compare JSON key value to the value passed in parameter and returns true if superior.</p>
<h2 id="parameters-17"><a class="header" href="#parameters-17">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>key</strong></td><td>JSON key where value is located, separate nested dictionary with <strong>/</strong></td><td>str</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>value</strong></td><td>Value to which compare the JSON value</td><td>float</td><td>N/A (Mandatory)</td></tr>
</tbody></table>
</div><footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/conditions/double_superior.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="exist"><a class="header" href="#exist">Exist</a></h1>
<h2 id="description-23"><a class="header" href="#description-23">Description</a></h2>
<p>Compare JSON key value to the value passed in parameter and returns true if exists.</p>
<h2 id="parameters-18"><a class="header" href="#parameters-18">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>key</strong></td><td>JSON key where value is located, separate nested dictionary with <strong>/</strong></td><td>str</td><td>N/A (Mandatory)</td></tr>
</tbody></table>
</div><footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/conditions/exist.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="integer-equal"><a class="header" href="#integer-equal">Integer equal</a></h1>
<h2 id="description-24"><a class="header" href="#description-24">Description</a></h2>
<p>Compare JSON key value to the value passed in parameter and returns true if equal.</p>
<h2 id="parameters-19"><a class="header" href="#parameters-19">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>key</strong></td><td>JSON key where value is located, separate nested dictionary with <strong>/</strong></td><td>str</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>value</strong></td><td>Value to which compare the JSON value</td><td>int</td><td>N/A (Mandatory)</td></tr>
</tbody></table>
</div><footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/conditions/integer_equal.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="integer-inferior"><a class="header" href="#integer-inferior">Integer inferior</a></h1>
<h2 id="description-25"><a class="header" href="#description-25">Description</a></h2>
<p>Compare JSON key value to the value passed in parameter and returns true if inferior.</p>
<h2 id="parameters-20"><a class="header" href="#parameters-20">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>key</strong></td><td>JSON key where value is located, separate nested dictionary with <strong>/</strong></td><td>str</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>value</strong></td><td>Value to which compare the JSON value</td><td>int</td><td>N/A (Mandatory)</td></tr>
</tbody></table>
</div><footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/conditions/integer_inferior.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="integer-superior"><a class="header" href="#integer-superior">Integer superior</a></h1>
<h2 id="description-26"><a class="header" href="#description-26">Description</a></h2>
<p>Compare JSON key value to the value passed in parameter and returns true if superior.</p>
<h2 id="parameters-21"><a class="header" href="#parameters-21">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>key</strong></td><td>JSON key where value is located, separate nested dictionary with <strong>/</strong></td><td>str</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>value</strong></td><td>Value to which compare the JSON value</td><td>int</td><td>N/A (Mandatory)</td></tr>
</tbody></table>
</div><footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/conditions/integer_superior.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="list-bool-equal"><a class="header" href="#list-bool-equal">List bool equal</a></h1>
<h2 id="description-27"><a class="header" href="#description-27">Description</a></h2>
<p>Compare JSON key value to the value passed in parameter and returns true if equal.</p>
<h2 id="parameters-22"><a class="header" href="#parameters-22">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>key</strong></td><td>JSON key where value is located, separate nested dictionary with <strong>/</strong></td><td>str</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>value</strong></td><td>Value to which compare the JSON value</td><td>bool</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>order_matters</strong></td><td>If true, will compare taking account of the order</td><td>bool</td><td>true</td></tr>
</tbody></table>
</div><footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/conditions/list_bool_equal.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="list-double-equal"><a class="header" href="#list-double-equal">List double equal</a></h1>
<h2 id="description-28"><a class="header" href="#description-28">Description</a></h2>
<p>Compare JSON key value to the value passed in parameter and returns true if equal.</p>
<h2 id="parameters-23"><a class="header" href="#parameters-23">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>key</strong></td><td>JSON key where value is located, separate nested dictionary with <strong>/</strong></td><td>str</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>value</strong></td><td>Value to which compare the JSON value</td><td>list[float]</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>order_matters</strong></td><td>If true, will compare taking account of the order</td><td>bool</td><td>true</td></tr>
</tbody></table>
</div><footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/conditions/list_double_equal.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="list-integer-equal"><a class="header" href="#list-integer-equal">List integer equal</a></h1>
<h2 id="description-29"><a class="header" href="#description-29">Description</a></h2>
<p>Compare JSON key value to the value passed in parameter and returns true if equal.</p>
<h2 id="parameters-24"><a class="header" href="#parameters-24">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>key</strong></td><td>JSON key where value is located, separate nested dictionary with <strong>/</strong></td><td>str</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>value</strong></td><td>Value to which compare the JSON value</td><td>list[int]</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>order_matters</strong></td><td>If true, will compare taking account of the order</td><td>bool</td><td>true</td></tr>
</tbody></table>
</div><footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/conditions/list_integer_equal.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="list-string-equal"><a class="header" href="#list-string-equal">List string equal</a></h1>
<h2 id="description-30"><a class="header" href="#description-30">Description</a></h2>
<p>Compare JSON key value to the value passed in parameter and returns true if equal.</p>
<h2 id="parameters-25"><a class="header" href="#parameters-25">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>key</strong></td><td>JSON key where value is located, separate nested dictionary with <strong>/</strong></td><td>str</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>value</strong></td><td>Value to which compare the JSON value</td><td>bool</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>order_matters</strong></td><td>If true, will compare taking account of the order</td><td>bool</td><td>true</td></tr>
</tbody></table>
</div><footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/conditions/list_string_equal.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="moving"><a class="header" href="#moving">Moving</a></h1>
<h2 id="description-31"><a class="header" href="#description-31">Description</a></h2>
<p>Use a <a href="https://www.wikiwand.com/en/Hysteresis">hysteresis</a> on robot position to know whether the robot is moving.</p>
<h2 id="parameters-26"><a class="header" href="#parameters-26">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>odom_topic</strong></td><td>Topic from where odom is used to know if the robot is moving</td><td>str</td><td>&quot;/odom&quot;</td></tr>
<tr><td><strong>speed_threshold</strong></td><td>Speed threshold used in the hysteresis</td><td>float</td><td>0.2</td></tr>
<tr><td><strong>count_limit</strong></td><td>Counter to know if the robot is moving</td><td>int</td><td>8</td></tr>
<tr><td><strong>count_hysteresis</strong></td><td>Hysteresis counter</td><td>int</td><td>5</td></tr>
</tbody></table>
</div><footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/conditions/moving.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="same-as-previous"><a class="header" href="#same-as-previous">Same as previous</a></h1>
<h2 id="description-32"><a class="header" href="#description-32">Description</a></h2>
<p>Compare JSON key value to the value passed in parameter and returns true if match.</p>
<h2 id="parameters-27"><a class="header" href="#parameters-27">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>keys</strong></td><td>JSON keys where values are located, separate nested dictionary with <strong>/</strong></td><td>list[str]</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>exclude</strong></td><td>JSON keys to exclude in comparison</td><td>list[str]</td><td>N/A (Mandatory)</td></tr>
</tbody></table>
</div><footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/conditions/same_as_previous.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="string-match"><a class="header" href="#string-match">String match</a></h1>
<h2 id="description-33"><a class="header" href="#description-33">Description</a></h2>
<p>Compare JSON key value to the value passed in parameter and returns true if match.</p>
<h2 id="parameters-28"><a class="header" href="#parameters-28">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>key</strong></td><td>JSON key where value is located, separate nested dictionary with <strong>/</strong></td><td>str</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>regex</strong></td><td>Regex to which compare the JSON value to</td><td>str</td><td>N/A (Mandatory)</td></tr>
</tbody></table>
</div><footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/conditions/string_match.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="data-validation"><a class="header" href="#data-validation">Data validation</a></h1>
<h2 id="model"><a class="header" href="#model">Model</a></h2>
<p>Each measurement cam validate its data with a model.</p>
<p>We use use <a href="https://github.com/pboettch/json-schema-validator">JSON schema validator for JSON for Modern C++</a>.</p>
<p>Schemas follow the JSON 7 model:</p>
<pre><code class="language-json">{
    &quot;$schema&quot;: &quot;http://json-schema.org/draft-07/schema#&quot;,
    &quot;title&quot;: &quot;Uptime&quot;,
    &quot;description&quot;: &quot;Time the system has been up&quot;,
    &quot;properties&quot;: {
        &quot;time&quot;: {
            &quot;description&quot;: &quot;Time the system has been up&quot;,
            &quot;type&quot;: &quot;integer&quot;,
            &quot;minimum&quot;: 0
        }
    },
    &quot;type&quot;: &quot;object&quot;
}
</code></pre>
<p>It is possible to enforce the validation. By default, it is disabled since some fields can be filtered out, and some are added dynamically (e.g remote paths).</p>
<p>Currently it is not possible to select another schema but it is planned to be able to pass a custom path later on.</p>
<h2 id="failed-validation-callback"><a class="header" href="#failed-validation-callback">Failed validation callback</a></h2>
<p>You might want to trigger some actions when a validation fails, e.g send the data to another database to later on debug it.</p>
<p>In this case, you will need to write your own plugin (inherit from an existing one or start from scratch) and define the <code>onFailedValidation</code> function in the class.</p>
<p>This case is covered by the <a href="dc/./demos/custom_stdout.html">custom plugin demo</a></p>
<h2 id="use-a-different-schema"><a class="header" href="#use-a-different-schema">Use a different Schema</a></h2>
<p>For each plugin, a default path is provided but this can be changed by passing the <code>json_schema_path</code> parameter in the measurement plugin parameter to the absolute path of your schema.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/data_validation.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="groups"><a class="header" href="#groups">Groups</a></h1>
<h2 id="description-34"><a class="header" href="#description-34">Description</a></h2>
<p>Each measurement is part of a group. This allows measurements to be grouped together later on. For example, having the measurements cpu and position belonging to the same group, data will be published together on <code>/dc/group/my_group</code></p>
<pre><code class="language-json">{
    &quot;cpu&quot;: ...,
    &quot;position&quot;: ...,
}
</code></pre>
<p>Currently, this node is written in python. The main reason for it is that we don't know how to allocate and pass different amount of variables to the TimeSynchronizer. In python it is quite simple, but not so in C++.</p>
<h2 id="node-parameters-1"><a class="header" href="#node-parameters-1">Node parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td>groups</td><td>Groups to enable</td><td>list[str]</td><td>N/A</td></tr>
</tbody></table>
</div>
<h2 id="group-parameters"><a class="header" href="#group-parameters">Group parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td>inputs</td><td>Name of the input topics to group</td><td>list[str]</td><td>N/A</td></tr>
<tr><td>output</td><td>Output topic to send the data to</td><td>str</td><td>&quot;/dc/group/{group}&quot;</td></tr>
<tr><td>sync_delay</td><td>Delay to wait during all subscriber data need to reach before being published again</td><td>float</td><td>5.0</td></tr>
<tr><td>group_key</td><td>Dictionary key under which data is grouped</td><td>str</td><td>{group_name}</td></tr>
<tr><td>exclude_keys</td><td>List of keys to exclude from the published data. Data depth is separated by a dot</td><td>list[str]</td><td>N/A</td></tr>
<tr><td>tags</td><td>Destination names, used to know where data will be forwarded to</td><td>list[str]</td><td>N/A</td></tr>
<tr><td>nested_data</td><td>Whether measurements are nested dictionaries or flat</td><td>bool</td><td>false</td></tr>
<tr><td>include_group_name</td><td>Include group name in the JSON as key=&quot;name&quot; and value=&lt;group_key&gt;</td><td>bool</td><td>true</td></tr>
</tbody></table>
</div>
<h2 id="example"><a class="header" href="#example">Example</a></h2>
<pre><code class="language-yaml">group_server:
  ros__parameters:
    groups: [&quot;map&quot;, &quot;memory_uptime&quot;]
    memory_cpu:
      inputs: [&quot;/dc/measurement/memory&quot;, &quot;/dc/measurement/cpu&quot;]
      output: &quot;/dc/group/memory_cpu&quot;
      sync_delay: 5.0
      group_key: &quot;memory_cpu&quot;
      tags: [&quot;flb_pgsql&quot;]
    memory_uptime:
      inputs: [&quot;/dc/measurement/memory&quot;, &quot;/dc/measurement/uptime&quot;]
      output: &quot;/dc/group/memory_uptime&quot;
      sync_delay: 5.0
      group_key: &quot;memory_uptime&quot;
      tags: [&quot;flb_stdout&quot;]
    cameras:
      inputs: [&quot;/dc/measurement/camera&quot;]
      output: &quot;/dc/group/cameras&quot;
      sync_delay: 5.0
      group_key: &quot;cameras&quot;
      tags: [&quot;flb_minio&quot;, &quot;flb_stdout&quot;]
    map:
      inputs: [&quot;/dc/measurement/map&quot;]
      output: &quot;/dc/group/map&quot;
      sync_delay: 5.0
      group_key: &quot;map&quot;
      tags: [&quot;flb_minio&quot;, &quot;flb_stdout&quot;]
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/groups.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="overview-1"><a class="header" href="#overview-1">Overview</a></h1>
<h2 id="description-35"><a class="header" href="#description-35">Description</a></h2>
<p>A destination is where the data will be sent: AWS S3, stdout, AWS Kinesis. It has the possibility to use <a href="https://docs.fluentbit.io/manual/pipeline/outputs">outputs from fluentbit</a>.</p>
<p>The destination node is similar to the measurement one. It:</p>
<ul>
<li>Either subscribes to data in the main node and data is forwarded with ros based destination plugins</li>
<li>Either subscribes to data from the ros2 fluent bit plugin.</li>
</ul>
<p>The fluent bit plugin is the preferred one since when using it, we get all the benefits from fluent bit (especially data integrity). The ros2 fluent bit plugin uses rclc and is at the moment a fork of fluent bit. It could also be rewritten as a fluent bit plugin based on the GO interface, but pros and cons to move to it are not clear yet.</p>
<h2 id="node-parameters-2"><a class="header" href="#node-parameters-2">Node parameters</a></h2>
<p>Destinations parameters are loaded dynamically. Here are the static ones:</p>
<div class="table-wrapper"><table><thead><tr><th>Parameter name</th><th>Description</th><th>Type(s)</th><th>Default</th></tr></thead><tbody>
<tr><td><a href="https://docs.fluentbit.io/manual/v/1.3/service">flb.flush</a></td><td>Interval to flush output (seconds)</td><td>str</td><td>&quot;1&quot;</td></tr>
<tr><td><a href="https://docs.fluentbit.io/manual/v/1.3/service">flb.grace</a></td><td>Wait time (seconds) on exit</td><td>str</td><td>&quot;1&quot;</td></tr>
<tr><td><a href="https://docs.fluentbit.io/manual/v/1.3/service">flb.log_level</a></td><td>Diagnostic level (error/warning/info/debug/trace)</td><td>str</td><td>&quot;info&quot;</td></tr>
<tr><td><a href="https://docs.fluentbit.io/manual/administration/buffering-and-storage">flb.storage_path</a></td><td>Set an optional location in the file system to store streams and chunks of data. If this parameter is not set, Input plugins can only use in-memory buffering.</td><td>str</td><td>&quot;/var/log/flb-storage/&quot;</td></tr>
<tr><td><a href="https://docs.fluentbit.io/manual/administration/buffering-and-storage">flb.storage_sync</a></td><td>Configure the synchronization mode used to store the data into the file system. It can take the values normal or full.</td><td>str</td><td>&quot;normal&quot;</td></tr>
<tr><td><a href="https://docs.fluentbit.io/manual/administration/buffering-and-storage">flb.storage_checksum</a></td><td>Enable the data integrity check when writing and reading data from the filesystem. The storage layer uses the CRC32 algorithm.</td><td>str</td><td>&quot;off&quot;</td></tr>
<tr><td><a href="https://docs.fluentbit.io/manual/administration/buffering-and-storage">flb.storage_backlog_mem_limit</a></td><td>If storage.path is set, Fluent Bit will look for data chunks that were not delivered and are still in the storage layer, these are called backlog data. This option configure a hint of maximum value of memory to use when processing these records.</td><td>str</td><td>&quot;5M&quot;</td></tr>
<tr><td><a href="https://docs.fluentbit.io/manual/administration/scheduling-and-retries">flb.scheduler_cap</a></td><td>Set a maximum retry time in seconds. The property is supported from v1.8.7.</td><td>str</td><td>&quot;2000&quot;</td></tr>
<tr><td><a href="https://docs.fluentbit.io/manual/administration/scheduling-and-retries">flb.scheduler_base</a></td><td>Set a base of exponential backoff. The property is supported from v1.8.7.</td><td>str</td><td>&quot;5&quot;</td></tr>
<tr><td><a href="https://docs.fluentbit.io/manual/administration/buffering-and-storage">flb.http_server</a></td><td>If true enable statistics HTTP server</td><td>bool</td><td>false</td></tr>
<tr><td><a href="https://docs.fluentbit.io/manual/administration/buffering-and-storage#input-section-configuration">flb.in_storage_type</a></td><td>Specifies the buffering mechanism to use. It can be memory or filesystem.</td><td>str</td><td>&quot;filesystem&quot;</td></tr>
<tr><td><a href="https://docs.fluentbit.io/manual/administration/buffering-and-storage#input-section-configuration">flb.in_storage_pause_on_chunks_overlimit</a></td><td>Specifies if file storage is to be paused when reaching the chunk limit.</td><td>str</td><td>&quot;off&quot;</td></tr>
</tbody></table>
</div>
<h2 id="plugin-parameters-1"><a class="header" href="#plugin-parameters-1">Plugin parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter name</th><th>Description</th><th>Type(s)</th><th>Default</th></tr></thead><tbody>
<tr><td>plugin</td><td>Plugin to load</td><td>list[str]</td><td>N/A</td></tr>
<tr><td>inputs</td><td>Topics to which to listen to get the data</td><td>list[str]</td><td>N/A</td></tr>
<tr><td>debug</td><td>Enable debug print</td><td>bool</td><td>false</td></tr>
<tr><td>time_format</td><td>Format the data will be printed</td><td>str(&quot;double&quot;, &quot;iso8601&quot;)</td><td>&quot;double&quot;</td></tr>
<tr><td>time_key</td><td>Dictionary key from which date will be taken from</td><td>str</td><td>&quot;date&quot;</td></tr>
</tbody></table>
</div>
<h2 id="available-plugins-2"><a class="header" href="#available-plugins-2">Available plugins:</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Description</th><th>Source</th></tr></thead><tbody>
<tr><td><a href="dc/./destinations/flb_file.html">flb_file</a></td><td>Write the data received through the input plugin to file.</td><td><a href="https://docs.fluentbit.io/manual/pipeline/outputs/file">Fluent Bit File</a></td></tr>
<tr><td><a href="dc/./destinations/flb_files_metrics.html">flb_files_metrics</a></td><td>Ingest your records into the <a href="https://aws.amazon.com/kinesis/data-streams/">AWS Kinesis</a> service</td><td>This project, in fluent_bit_plugins</td></tr>
<tr><td><a href="dc/./destinations/flb_http.html">flb_http</a></td><td>JSON to http request via Fluent Bit</td><td><a href="https://docs.fluentbit.io/manual/pipeline/outputs/http">Fluent Bit HTTP</a></td></tr>
<tr><td><a href="dc/./destinations/flb_kinesis_data_streams.html">flb_kinesis_streams</a></td><td>JSON to AWS Kinesis Streams via Fluent Bit</td><td><a href="https://docs.fluentbit.io/manual/pipeline/outputs/kinesis">Amazon Kinesis Data Streams</a></td></tr>
<tr><td><a href="dc/./destinations/flb_minio.html">flb_minio</a></td><td>JSON to Minio via Fluent Bit</td><td>This project, in fluent_bit_plugins package</td></tr>
<tr><td><a href="dc/./destinations/flb_pgsql.html">flb_pgsql</a></td><td>JSON to PostgreSQL via Fluent Bit</td><td><a href="https://docs.fluentbit.io/manual/pipeline/outputs/postgresql">Fluent Bit PostgreSQL</a></td></tr>
<tr><td><a href="dc/./destinations/flb_stdout.html">flb_stdout</a></td><td>JSON to STDOUT via Fluent Bit</td><td><a href="https://docs.fluentbit.io/manual/pipeline/outputs/standard-output">Fluent Bit Stdout</a></td></tr>
<tr><td><a href="dc/./destinations/flb_s3.html">flb_s3</a></td><td>JSON to AWS S3 via Fluent Bit</td><td><a href="https://docs.fluentbit.io/manual/pipeline/outputs/s3">Fluent Bit S3</a></td></tr>
<tr><td><a href="dc/./destinations/flb_tcp.html">flb_tcp</a></td><td>JSON to TCP via Fluent Bit</td><td><a href="https://docs.fluentbit.io/manual/pipeline/outputs/tcp-and-tls">Fluent Bit TCP &amp; TLS</a></td></tr>
<tr><td><a href="dc/./destinations/rcl.html">rcl</a></td><td>JSON to RCL</td><td><a href="https://docs.ros.org/en/rolling/Tutorials/Demos/Logging-and-logger-configuration.html">ROS 2 logging</a></td></tr>
</tbody></table>
</div>
<h2 id="example-configuration"><a class="header" href="#example-configuration">Example configuration</a></h2>
<pre><code class="language-yaml">destination_server:
  ros__parameters:
    flb:
      flush: &quot;1&quot;
      flb_grace: &quot;1&quot;
      log_level: &quot;info&quot;
      storage_path: &quot;/var/log/flb-storage/&quot;
      storage_sync: &quot;full&quot;
      storage_checksum: &quot;off&quot;
      storage_backlog_mem_limit: &quot;1M&quot;
      scheduler_cap: &quot;2000&quot;
      scheduler_base: &quot;5&quot;
      metrics: true
      in_storage_type: &quot;filesystem&quot;
      in_storage_pause_on_chunks_overlimit: &quot;off&quot;
    destination_plugins: [&quot;flb_stdout&quot;]
    flb_minio:
      plugin: &quot;dc_destinations/FlbMinIO&quot;
      inputs: [&quot;/dc/group/map&quot;]
      plugin_path: &quot;/root/ws/src/ros2_data_collection/dc_destinations/flb_plugins/lib/out_minio.so&quot;
      endpoint: 127.0.0.1:9000
      access_key_id: HgJdDWeDQBiBWCwm
      secret_access_key: plCMROO2VMZIKiqEwDd80dLJUCRvJ9iu
      use_ssl: false
      bucket: &quot;mybucket&quot;
      src_fields: [&quot;camera.local_img_paths.raw&quot;,&quot;camera.local_img_paths.rotated&quot;, &quot;map.local_map_paths.yaml&quot;, &quot;map.local_map_paths.pgm&quot;]
      upload_fields: [&quot;camera.minio_img_paths.raw&quot;,&quot;camera.minio_img_paths.rotated&quot;, &quot;map.minio_map_paths.yaml&quot;, &quot;map.minio_map_paths.pgm&quot;]
    flb_pgsql:
      plugin: &quot;dc_destinations/FlbPgSQL&quot;
      inputs: [&quot;/dc/group/memory_uptime&quot;]
      host: &quot;127.0.0.1&quot;
      port: &quot;5432&quot;
      user: fluentbit
      password: password
      database: &quot;fluentbit&quot;
      table: &quot;dc&quot;
      timestamp_key: &quot;date&quot;
      async: false
      time_format: &quot;double&quot;
      time_key: &quot;date&quot;
    rcl:
      plugin: &quot;dc_destinations/Rcl&quot;
      inputs: [&quot;/dc/group/memory_uptime&quot;]
    flb_stdout:
      plugin: &quot;dc_destinations/FlbStdout&quot;
      inputs: [&quot;/dc/group/cameras&quot;]
      inputs: [&quot;/dc/group/cameras&quot;]
      time_format: &quot;iso8601&quot;
      time_key: &quot;date&quot;
    flb_http:
      plugin: &quot;dc_destinations/FlbHTTP&quot;
      inputs: [&quot;/dc/group/memory_uptime&quot;]
      debug: true
    flb_file:
      plugin: &quot;dc_destinations/FlbFile&quot;
      inputs: [&quot;/dc/group/memory_uptime&quot;]
      path: &quot;$HOME/data&quot;
      file: uptime
      debug: false
      throttle:
        enable: false
        rate: &quot;1&quot;
        window: &quot;5&quot;
        interval: &quot;10s&quot;
        print_status: true
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/destinations.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="aws-kinesis-data-streams---fluent-bit"><a class="header" href="#aws-kinesis-data-streams---fluent-bit">AWS Kinesis Data Streams - Fluent Bit</a></h1>
<h2 id="description-36"><a class="header" href="#description-36">Description</a></h2>
<p>The Amazon Kinesis Data Streams output plugin allows to ingest your records into the <a href="https://aws.amazon.com/kinesis/data-streams/">Kinesis</a> service. See <a href="https://docs.fluentbit.io/manual/pipeline/outputs/kinesis">fluent bit page</a> for more information.</p>
<h2 id="parameters-29"><a class="header" href="#parameters-29">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>region</strong></td><td>The AWS region.</td><td>str</td><td>N/A</td></tr>
<tr><td><strong>stream</strong></td><td>The name of the Kinesis Streams Delivery stream that you want log records sent to.</td><td>str</td><td>N/A</td></tr>
<tr><td><strong>role_arn</strong></td><td>ARN of an IAM role to assume (for cross account access).</td><td>str</td><td>N/A</td></tr>
<tr><td><strong>time_key</strong></td><td>Add the timestamp to the record under this key. By default the timestamp from Fluent Bit will not be added to records sent to Kinesis.</td><td>str</td><td>N/A</td></tr>
<tr><td><strong>time_key_format</strong></td><td>strftime compliant format string for the timestamp; for example, the default is '%Y-%m-%dT%H:%M:%S'. Supports millisecond precision with '%3N' and supports nanosecond precision with '%9N' and '%L'; for example, adding '%3N' to support millisecond '%Y-%m-%dT%H:%M:%S.%3N'. This option is used with time_key.</td><td>str</td><td>&quot;%Y-%m-%dT%H:%M:%S&quot;</td></tr>
<tr><td><strong>log_key</strong></td><td>By default, the whole log record will be sent to Kinesis. If you specify a key name with this option, then only the value of that key will be sent to Kinesis. For example, if you are using the Fluentd Docker log driver, you can specify log_key log and only the log message will be sent to Kinesis.</td><td>str</td><td>N/A</td></tr>
<tr><td><strong>endpoint</strong></td><td>Specify a custom endpoint for the Kinesis API.</td><td>str</td><td>N/A</td></tr>
<tr><td><strong>auto_retry_requests</strong></td><td>Immediately retry failed requests to AWS services once. This option does not affect the normal Fluent Bit retry mechanism with backoff. Instead, it enables an immediate retry with no delay for networking errors, which may help improve throughput when there are transient/random networking issues. This option defaults to true.</td><td>bool</td><td>true</td></tr>
</tbody></table>
</div>
<h2 id="node-configuration"><a class="header" href="#node-configuration">Node configuration</a></h2>
<pre><code class="language-yaml">...
flb_kinesis_streams:
  plugin: &quot;dc_destinations/FlbKinesisStreams&quot;
  inputs: [&quot;/dc/measurement/data&quot;]
  region: &quot;us-east-1&quot;
  stream: my_stream
  time_key: &quot;date&quot;
  time_key_format: &quot;%Y-%m-%dT%H:%M:%S&quot;
...
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/destinations/flb_kinesis_data_streams.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="aws-s3---fluent-bit"><a class="header" href="#aws-s3---fluent-bit">AWS S3 - Fluent Bit</a></h1>
<h2 id="description-37"><a class="header" href="#description-37">Description</a></h2>
<p>The Amazon S3 output plugin allows to ingest your records into the <a href="https://aws.amazon.com/s3/">S3</a> service. See <a href="https://docs.fluentbit.io/manual/pipeline/outputs/s3">fluent bit page</a> for more information.</p>
<h2 id="parameters-30"><a class="header" href="#parameters-30">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>region</strong></td><td>The AWS region of your S3 bucket.</td><td>str</td><td>&quot;us-east-1&quot;</td></tr>
<tr><td><strong>bucket</strong></td><td>S3 Bucket name.</td><td>str</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>json_date_key</strong></td><td>Specify the name of the time key in the output record. To disable the time key just set the value to false.</td><td>str</td><td>&quot;date&quot;</td></tr>
<tr><td><strong>json_date_format</strong></td><td>Specify the format of the date. Supported formats are double, epoch, iso8601 (eg: 2018-05-30T09:39:52.000681Z) and java_sql_timestamp (eg: 2018-05-30 09:39:52.000681).</td><td>str</td><td>&quot;iso8601&quot;</td></tr>
<tr><td><strong>total_file_size</strong></td><td>Specifies the size of files in S3. Maximum size is 50G, minimim is 1M.</td><td>str</td><td>&quot;100M&quot;</td></tr>
<tr><td><strong>upload_chunk_size</strong></td><td>The size of each 'part' for multipart uploads. Max: 50M.</td><td>str</td><td>&quot;50M&quot;</td></tr>
<tr><td><strong>upload_timeout</strong></td><td>Whenever this amount of time has elapsed, Fluent Bit will complete an upload and create a new file in S3. For example, set this value to 60m and you will get a new file every hour.</td><td>str</td><td>&quot;10m&quot;</td></tr>
<tr><td><strong>store_dir</strong></td><td>Directory to locally buffer data before sending. When multipart uploads are used, data will only be buffered until the upload_chunk_size is reached. S3 will also store metadata about in progress multipart uploads in this directory; this allows pending uploads to be completed even if Fluent Bit stops and restarts. It will also store the current $INDEX value if enabled in the S3 key format so that the $INDEX can keep incrementing from its previous value after Fluent Bit restarts.</td><td>str</td><td>&quot;/tmp/fluent-bit/s3&quot;</td></tr>
<tr><td><strong>store_dir_limit_size</strong></td><td>The size of the limitation for disk usage in S3. Limit the amount of s3 buffers in the store_dir to limit disk usage. Note: Use store_dir_limit_size instead of storage.total_limit_size which can be used to other plugins, because S3 has its own buffering system.</td><td>int</td><td>0</td></tr>
<tr><td><strong>s3_key_format</strong></td><td>Format string for keys in S3. This option supports a UUID, strftime time formatters, a syntax for selecting parts of the Fluent log tag using a syntax inspired by the rewrite_tag filter. Add $UUID in the format string to insert a random string. Add $INDEX in the format string to insert an integer that increments each upload. The $INDEX value will be saved in the store_dir so that if Fluent Bit restarts the value will keep incrementing from the previous run. Add $TAG in the format string to insert the full log tag; add $TAG[0] to insert the first part of the tag in the s3 key. The tag is split into “parts” using the characters specified with the s3_key_format_tag_delimiters option. Add extension directly after the last piece of the format string to insert a key suffix. If you want to specify a key suffix and you are in use_put_object mode, you must specify $UUID as well. More explanations can be found in the S3 Key Format explainer section further down in this document. See the in depth examples and tutorial in the documentation. Time in s3_key is the timestamp of the first record in the S3 file.</td><td>str</td><td>&quot;/fluent-bit-logs/$TAG/%Y/%m/%d/%H/%M/%S&quot;</td></tr>
<tr><td><strong>static_file_path</strong></td><td>Disables behavior where UUID string is automatically appended to end of S3 key name when $UUID is not provided in s3_key_format. $UUID, time formatters, $TAG, and other dynamic key formatters all work as expected while this feature is set to true.</td><td>bool</td><td>false</td></tr>
<tr><td><strong>s3_key_format_tag_delimiters</strong></td><td>A series of characters which will be used to split the tag into 'parts' for use with the s3_key_format option. See the in depth examples and tutorial in the documentation.</td><td>str</td><td>N/A</td></tr>
<tr><td><strong>use_put_object</strong></td><td>Use the S3 PutObject API, instead of the multipart upload API. When this option is on, key extension is only available when $UUID is specified in s3_key_format. If $UUID is not included, a random string will be appended at the end of the format string and the key extension cannot be customized in this case.</td><td>bool</td><td>false</td></tr>
<tr><td><strong>role_arn</strong></td><td>ARN of an IAM role to assume (ex. for cross account access).</td><td>str</td><td>N/A</td></tr>
<tr><td><strong>endpoint</strong></td><td>Custom endpoint for the S3 API. An endpoint can contain scheme and port.</td><td>str</td><td>N/A</td></tr>
<tr><td><strong>sts_endpoint</strong></td><td>Custom endpoint for the STS API.</td><td>str</td><td>N/A</td></tr>
<tr><td><strong>canned_acl</strong></td><td><a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html#canned-acl">Predefined Canned ACL</a> policy.</td><td>str</td><td>N/A</td></tr>
<tr><td><strong>compression</strong></td><td>Compression type for S3 objects. 'gzip' is currently the only supported value by default. If Apache Arrow support was enabled at compile time, you can also use 'arrow'. For gzip compression, the Content-Encoding HTTP Header will be set to 'gzip'. Gzip compression can be enabled when use_put_object is 'on' or 'off' (PutObject and Multipart). Arrow compression can only be enabled with use_put_object On.</td><td>str</td><td>N/A</td></tr>
<tr><td><strong>content_type</strong></td><td>A standard MIME type for the S3 object; this will be set as the Content-Type HTTP header.</td><td>str</td><td>N/A</td></tr>
<tr><td><strong>send_content_md5</strong></td><td>Send the Content-MD5 header with PutObject and UploadPart requests, as is required when Object Lock is enabled.</td><td>bool</td><td>false</td></tr>
<tr><td><strong>auto_retry_requests</strong></td><td>Immediately retry failed requests to AWS services once. This option does not affect the normal Fluent Bit retry mechanism with backoff. Instead, it enables an immediate retry with no delay for networking errors, which may help improve throughput when there are transient/random networking issues.</td><td>bool</td><td>true</td></tr>
<tr><td><strong>log_key</strong></td><td>By default, the whole log record will be sent to S3. If you specify a key name with this option, then only the value of that key will be sent to S3. For example, if you are using Docker, you can specify log_key log and only the log message will be sent to S3.</td><td>str</td><td>N/A</td></tr>
<tr><td><strong>preserve_data_ordering</strong></td><td>Normally, when an upload request fails, there is a high chance for the last received chunk to be swapped with a later chunk, resulting in data shuffling. This feature prevents this shuffling by using a queue logic for uploads.</td><td>bool</td><td>true</td></tr>
<tr><td><strong>storage_class</strong></td><td>Specify the <a href="https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutObject.html#AmazonS3-PutObject-request-header-StorageClass">storage class</a> for S3 objects. If this option is not specified, objects will be stored with the default 'STANDARD' storage class.</td><td>str</td><td>N/A</td></tr>
<tr><td><strong>retry_limit</strong></td><td>Integer value to set the maximum number of retries allowed. For previous version, the number of retries is 5 and is not configurable.</td><td>int</td><td>1</td></tr>
<tr><td><strong>external_id</strong></td><td>Specify an external ID for the STS API, can be used with the role_arn parameter if your role requires an external ID.</td><td>str</td><td>N/A</td></tr>
</tbody></table>
</div>
<h2 id="node-configuration-1"><a class="header" href="#node-configuration-1">Node configuration</a></h2>
<pre><code class="language-yaml">...
flb_s3:
  plugin: &quot;dc_destinations/FlbS3&quot;
  inputs: [&quot;/dc/group/data&quot;]
  bucket: my-bucket
  region: us-west-2
  total_file_size: &quot;50M&quot;
  use_put_object: false
  compression: &quot;gzip&quot;
  s3_key_format: &quot;/$TAG/%Y/%m/%d/%H_%M_%S.gz&quot;
...
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/destinations/flb_s3.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="file---fluent-bit"><a class="header" href="#file---fluent-bit">File - Fluent Bit</a></h1>
<h2 id="description-38"><a class="header" href="#description-38">Description</a></h2>
<p>The file output plugin allows to write the data received through the input plugin to file. See <a href="https://docs.fluentbit.io/manual/pipeline/outputs/file">fluent bit page</a> for more information.</p>
<h2 id="parameters-31"><a class="header" href="#parameters-31">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>file</strong></td><td>Set file name to store the records. If not set, the file name will be the tag associated with the records.</td><td>str</td><td>N/A (Optional)</td></tr>
<tr><td><strong>format</strong></td><td>The format of the file content. See also <a href="https://docs.fluentbit.io/manual/pipeline/outputs/file#format">Format</a> section.</td><td>str(out_file,plain,csv,ltsv)</td><td>&quot;out_file&quot;</td></tr>
<tr><td><strong>mkdir</strong></td><td>Recursively create output directory if it does not exist. Permissions set to 0755.</td><td>bool</td><td>true</td></tr>
<tr><td><strong>path</strong></td><td>Directory path to store files. If not set, Fluent Bit will write the files on it's own positioned directory.</td><td>str</td><td>&quot;$HOME/data/&quot;</td></tr>
<tr><td><strong>delimiter</strong></td><td>The character to separate each data. Default to ',' if format=csv, '\t'(TAB) if format=ltsv, '' else.</td><td>str</td><td>'' or ',' or '\t'</td></tr>
<tr><td><strong>label_delimiter</strong></td><td>The character to separate label and the value. Default: ':'. Used for ltsv.</td><td>str</td><td>'.'</td></tr>
</tbody></table>
</div>
<h2 id="node-configuration-2"><a class="header" href="#node-configuration-2">Node configuration</a></h2>
<pre><code class="language-yaml">...
flb_file:
  plugin: &quot;dc_destinations/FlbFile&quot;
  inputs: [&quot;/dc/group/cameras&quot;]
  file: &quot;data&quot;
  format: &quot;out_file&quot;
  mkdir: true
  path: &quot;$HOME/data/&quot;
...
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/destinations/flb_file.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="files-metrics---fluent-bit"><a class="header" href="#files-metrics---fluent-bit">Files metrics - Fluent Bit</a></h1>
<h2 id="description-39"><a class="header" href="#description-39">Description</a></h2>
<p>Tracks files (yaml files, jpg pictures etc.) sent to their destinations (s3, minio etc.). We can then delete files locally when they have been sent to all their storage destinations.</p>
<p>It loads a Fluent Bit plugin we wrote ourselves to do this task, located in the fluent_bit_plugins package.</p>
<p>It creates a table on the database (currently PostgreSQL only) to store each file status.</p>
<pre class="mermaid">erDiagram
    files_metrics {
        integer id
        timestamp timestamp
        text robot_name
        text robot_id
        text group_name
        double duration
        text local_path
        text remote_path
        bool uploaded
        bool on_filesystem
        bool deleted
        bool ignored
        text storage_type
        text content_type
        integer size
        timestamp created_at
        timestamp updated_at
    }
</pre>
<h2 id="parameters-32"><a class="header" href="#parameters-32">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>db_type</strong></td><td>Database used.</td><td>str</td><td>&quot;pgsql&quot;</td></tr>
<tr><td><strong>file_storage</strong></td><td>Where data will be stored.</td><td>list[str](s3, minio)</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>delete_when_sent</strong></td><td>Delete file when sent.</td><td>bool</td><td>true</td></tr>
<tr><td><strong>minio.access_key_id</strong></td><td>Minio Access key ID.</td><td>str</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>minio.bucket</strong></td><td>Minio bucket name.</td><td>str</td><td>&quot;dc_bucket&quot;</td></tr>
<tr><td><strong>minio.endpoint</strong></td><td>Minio endpoint.</td><td>str</td><td>&quot;127.0.0.1:9000&quot;</td></tr>
<tr><td><strong>minio.secret_access_key</strong></td><td>Minio Secret access key.</td><td>str</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>minio.src_fields</strong></td><td>JSON fields containing local paths for Minio.</td><td>str</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>minio.upload_fields</strong></td><td>JSON fields containing remote paths for Minio.</td><td>str</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>minio.use_ssl</strong></td><td>Use SSL for Minio.</td><td>bool</td><td>true</td></tr>
<tr><td><strong>pgsql.database</strong></td><td>Database name to connect to.</td><td>str</td><td>&lt;system_username&gt;</td></tr>
<tr><td><strong>pgsql.host</strong></td><td>Hostname/IP address of the PostgreSQL instance.</td><td>str</td><td>&quot;127.0.0.1&quot;</td></tr>
<tr><td><strong>pgsql.password</strong></td><td>Password of PostgreSQL username.</td><td>str</td><td>&quot;&quot;</td></tr>
<tr><td><strong>pgsql.port</strong></td><td>PostgreSQL port.</td><td>str</td><td>&quot;5432&quot;</td></tr>
<tr><td><strong>pgsql.ssl</strong></td><td>Use ssl for PostgreSQL connection.</td><td>bool</td><td>true</td></tr>
<tr><td><strong>pgsql.table</strong></td><td>Table name where to store data.</td><td>str</td><td>&quot;pg_table&quot;</td></tr>
<tr><td><strong>pgsql.user</strong></td><td>PostgreSQL username.</td><td>str</td><td>&lt;system_username&gt;</td></tr>
<tr><td><strong>plugin_path</strong></td><td>Shared library of the plugin.</td><td>str</td><td>&lt;install_path&gt;/lib/out_files_metrics.so</td></tr>
<tr><td><strong>s3.access_key_id</strong></td><td>S3 Access key ID.</td><td>str</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>s3.bucket</strong></td><td>S3 bucket name.</td><td>str</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>s3.endpoint</strong></td><td>S3 endpoint.</td><td>str</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>s3.secret_access_key</strong></td><td>S3 Secret access key.</td><td>str</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>s3.src_fields</strong></td><td>JSON fields containing local paths for s3.</td><td>str</td><td>N/A (Mandatory)</td></tr>
<tr><td><strong>s3.upload_fields</strong></td><td>JSON fields containing remote paths for S3.</td><td>str</td><td>N/A (Mandatory)</td></tr>
</tbody></table>
</div>
<h2 id="example-1"><a class="header" href="#example-1">Example</a></h2>
<pre><code class="language-yaml">flb_files_metrics:
    plugin: &quot;dc_destinations/FlbFilesMetrics&quot;
    inputs: [&quot;/dc/group/map&quot;]
    file_storage: [&quot;minio&quot;, &quot;s3&quot;]
    db_type: &quot;pgsql&quot;
    debug: true
    delete_when_sent: true
    minio:
        endpoint: 127.0.0.1:9000
        access_key_id: XEYqG4ZcPY5jiq5i
        secret_access_key: ji011KCtI82ZeQS6UwsQAg8x9VR4lSaQ
        use_ssl: false
        bucket: &quot;mybucket&quot;
        src_fields: [&quot;map.local_paths.pgm&quot;, &quot;map.local_paths.yaml&quot;]
        upload_fields: [&quot;map.minio_paths.pgm&quot;, &quot;map.minio_paths.yaml&quot;]
    s3:
        endpoint: 127.0.0.1:9000
        access_key_id: XEYqG4ZcPY5jiq5i
        secret_access_key: ji011KCtI82ZeQS6UwsQAg8x9VR4lSaQ
        bucket: &quot;mybucket&quot;
        src_fields: [&quot;map.local_paths.yaml&quot;]
        upload_fields: [&quot;map.s3_paths.yaml&quot;]
    pgsql:
        host: &quot;127.0.0.1&quot;
        port: &quot;5432&quot;
        user: fluentbit
        password: password
        database: &quot;fluentbit&quot;
        table: &quot;files_metrics&quot;
        timestamp_key: &quot;date&quot;
        time_format: &quot;double&quot;
        time_key: &quot;date&quot;
        ssl: false
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/destinations/flb_files_metrics.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="http---fluent-bit"><a class="header" href="#http---fluent-bit">HTTP - Fluent Bit</a></h1>
<h2 id="description-40"><a class="header" href="#description-40">Description</a></h2>
<p>The http output plugin allows to flush your records into a HTTP endpoint. For now the functionality is pretty basic and it issues a POST request with the data records in <a href="http://msgpack.org/">MessagePack</a> (or JSON) format. See <a href="https://docs.fluentbit.io/manual/pipeline/outputs/http">fluent bit page</a> for more information.</p>
<h2 id="parameters-33"><a class="header" href="#parameters-33">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>allow_duplicated_headers</strong></td><td>Specify if duplicated headers are allowed. If a duplicated header is found, the latest key/value set is preserved.</td><td>bool</td><td>true</td></tr>
<tr><td><strong>format</strong></td><td>Specify the data format to be used in the HTTP request body, by default it uses msgpack. Other supported formats are json, json_stream and json_lines and gelf.</td><td>str</td><td>&quot;json&quot;</td></tr>
<tr><td><strong>header</strong></td><td>Add a HTTP header key/value pair. Multiple headers can be set.</td><td>str</td><td>N/A</td></tr>
<tr><td><strong>headers_key</strong></td><td>Specify the key to use as the headers of the request (must prefix with &quot;$&quot;). The key must contain a map, which will have the contents merged on the request headers. This can be used for many purposes, such as specifying the content-type of the data contained in body_key.</td><td>str</td><td>N/A</td></tr>
<tr><td><strong>header_tag</strong></td><td>Specify an optional HTTP header field for the original message tag.</td><td>str</td><td>N/A</td></tr>
<tr><td><strong>http_user</strong></td><td>Basic Auth Username.</td><td>str</td><td>N/A</td></tr>
<tr><td><strong>http_passwd</strong></td><td>Basic Auth Password. Requires HTTP_User to be set.</td><td>str</td><td>N/A</td></tr>
<tr><td><strong>json_date_format</strong></td><td>Specify the format of the date. Supported formats are double, epoch, iso8601 (eg: 2018-05-30T09:39:52.000681Z) and java_sql_timestamp (eg: 2018-05-30 09:39:52.000681).</td><td>str</td><td>&quot;double&quot;</td></tr>
<tr><td><strong>json_date_key</strong></td><td>Specify the name of the time key in the output record. To disable the time key just set the value to false.</td><td>str</td><td>&quot;date&quot;</td></tr>
<tr><td><strong>host</strong></td><td>IP address or hostname of the target HTTP Server.</td><td>str</td><td>&quot;127.0.0.1&quot;</td></tr>
<tr><td><strong>log_response_payload</strong></td><td>Specify if the response paylod should be logged or not.</td><td>str</td><td>true</td></tr>
<tr><td><strong>port</strong></td><td>TCP port of the target HTTP Server</td><td>str</td><td>&quot;80&quot;</td></tr>
<tr><td><strong>uri</strong></td><td>Specify an optional HTTP URI for the target web server, e.g: /something.</td><td>str</td><td>&quot;/&quot;</td></tr>
</tbody></table>
</div>
<h2 id="node-configuration-3"><a class="header" href="#node-configuration-3">Node configuration</a></h2>
<pre><code class="language-yaml">...
flb_http:
  plugin: &quot;dc_destinations/FlbHTTP&quot;
  inputs: [&quot;/dc/measurement/data&quot;]
  host: &quot;127.0.0.1&quot;
  port: 80
  uri: &quot;/&quot;
  format: &quot;json&quot;
...
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/destinations/flb_http.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="influxdb---fluent-bit"><a class="header" href="#influxdb---fluent-bit">InfluxDB - Fluent Bit</a></h1>
<h2 id="description-41"><a class="header" href="#description-41">Description</a></h2>
<p>The influxdb output plugin, allows to flush your records into a <a href="https://www.influxdata.com/time-series-platform/influxdb/">InfluxDB</a> time series database. The following instructions assumes that you have a fully operational InfluxDB service running in your system. See <a href="https://docs.fluentbit.io/manual/pipeline/outputs/influxdb">fluent bit page</a> for more information.</p>
<h2 id="parameters-34"><a class="header" href="#parameters-34">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>host</strong></td><td>IP address or hostname of the target InfluxDB service.</td><td>str</td><td>&quot;127.0.01&quot;</td></tr>
<tr><td><strong>port</strong></td><td>TCP port of the target InfluxDB service.</td><td>int</td><td>8086</td></tr>
<tr><td><strong>database</strong></td><td>InfluxDB database name where records will be inserted.</td><td>str</td><td>&quot;fluentbit&quot;</td></tr>
<tr><td><strong>bucket</strong></td><td>InfluxDB bucket name where records will be inserted - if specified, database is ignored and v2 of API is used.</td><td>str</td><td>N/A (Optional)</td></tr>
<tr><td><strong>org</strong></td><td>InfluxDB organization name where the bucket is (v2 only).</td><td>str</td><td>&quot;fluent&quot;</td></tr>
<tr><td><strong>sequence_tag</strong></td><td>The name of the tag whose value is incremented for the consecutive simultaneous events.</td><td>str</td><td>&quot;_seq&quot;</td></tr>
<tr><td><strong>http_user</strong></td><td>Optional username for HTTP Basic Authentication.</td><td>str</td><td>N/A (Optional)</td></tr>
<tr><td><strong>http_passwd</strong></td><td>Password for user defined in HTTP_User.</td><td>str</td><td>N/A (Optional)</td></tr>
<tr><td><strong>http_token</strong></td><td>Authentication token used with InfluDB v2 - if specified, both HTTP_User and HTTP_Passwd are ignored.</td><td>str</td><td>N/A (Optional)</td></tr>
<tr><td><strong>tag_keys</strong></td><td>List of keys that needs to be tagged.</td><td>list[str]</td><td>N/A (Optional)</td></tr>
<tr><td><strong>auto_tags</strong></td><td>Automatically tag keys where value is string.</td><td>bool</td><td>false</td></tr>
</tbody></table>
</div>
<h2 id="node-configuration-4"><a class="header" href="#node-configuration-4">Node configuration</a></h2>
<pre><code class="language-yaml">...
flb_influxdb:
  plugin: &quot;dc_destinations/FlbInfluxDB&quot;
  inputs: [&quot;/dc/measurement/uptime&quot;]
  host: &quot;127.0.0.1&quot;
  port: 8086
  database: &quot;ros&quot;
...
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/destinations/flb_influxdb.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="minio---fluent-bit"><a class="header" href="#minio---fluent-bit">Minio - Fluent Bit</a></h1>
<h2 id="description-42"><a class="header" href="#description-42">Description</a></h2>
<p>The Minio Plugin allows to send files to Minio. It uses the GO interface provided by Fluent Bit.</p>
<h2 id="difference-with-fluent-bit-s3-plugin"><a class="header" href="#difference-with-fluent-bit-s3-plugin">Difference with Fluent Bit S3 Plugin</a></h2>
<p>The <a href="https://docs.fluentbit.io/manual/pipeline/outputs/s3">S3 plugin</a> sends data as JSON to S3 or Minio but does not send files (e.g yaml, images etc.).</p>
<h2 id="parameters-35"><a class="header" href="#parameters-35">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>plugin_path</strong></td><td>Shared library path compiled by go.</td><td>str</td><td>&quot;{package_share_directory}/flb_plugins/lib/out_minio.so&quot;</td></tr>
<tr><td><strong>endpoint</strong></td><td>Endpoint for the S3 API. An endpoint can contain scheme and port.</td><td>str</td><td>&quot;127.0.0.1:9000&quot;</td></tr>
<tr><td><strong>access_key_id</strong></td><td>Access keys are long-term credentials for an IAM user or the AWS account root user.</td><td>str</td><td>N/A (mandatory)</td></tr>
<tr><td><strong>secret_access_key</strong></td><td>Secret-like password to connect along he access key id.</td><td>str</td><td>N/A (mandatory)</td></tr>
<tr><td><strong>use_ssl</strong></td><td>If set to true, https is used instead of http. Default is true.</td><td>str</td><td>&quot;true&quot;</td></tr>
<tr><td><strong>create_bucket</strong></td><td>Whether the bucket will be created.</td><td>str</td><td>&quot;true&quot;</td></tr>
<tr><td><strong>bucket</strong></td><td>Bucket name.</td><td>str</td><td>&quot;dc_bucket&quot;</td></tr>
<tr><td><strong>upload_fields</strong></td><td>Fields containing remote paths, separated by dots.</td><td>list[str]</td><td>N/A (mandatory)</td></tr>
<tr><td><strong>src_fields</strong></td><td>Fields containing local paths, separated by dots.</td><td>list[str]</td><td>N/A (mandatory)</td></tr>
</tbody></table>
</div>
<h2 id="node-configuration-5"><a class="header" href="#node-configuration-5">Node configuration</a></h2>
<pre><code class="language-yaml">...
flb_minio:
  verbose_plugin: false
  time_format: &quot;iso8601&quot;
  plugin: &quot;dc_destinations/FlbMinIO&quot;
  inputs: [&quot;/dc/measurement/camera&quot;, &quot;/dc/measurement/map&quot;]
  endpoint: 127.0.0.1:9000
  access_key_id: XEYqG4ZcPY5jiq5i
  secret_access_key: ji011KCtI82ZeQS6UwsQAg8x9VR4lSaQ
  use_ssl: false
  create_bucket: true
  bucket: &quot;mybucket&quot;
  src_fields:
    [
      &quot;local_paths.inspected&quot;
      &quot;local_paths.minio.pgm&quot;
      &quot;local_paths.minio.yaml&quot;
    ]
  upload_fields: # Remote paths created by the measurement node configuration
    [
      &quot;remote_paths.minio.inspected&quot;,
      &quot;remote_paths.minio.pgm&quot;
      &quot;remote_paths.minio.yaml&quot;
    ]
...
</code></pre>
<h2 id="parameter-handling"><a class="header" href="#parameter-handling">Parameter handling</a></h2>
<pre class="mermaid">flowchart TB

  subgraph ros2_plugin[&quot;Measurement plugin&quot;]
    direction LR
    mp_src_fields[&quot;['local_paths.inspected', 'local_paths.minio.pgm', 'local_paths.minio.yaml']&quot;]
    mp_upload_fields[&quot;['remote_paths.inspected', 'remote_paths.minio.pgm', 'remote_paths.minio.yaml']&quot;]
  end

  subgraph flb_plugin[&quot;Fluent Bit plugin&quot;]
    direction LR
    flb_src_fields[&quot;'local_paths.inspected, local_paths.minio.pgm, local_paths.minio.yaml'&quot;]
    flb_upload_fields[&quot;'remote_paths.inspected, remote_paths.minio.pgm, remote_paths.minio.yaml'&quot;]

    flb_split_src_fields[&quot;['local_paths.inspected', 'local_paths.minio.pgm', 'local_paths.minio.yaml']&quot;]
    flb_split_upload_fields[&quot;['remote_paths.inspected', 'remote_paths.minio.pgm', 'remote_paths.minio.yaml']&quot;]
  end

  mp_src_fields--&quot;to string&quot;--&gt;flb_src_fields
  mp_upload_fields--&quot;to string&quot;--&gt;flb_upload_fields
  flb_src_fields--&quot;to go array&quot;--&gt;flb_split_src_fields
  flb_upload_fields--&quot;to go array&quot;--&gt;flb_split_upload_fields

</pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/destinations/flb_minio.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="null---fluent-bit"><a class="header" href="#null---fluent-bit">NULL - Fluent Bit</a></h1>
<h2 id="description-43"><a class="header" href="#description-43">Description</a></h2>
<p>The null output plugin just throws away events. See <a href="https://docs.fluentbit.io/manual/pipeline/outputs/null">fluent bit page</a> for more information.</p>
<h2 id="node-configuration-6"><a class="header" href="#node-configuration-6">Node configuration</a></h2>
<pre><code class="language-yaml">...
flb_null:
  plugin: &quot;dc_destinations/FlbNull&quot;
  inputs: [&quot;/dc/measurement/data&quot;]
...
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/destinations/flb_null.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="postgresql---fluent-bit"><a class="header" href="#postgresql---fluent-bit">PostgreSQL - Fluent Bit</a></h1>
<h2 id="description-44"><a class="header" href="#description-44">Description</a></h2>
<p>PostgreSQL is a very popular and versatile open source database management system that supports the SQL language and that is capable of storing both structured and unstructured data, such as JSON objects. See <a href="https://docs.fluentbit.io/manual/pipeline/outputs/postgresql">fluent bit page</a> for more information.</p>
<h2 id="parameters-36"><a class="header" href="#parameters-36">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>host</strong></td><td>Hostname/IP address of the PostgreSQL instance.</td><td>str</td><td>&quot;127.0.0.1&quot;</td></tr>
<tr><td><strong>port</strong></td><td>PostgreSQL port.</td><td>str</td><td>&quot;5432&quot;</td></tr>
<tr><td><strong>user</strong></td><td>PostgreSQL username.</td><td>str</td><td>&quot;{username}&quot;</td></tr>
<tr><td><strong>password</strong></td><td>Password of PostgreSQL username.</td><td>str</td><td>N/A</td></tr>
<tr><td><strong>database</strong></td><td>Database name to connect to.</td><td>str</td><td>&quot;{username}&quot;</td></tr>
<tr><td><strong>table</strong></td><td>Table name where to store data.</td><td>str</td><td>N/A</td></tr>
<tr><td><strong>timestamp_Key</strong></td><td>Key in the JSON object containing the record timestamp.</td><td>str</td><td>&quot;date&quot;</td></tr>
<tr><td><strong>async</strong></td><td>Define if we will use async or sync connections.</td><td>bool</td><td>false</td></tr>
<tr><td><strong>min_pool_size</strong></td><td>Minimum number of connection in async mode.</td><td>str</td><td>&quot;1&quot;</td></tr>
<tr><td><strong>max_pool_size</strong></td><td>Maximum amount of connections in async mode.</td><td>str</td><td>&quot;4&quot;</td></tr>
<tr><td><strong>cockroachdb</strong></td><td>Set to true if you will connect the plugin with a CockroachDB.</td><td>bool</td><td>false</td></tr>
</tbody></table>
</div>
<h2 id="node-configuration-7"><a class="header" href="#node-configuration-7">Node configuration</a></h2>
<pre><code class="language-yaml">...
flb_pgsql:
  plugin: &quot;dc_destinations/FlbPgSQL&quot;
  inputs: [&quot;/dc/group/data&quot;]
  host: &quot;127.0.0.1&quot;
  port: 5432
  user: fluentbit
  password: password
  database: &quot;fluentbit&quot;
  table: &quot;dc&quot;
  timestamp_key: &quot;date&quot;
  async: false
  time_format: &quot;double&quot;
  time_key: &quot;date&quot;
...
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/destinations/flb_pgsql.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="slack---fluent-bit"><a class="header" href="#slack---fluent-bit">Slack - Fluent Bit</a></h1>
<h2 id="description-45"><a class="header" href="#description-45">Description</a></h2>
<p>The Slack output plugin delivers records or messages to your preferred Slack channel. See <a href="https://docs.fluentbit.io/manual/pipeline/outputs/slack">fluent bit page</a> for more information.</p>
<h2 id="parameters-37"><a class="header" href="#parameters-37">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>webhook</strong></td><td>Absolute address of the Webhook provided by Slack.</td><td>str</td><td>N/A (Mandatory)</td></tr>
</tbody></table>
</div>
<h2 id="node-configuration-8"><a class="header" href="#node-configuration-8">Node configuration</a></h2>
<pre><code class="language-yaml">...
flb_slack:
  plugin: &quot;dc_destinations/FlbSlack&quot;
  inputs: [&quot;/dc/group/data&quot;]
  webhook: https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXXXXXX
...
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/destinations/flb_slack.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="file---fluent-bit-1"><a class="header" href="#file---fluent-bit-1">File - Fluent Bit</a></h1>
<h2 id="description-46"><a class="header" href="#description-46">Description</a></h2>
<p>The stdout output plugin allows to print to the standard output the data received through the input plugin. See <a href="https://docs.fluentbit.io/manual/pipeline/outputs/standard-output">fluent bit page</a> for more information.</p>
<h2 id="parameters-38"><a class="header" href="#parameters-38">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>format</strong></td><td>Specify the data format to be printed. Supported formats are msgpack json, json_lines and json_stream.</td><td>str</td><td>&quot;json&quot;</td></tr>
<tr><td><strong>json_date_key</strong></td><td>Specify the name of the time key in the output record. To disable the time key just set the value to false.</td><td>str</td><td>&quot;date&quot;</td></tr>
<tr><td><strong>json_date_format</strong></td><td>Specify the format of the date. Supported formats are double, epoch, iso8601 (eg: 2018-05-30T09:39:52.000681Z) and java_sql_timestamp (eg: 2018-05-30 09:39:52.000681).</td><td>str</td><td>&quot;double&quot;</td></tr>
</tbody></table>
</div>
<h2 id="node-configuration-9"><a class="header" href="#node-configuration-9">Node configuration</a></h2>
<pre><code class="language-yaml">...
flb_stdout:
  plugin: &quot;dc_destinations/FlbStdout&quot;
  inputs: [&quot;/dc/group/data&quot;]
  format: &quot;json&quot;
  json_date_key: &quot;date&quot;
  json_date_format: &quot;iso8601&quot;
...
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/destinations/flb_stdout.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="tcp--tls---fluent-bit"><a class="header" href="#tcp--tls---fluent-bit">TCP &amp; TLS - Fluent Bit</a></h1>
<h2 id="description-47"><a class="header" href="#description-47">Description</a></h2>
<p>The tcp output plugin allows to send records to a remote TCP server. The payload can be formatted in different ways as required.. See <a href="https://docs.fluentbit.io/manual/pipeline/outputs/tcp-and-tls">fluent bit page</a> for more information.</p>
<h2 id="parameters-39"><a class="header" href="#parameters-39">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td><strong>host</strong></td><td>Target host where Fluent-Bit or Fluentd are listening for Forward messages.</td><td>str</td><td>&quot;127.0.0.1&quot;</td></tr>
<tr><td><strong>port</strong></td><td>TCP Port of the target service.</td><td>int(&gt;0 &lt;65536)</td><td>5170</td></tr>
<tr><td><strong>format</strong></td><td>Specify the data format to be printed. Supported formats are msgpack json, json_lines and json_stream.</td><td>str</td><td>&quot;msgpack&quot;</td></tr>
<tr><td><strong>json_date_key</strong></td><td>Specify the name of the time key in the output record. To disable the time key just set the value to false.</td><td>str</td><td>&quot;date&quot;</td></tr>
<tr><td><strong>json_date_format</strong></td><td>Specify the format of the date. Supported formats are double, epoch, iso8601 (eg: 2018-05-30T09:39:52.000681Z) and java_sql_timestamp (eg: 2018-05-30 09:39:52.000681)</td><td>str</td><td>&quot;double&quot;</td></tr>
<tr><td><strong>workers</strong></td><td>Enables dedicated thread(s) for this output. Default value is set since version 1.8.13. For previous versions is 0.</td><td>int</td><td>2</td></tr>
<tr><td><strong>tls.active</strong></td><td>Enable or disable TLS support.</td><td>bool</td><td>false</td></tr>
<tr><td><strong>tls.verify</strong></td><td>Force certificate validation.</td><td>bool</td><td>true</td></tr>
<tr><td><strong>tls.debug</strong></td><td>Set TLS debug verbosity level. It accept the following values: 0 (No debug), 1 (Error), 2 (State change), 3 (Informational) and 4 Verbose.</td><td>int(&gt;=0 &lt;=4)</td><td>1</td></tr>
<tr><td><strong>tls.ca_file</strong></td><td>Absolute path to CA certificate file.</td><td>str</td><td>N/A (Optional)</td></tr>
<tr><td><strong>tls.crt_file</strong></td><td>Absolute path to Certificate file.</td><td>str</td><td>N/A (Optional)</td></tr>
<tr><td><strong>tls.key_file</strong></td><td>Absolute path to private Key file.</td><td>str</td><td>N/A (Optional)</td></tr>
<tr><td><strong>tls.key_passwd</strong></td><td>Optional password for tls.key_file file.</td><td>str</td><td>N/A (Optional)</td></tr>
</tbody></table>
</div>
<h2 id="node-configuration-10"><a class="header" href="#node-configuration-10">Node configuration</a></h2>
<pre><code class="language-yaml">...
flb_tcp:
  plugin: &quot;dc_destinations/FlbTCP&quot;
  inputs: [&quot;/dc/measurement/uptime&quot;]
  host: &quot;127.0.0.1&quot;
  port: 5170
...
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/destinations/flb_tcp.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="rcl---rclcpp"><a class="header" href="#rcl---rclcpp">RCL - RCLCPP</a></h1>
<h2 id="description-48"><a class="header" href="#description-48">Description</a></h2>
<p>The RCL output collects the data with ROS and display it with <code>RCLCPP_INFO</code> call.</p>
<h2 id="warning"><a class="header" href="#warning">Warning</a></h2>
<p>Note that plugins which are not using Fluent Bit like this one don't have any data integrity and persistence. Do not use in production!</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/destinations/rcl.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="configuration-examples"><a class="header" href="#configuration-examples">Configuration examples</a></h1>
<p>Through minimal code examples, you will learn how to collect and send data with DC.</p>
<p>It will progressively present all features.</p>
<div id="admonition-info" class="admonition info">
<div class="admonition-title">
<p>Info</p>
<p><a class="admonition-anchor-link" href="dc/configuration_examples.html#admonition-info"></a></p>
</div>
<div>
<p>By here, you must have built the workspace following the <a href="dc/./setup.html">setup guide</a>.</p>
</div>
</div>
<p>Copy the configuration and save it as a yaml file, and then run:</p>
<pre><code class="language-bash">$ ros2 launch dc_bringup params_file:=&quot;my_file.yaml&quot;
</code></pre>
<h2 id="running-the-examples"><a class="header" href="#running-the-examples">Running the examples</a></h2>
<h3 id="example-1-uptime-to-fluent-bit-stdout-every-second-and-flush-data-every-second"><a class="header" href="#example-1-uptime-to-fluent-bit-stdout-every-second-and-flush-data-every-second">Example 1: Uptime to Fluent Bit Stdout every second and flush data every second</a></h3>
<pre><code class="language-yaml">destination_server:                           # Destination node configuration
  ros__parameters:
    destination_plugins: [&quot;flb_stdout&quot;]       # List of destination plugins names to enable
    flb_stdout:                               # Plugin name, you choose
      plugin: &quot;dc_destinations/FlbStdout&quot;     # Plugin class name, fixed
      inputs: [&quot;/dc/measurement/uptime&quot;]      # Same as topic_output in the uptime measurement in measurement_server

measurement_server:                           # Measurement node configuration
  ros__parameters:
    measurement_plugins: [&quot;uptime&quot;]           # List of measurement plugins names to enable
    uptime:                                   # Plugin name, you choose
      plugin: &quot;dc_measurements/Uptime&quot;        # Plugin class name, fixed
      topic_output: &quot;/dc/measurement/uptime&quot;  # Topic where data will be published
      tags: [&quot;flb_stdout&quot;]                    # Fluent Bit will match this in the destination server
</code></pre>
<h3 id="example-2-uptime-to-fluent-bit-stdout-every-second-and-flush-data-every-3-seconds"><a class="header" href="#example-2-uptime-to-fluent-bit-stdout-every-second-and-flush-data-every-3-seconds">Example 2: Uptime to Fluent Bit Stdout every second and flush data every 3 seconds</a></h3>
<pre><code class="language-yaml">destination_server:
  ros__parameters:
    flb:
      flush: 3                               # Interval to flush output (seconds)
    destination_plugins: [&quot;flb_stdout&quot;]
    flb_stdout:
      plugin: &quot;dc_destinations/FlbStdout&quot;
      inputs: [&quot;/dc/measurement/uptime&quot;]

measurement_server:
  ros__parameters:
    measurement_plugins: [&quot;uptime&quot;]
    uptime:
      plugin: &quot;dc_measurements/Uptime&quot;
      topic_output: &quot;/dc/measurement/uptime&quot;
      tags: [&quot;flb_stdout&quot;]
</code></pre>
<h3 id="example-3-uptime-to-fluent-bit-stdout-only-at-start-and-3-times"><a class="header" href="#example-3-uptime-to-fluent-bit-stdout-only-at-start-and-3-times">Example 3: Uptime to Fluent Bit Stdout only at start and 3 times</a></h3>
<pre><code class="language-yaml">destination_server:
  ros__parameters:
    destination_plugins: [&quot;flb_stdout&quot;]
    flb_stdout:
      plugin: &quot;dc_destinations/FlbStdout&quot;
      inputs: [&quot;/dc/measurement/uptime&quot;]

measurement_server:
  ros__parameters:
    measurement_plugins: [&quot;uptime&quot;]
    uptime:
      plugin: &quot;dc_measurements/Uptime&quot;
      topic_output: &quot;/dc/measurement/uptime&quot;
      tags: [&quot;flb_stdout&quot;]
      init_max_measurements: 3               # Maximum records to collect
</code></pre>
<h3 id="example-4-cpu-and-memory-to-fluent-bit-stdout-every-5-seconds-forever"><a class="header" href="#example-4-cpu-and-memory-to-fluent-bit-stdout-every-5-seconds-forever">Example 4: CPU and Memory to Fluent Bit Stdout every 5 seconds forever</a></h3>
<pre><code class="language-yaml">destination_server:
  ros__parameters:
    destination_plugins: [&quot;flb_stdout&quot;]
    flb_stdout:
      plugin: &quot;dc_destinations/FlbStdout&quot;
      inputs: [&quot;/dc/measurement/cpu&quot;, &quot;/dc/measurement/memory&quot;]

measurement_server:
  ros__parameters:
    measurement_plugins: [&quot;memory&quot;, &quot;cpu&quot;]
    memory:
      plugin: &quot;dc_measurements/Memory&quot;
      topic_output: &quot;/dc/measurement/memory&quot;
      polling_interval: 5000                  # Interval to which data is collected in milliseconds
      tags: [&quot;flb_stdout&quot;]
    cpu:
      plugin: &quot;dc_measurements/Cpu&quot;
      topic_output: &quot;/dc/measurement/cpu&quot;
      polling_interval: 5000                  # Interval to which data is collected in milliseconds
      tags: [&quot;flb_stdout&quot;]
</code></pre>
<h3 id="example-5-cpu-and-memory-as-a-group-to-fluent-bit-stdout-every-5-seconds-forever"><a class="header" href="#example-5-cpu-and-memory-as-a-group-to-fluent-bit-stdout-every-5-seconds-forever">Example 5: CPU and Memory as a group to Fluent Bit Stdout every 5 seconds forever</a></h3>
<pre><code class="language-yaml">destination_server:
  ros__parameters:
    destination_plugins: [&quot;flb_stdout&quot;]
    flb_stdout:
      plugin: &quot;dc_destinations/FlbStdout&quot;
      inputs: [&quot;/dc/group/memory_cpu&quot;]        # Group to create

group_server:                                 # Group server configuration
  ros__parameters:
    groups: [&quot;cpu_memory&quot;]
    cpu_memory:
      inputs: [&quot;/dc/measurement/cpu&quot;, &quot;/dc/measurement/memory&quot;] # Topics which are subscribed
      output: &quot;/dc/group/cpu_memory&quot;          # Topic where result will be published
      sync_delay: 5.0                         # How long to queue up messages before passing them through.
      group_key: &quot;cpu_memory&quot;
      tags: [&quot;flb_stdout&quot;]

measurement_server:
  ros__parameters:
    measurement_plugins: [&quot;memory&quot;, &quot;cpu&quot;]
    memory:
      plugin: &quot;dc_measurements/Memory&quot;
      topic_output: &quot;/dc/measurement/memory&quot;
      polling_interval: 5000
      tags: [&quot;flb_stdout&quot;]
    cpu:
      plugin: &quot;dc_measurements/Cpu&quot;
      topic_output: &quot;/dc/measurement/cpu&quot;
      polling_interval: 5000
      tags: [&quot;flb_stdout&quot;]
</code></pre>
<h3 id="example-6-custom-ros-message-to-stdout-every-2-seconds-forever"><a class="header" href="#example-6-custom-ros-message-to-stdout-every-2-seconds-forever">Example 6: Custom ROS message to Stdout every 2 seconds forever</a></h3>
<pre><code class="language-yaml">destination_server:
  ros__parameters:
    destination_plugins: [&quot;flb_stdout&quot;]
    flb_stdout:
      plugin: &quot;dc_destinations/FlbStdout&quot;
      inputs: [&quot;/dc/measurement/string_stamped&quot;]

measurement_server:
  ros__parameters:
    measurement_plugins: [&quot;my_string_stamped&quot;]
    my_string_stamped:
      plugin: &quot;dc_measurements/StringStamped&quot;           # Plugin that allow to publish from your nodes
      topic_output: &quot;/dc/measurement/my_string_stamped&quot; # Topic where data is republished with tags
      topic: &quot;/hello-world&quot;                             # Input topic where you are publishing
      tags: [&quot;flb_stdout&quot;]
      polling_interval: 2000
      enable_validator: false                           # By default, StringStamped message does not have a JSON schema since it uses custom input data
</code></pre>
<p>You will then need in another terminal to publish data on the input topic (<code>/hello-world</code>)</p>
<pre><code class="language-bash">$ ros2 topic pub -r 1 /hello-world dc_interfaces/msg/StringStamped  &quot;{data: '{\&quot;hello\&quot;:\&quot;world\&quot;}'}&quot;
</code></pre>
<h3 id="example-7-custom-ros-message-to-stdout-every-time-it-is-published"><a class="header" href="#example-7-custom-ros-message-to-stdout-every-time-it-is-published">Example 7: Custom ROS message to Stdout every time it is published</a></h3>
<pre><code class="language-yaml">destination_server:
  ros__parameters:
    destination_plugins: [&quot;flb_stdout&quot;]
    flb_stdout:
      plugin: &quot;dc_destinations/FlbStdout&quot;
      inputs: [&quot;/dc/measurement/string_stamped&quot;]

measurement_server:
  ros__parameters:
    measurement_plugins: [&quot;my_string_stamped&quot;]
    my_string_stamped:
      plugin: &quot;dc_measurements/StringStamped&quot;
      topic_output: &quot;/dc/measurement/my_string_stamped&quot;
      topic: &quot;/hello-world&quot;
      tags: [&quot;flb_stdout&quot;]
      enable_validator: false
      timer_based: false                                 # Get all data published on the input topic. Ignores polling_interval
</code></pre>
<p>Now that you know how it works, you can set your own measurements and destinations.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/configuration_examples.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="infrastructure-setup"><a class="header" href="#infrastructure-setup">Infrastructure setup</a></h1>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/infrastructure_setup.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="influxdb-1"><a class="header" href="#influxdb-1">InfluxDB</a></h1>
<h2 id="description-49"><a class="header" href="#description-49">Description</a></h2>
<p>PostgreSQL is a powerful, open source object-relational database system that uses and extends the SQL language combined with many features that safely store and scale the most complicated data workloads. The origins of PostgreSQL date back to 1986 as part of the POSTGRES project at the University of California at Berkeley and has more than 35 years of active development on the core platform.</p>
<h2 id="start-with-docker-compose"><a class="header" href="#start-with-docker-compose">Start with docker compose</a></h2>
<p>Execute:</p>
<pre><code class="language-bash">$ ./tools/infrastructure/scripts/install_infrastructure.bash \
  --tool=influxdb
  --install-type=docker
</code></pre>
<h2 id="start-natively"><a class="header" href="#start-natively">Start natively</a></h2>
<pre><code class="language-bash">$ ./tools/infrastructure/scripts/install_infrastructure.bash \
  --tool=influxdb
  --install-type=native
</code></pre>
<h2 id="credentials"><a class="header" href="#credentials">Credentials</a></h2>
<div class="table-wrapper"><table><thead><tr><th>User</th><th>Password</th><th>Database</th><th>Port</th></tr></thead><tbody>
<tr><td>admin</td><td>admin</td><td>dc</td><td>8086</td></tr>
</tbody></table>
</div><footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/infrastructure_setup/influxdb.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="ip-cameras"><a class="header" href="#ip-cameras">Ip cameras</a></h1>
<p>To start the ip camera example, to save video feeds from rtsp cameras, you can optionally create a virtual video feed if you don't have an ip camera, for testing purpose:</p>
<h2 id="start-rtsp-server"><a class="header" href="#start-rtsp-server">Start RTSP Server</a></h2>
<p>A <a href="https://www.wikiwand.com/en/Real_Time_Streaming_Protocol">rtsp</a> server. I use <strong>mediamtx</strong> available <a href="https://github.com/aler9/mediamtx/releases">here</a>. Download from the <a href="https://github.com/aler9/mediamtx/releases">release page</a> and start it:</p>
<pre><code class="language-bash">$ ./mediamtx
</code></pre>
<p>If the port is already used, download the <a href="https://github.com/aler9/mediamtx/blob/main/mediamtx.yml">configuration</a> and edit the <code>hlsAddress</code> parameter. You would then need to start it this way:</p>
<pre><code class="language-bash">$ ./mediamtx conf.yml
</code></pre>
<h2 id="create-a-virtual-camera"><a class="header" href="#create-a-virtual-camera">Create a virtual camera</a></h2>
<p>This is optional, and only useful if you want to not use a camera</p>
<p>You will first need to install some packages:</p>
<pre><code class="language-bash">$ sudo apt-get install v4l-utils v4l2loopback
</code></pre>
<p>And start a virtual camera device:</p>
<pre><code class="language-bash">$ sudo modprobe v4l2loopback
</code></pre>
<p>Now check its path:</p>
<pre><code class="language-bash">$ v4l2-ctl --list-devices

Dummy video device (0x0000) (platform:v4l2loopback-000):
	/dev/video2
</code></pre>
<p>In my case, it is /dev/video2</p>
<p>To send your camera feed, run:</p>
<pre><code class="language-bash">ffmpeg \
  -f v4l2 \
  -video_size 1920x1080 \
  -i /dev/video2 \
  -f rtsp \
  -rtsp_transport tcp rtsp://127.0.0.1:8554/mystream
</code></pre>
<h2 id="send-video-stream"><a class="header" href="#send-video-stream">Send video stream</a></h2>
<p>To send an image of a clock ticking, create a blank image and call it bg-white.png (with gimp for example) and run:</p>
<pre><code class="language-bash">ffmpeg \
  -re -loop 1 \
  -i bg-white.png \
  -vf drawtext=&quot;fontfile=monofonto.ttf: fontsize=96: box=1: boxcolor=black@0.75: boxborderw=5: fontcolor=white: x=(w-text_w)/2: y=((h-text_h)/2)+((h-text_h)/4): text='%{gmtime\:%H\\\\\:%M\\\\\:%S}'&quot; \
  -r 25 \
  -vcodec libx264 \
  -f rtsp -rtsp_transport tcp rtsp://127.0.0.1:8554/mystream
</code></pre>
<p>Now you can use the ip_camera plugin with the url from the command: <strong>rtsp://127.0.0.1:8554/mystream</strong></p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/infrastructure_setup/ip_camera.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="minio-2"><a class="header" href="#minio-2">MinIO</a></h1>
<h2 id="requirements"><a class="header" href="#requirements">Requirements</a></h2>
<ol>
<li>Docker installed</li>
<li>Docker compose installed</li>
</ol>
<h2 id="description-50"><a class="header" href="#description-50">Description</a></h2>
<p>MinIO is an object storage solution that provides an Amazon Web Services S3-compatible API and supports all core S3 features. MinIO is built to deploy anywhere - public or private cloud, baremetal infrastructure, orchestrated environments, and edge infrastructure.</p>
<h2 id="start-with-docker-compose-1"><a class="header" href="#start-with-docker-compose-1">Start with Docker compose</a></h2>
<p>Execute:</p>
<pre><code class="language-bash">$ ./tools/infrastructure/scripts/install_infrastructure.bash --tool=pgsql --install-type=docker
</code></pre>
<p>This will start PostgreSQL and Adminer (a GUI to see and interact with the database)</p>
<p>By accessing <a href="http://localhost:8080">localhost:8080</a>, you should be able to see this page:</p>
<p><img src="dc/infrastructure_setup/../../images/adminer.png" alt="Adminer" /></p>
<p>Server: <em>localhost</em>
Username: <em>dc</em>
Password: <em>password</em>
Database: <em>dc</em></p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/infrastructure_setup/minio.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="postgresql-2"><a class="header" href="#postgresql-2">PostgreSQL</a></h1>
<h2 id="requirements-1"><a class="header" href="#requirements-1">Requirements</a></h2>
<ol>
<li>Docker installed</li>
<li>Docker compose installed</li>
</ol>
<h2 id="description-51"><a class="header" href="#description-51">Description</a></h2>
<p>PostgreSQL is a powerful, open source object-relational database system that uses and extends the SQL language combined with many features that safely store and scale the most complicated data workloads. The origins of PostgreSQL date back to 1986 as part of the POSTGRES project at the University of California at Berkeley and has more than 35 years of active development on the core platform.</p>
<h2 id="start-with-docker-compose-2"><a class="header" href="#start-with-docker-compose-2">Start with docker compose</a></h2>
<p>Execute:</p>
<pre><code class="language-bash">$ ./tools/infrastructure/scripts/install_infrastructure.bash --tool=minio --install-type=docker
</code></pre>
<p>This will start MinIO API and dashboard (a GUI to see and interact with the data)</p>
<p>By accessing <a href="http://localhost:9001">localhost:9001</a>, you should be able to see this page:</p>
<p><img src="dc/infrastructure_setup/../../images/minio.png" alt="MinIO" /></p>
<p>Username: <em>minioadmin</em>
Password: <em>minioadmin</em></p>
<h2 id="create-an-access-key"><a class="header" href="#create-an-access-key">Create an access key</a></h2>
<p>Go to the Access Keys page and click on &quot;Create access key&quot;</p>
<p><img src="dc/infrastructure_setup/../../images/minio-access-keys.png" alt="MinIO Access Keys" /></p>
<p>Take note of the access and secret key and add them in your required launch file configuration late on.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/infrastructure_setup/postgresql.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="cli-tools"><a class="header" href="#cli-tools">CLI tools</a></h1>
<h2 id="list-plugins"><a class="header" href="#list-plugins">List plugins</a></h2>
<p>You can list available plugins by running the CLI tool:</p>
<pre><code>$ ros2 run dc_cli list_plugins --help


 Usage: list_plugins [OPTIONS] COMMAND [ARGS]...

╭─ Options ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ --install-completion          Install completion for the current shell.                                                   │
│ --show-completion             Show completion for the current shell, to copy it or customize the installation.            │
│ --help                        Show this message and exit.                                                                 │
╰───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─ Commands ────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ by-package       List plugins of a pluginlib file with their descriptions, by package name and filename.                  │
│ by-path          List plugins of a pluginlib file with their descriptions, by their path.                                 │
│ conditions       List condition plugins with their descriptions.                                                          │
│ destinations     List destination plugins with their descriptions.                                                        │
│ measurements     List measurement plugins with their descriptions.                                                        │
╰───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/cli.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="requirements-2"><a class="header" href="#requirements-2">Requirements</a></h1>
<p>Requirements are tracked using <a href="https://github.com/strictdoc-project/strictdoc">Strictdoc</a>.</p>
<p>The goal is to list tasks and do <a href="https://visuresolutions.com/requirements-management-traceability-guide/requirement-based-testing">test based requirements</a>.</p>
<p><object style="width: 100%; height: 100vh;" data="requirements/html/index.html"></object></p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/requirements.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="future-work-and-roadmap"><a class="header" href="#future-work-and-roadmap">Future work and Roadmap</a></h1>
<p>DC still being in early development, it requires:</p>
<ol>
<li>High test coverage</li>
<li>Automation: docker image build, PR and commit builds</li>
<li>More measurement plugins</li>
<li>More destination plugins</li>
<li>Guide for the Backend developer: I would like DC to be simple enough so a web developer can run it, get the data and work on its backend application</li>
<li>Guide for the ROS developer: I would like DC to be simple enough so a ROS developer can collect data without the expertise of knowing how to manage databases</li>
<li>Handle python destination plugins</li>
<li>More use cases showcased in demos</li>
</ol>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/future_work.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="participating"><a class="header" href="#participating">Participating</a></h1>
<h2 id="tldr"><a class="header" href="#tldr">TLDR</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Event</th><th>What to do</th></tr></thead><tbody>
<tr><td>Want to contribute</td><td><a href="https://github.com/Minipada/ros2_data_collection/pulls">Open a PR</a></td></tr>
<tr><td>Found a bug</td><td><a href="https://github.com/Minipada/ros2_data_collection/issues/new?assignees=&amp;labels=bug&amp;template=issues.md&amp;title=">File a ticket on Github Issues</a></td></tr>
<tr><td>Feature request</td><td><a href="https://github.com/Minipada/ros2_data_collection/discussions">Describe what you want on Github Discussions</a></td></tr>
<tr><td>Want to start a discussion</td><td><a href="https://github.com/Minipada/ros2_data_collection/discussions">Start one on Github Discussions</a></td></tr>
<tr><td>Be aware of the ongoing development</td><td>Take a look at the <a href="https://github.com/users/Minipada/projects/1">Github Project</a> and what is being worked on</td></tr>
</tbody></table>
</div>
<h2 id="contributing"><a class="header" href="#contributing">Contributing</a></h2>
<h3 id="feature-requests"><a class="header" href="#feature-requests">Feature requests</a></h3>
<p>Since I want DC to be community driven, go to <a href="https://github.com/Minipada/ros2_data_collection/discussions">Github discussions</a>, start a discussion about a features you want to see and users will be able to vote for your it. Most requested features will have more attention than others.</p>
<h3 id="found-a-bug"><a class="header" href="#found-a-bug">Found a bug?</a></h3>
<p>If you find a problem, first search if an issue already exists. If a related issue doesn't exist, you can open a new issue using the <a href="https://github.com/Minipada/ros2_data_collection/issues/new?assignees=&amp;labels=bug&amp;template=bug_report.md&amp;title=">issue form</a>.</p>
<h3 id="general-guidelines"><a class="header" href="#general-guidelines">General guidelines</a></h3>
<p>You can contribute to the source code with Pull Requests, for example:</p>
<ul>
<li>To fix a typo you found on the documentation.</li>
<li>To propose new documentation sections.</li>
<li>To fix an existing issue/bug.
<ul>
<li>Make sure to add tests.</li>
</ul>
</li>
<li>To add a new feature.
<ul>
<li>Make sure to add tests.</li>
<li>Make sure to add documentation if it's relevant.</li>
</ul>
</li>
</ul>
<h3 id="setup-environment"><a class="header" href="#setup-environment">Setup environment</a></h3>
<h4 id="ros"><a class="header" href="#ros">ROS</a></h4>
<p>Follow the steps to build your workspace and install dependencies in the <a href="dc/./setup.html">setup section</a></p>
<p>Then, install the pre-commit hook:</p>
<pre><code class="language-bash">$ pre-commit install
</code></pre>
<p>You are now ready to write some code, commit and follow the standards with the pre-commit hook.</p>
<h4 id="docs"><a class="header" href="#docs">Docs</a></h4>
<p>To build the docs, install cargo:</p>
<pre><code class="language-bash">$ sudo apt-get install cargo
</code></pre>
<p>Then install mdbook (the command line tool to create books with Markdown) and its plugins:</p>
<pre><code class="language-bash">$ cargo install mdbook mdbook-admonish mdbook-linkcheck mdbook-mermaid
</code></pre>
<p>Start the doc locally with auto-refresh on edit:</p>
<pre><code class="language-bash">$ export PATH=$PATH:$HOME/.cargo/bin
$ mdbook serve -p 8000 -n 0.0.0.0
</code></pre>
<p>And open <a href="http://localhost:8000">localhost:8000</a></p>
<p>Now that you open see the documentation locally, open the doc folder of the repository and edit the Markdown files you need. More about mdbook can be found <a href="https://rust-lang.github.io/mdBook/guide/installation.html">here</a></p>
<h3 id="tests"><a class="header" href="#tests">Tests</a></h3>
<p>TODO...</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/contributing.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="faq"><a class="header" href="#faq">FAQ</a></h1>
<h2 id="i-cant-find-a-measurement-andor-destination-i-need"><a class="header" href="#i-cant-find-a-measurement-andor-destination-i-need">I can't find a measurement and/or destination I need</a></h2>
<p>Even though measurements and destinations will constantly be added in the future, the current focus is on getting feedback, fixing bugs, documentation and reach a minimum test coverage.</p>
<p>Create a feature request in <a href="https://github.com/Minipada/ros2_data_collection/discussions/categories/ideas-and-feature-requests">Github Discussions</a>...or better, write your plugin and do a Pull Request.</p>
<h2 id="can-i-use-dc-without-fluent-bit-backend"><a class="header" href="#can-i-use-dc-without-fluent-bit-backend">Can I use DC without Fluent Bit backend?</a></h2>
<p>It is possible to use DC without Fluent Bit as backend. There is an example with the RCL destination, which subscribes to a ROS topic and prints it in the console.</p>
<p>Still, a lot of work would be required to disable Fluent Bit and keep similar features (backpressure handling, data persistence and measurements and destinations available)</p>
<h2 id="how-can-i-add-a-fluent-bit-plugin"><a class="header" href="#how-can-i-add-a-fluent-bit-plugin">How can I add a Fluent Bit plugin?</a></h2>
<p>Currently, from my knowledge, it is only possible to load a plugin using the C api which loads a shared library. Because of that, I expect more languages can be used, such as Rust, the only requirement is to use the bindings. For measurements, it is not a problem, we can write a node in any language publishing on a StringStamped message and use the measurement plugin with the same name.</p>
<p>Destination plugins can be written in C or Go. You can find examples in the fluent_bit_plugins package.</p>
<h2 id="how-can-i-use-a-python-api-with-fluent-bit"><a class="header" href="#how-can-i-use-a-python-api-with-fluent-bit">How can I use a Python API with Fluent Bit</a></h2>
<p>Adding a destination plugin which uses a Python library is not cleared. We have not yet solved this problem and would welcome one, since many API libraries are available in this language.</p>
<p>Note for the courageous ones: I tried once to create python-C bindings of Fluent Bit, by creating .h files like in the <a href="https://github.com/fluent/fluent-bit-go">fluent-bit-go</a> and use ctypesgen(https://github.com/ctypesgen/ctypesgen), like this:</p>
<pre><code class="language-bash">ctypesgen \
  --allow-gnu-c \
  --output-language=py32 \
  ~/ws/fluent-bit/include/fluent-bit.h \
  -I./lib/msgpack-c/include/ \
  -I./lib/monkey/include \
  -I./build/lib/monkey/include/monkey \
  -I./lib/cfl/include \
  -I./lib/cfl/lib/xxhash \
  -I./include \
  -I./lib/flb_libco \
  -I./lib/c-ares-1.19.0/include \
  -I./lib/cmetrics/include \
  -I./lib/ctraces/include \
  -I./lib/ctraces/lib/mpack/src \
  -o fluent_bit.py
</code></pre>
<p>It creates a base for the bindings. While I suppose it is possible to generate them, I'm puzzled as how this will be loaded by Fluent Bit afterwards.</p>
<p>Whatever you write, feel free to make a Pull Request and share your work!</p>
<h2 id="my-group-data-is-not-published-on-the-group-topic"><a class="header" href="#my-group-data-is-not-published-on-the-group-topic">My group data is not published on the group topic</a></h2>
<p>This may happen for different reasons:</p>
<ol>
<li>The group node is not started, be sure it is (ros2 node list), you will need to enable it in your launch file or using the <code>group_node:=true</code> when launching the bringup</li>
<li>Data is not being published on all topics it subscribes to (use ros2 topic echo on each to ensure that). Currently, if all topics don't publish, there is no way to ignore that and still send the message partially full (see <a href="https://answers.ros.org/question/410138/is-it-possible-to-drop-or-keep-message-in-approximatetimesynchronizer/">here</a>). Help is welcome here :)</li>
</ol>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/faq.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="about-and-contact-1"><a class="header" href="#about-and-contact-1">About and Contact</a></h1>
<h2 id="about"><a class="header" href="#about">About</a></h2>
<p>Our team currently includes:</p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>GitHub ID</th><th>Current Role</th></tr></thead><tbody>
<tr><td>David Bensoussan</td><td><a href="https://github.com/Minipada/">Minipada</a></td><td></td></tr>
</tbody></table>
</div>
<h2 id="contact"><a class="header" href="#contact">Contact</a></h2>
<p>For any inquiry, please contact David (<a href="mailto:d.bensoussan@proton.me">d.bensoussan@proton.me</a>). If your inquiry relates to bugs or open-source feature requests, consider posting a ticket on our GitHub project. If your inquiry relates to configuration support or private feature development, reach out and we will be able to support you in your projects.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/minipada/ros2_data_collection/edit/main/doc/src/dc/about_contact.md">Edit this page on GitHub.</a></footer>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="ace.js"></script>
        <script src="editor.js"></script>
        <script src="mode-rust.js"></script>
        <script src="theme-dawn.js"></script>
        <script src="theme-tomorrow_night.js"></script>

        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="js/mermaid.js"></script>
        <script src="js/mermaid-init.js"></script>
        <script src="js/theme.js"></script>

        <script>
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>

    </body>
</html>
